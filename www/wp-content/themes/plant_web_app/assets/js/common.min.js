$( function () {

    "use strict";

    new Preloader( $( '.preload' ) );

    new  FixHeader( $( '.site__header' ) );

    new  MobileMenu( $( '.menu' ) );

    $.each( $( '.ajax-add-to-cart' ), function() {
        new AddToCart ( $( this ) );
    } );

    $.each( $( '.youtube-frame' ), function() {
        new SetSizeIframe ( $( this ) );
    } );

    $.each( $( '.blog-article iframe' ), function() {
        new SetSizeIframe ( $( this ) );
    } );

    $.each( $( '.hero' ), function() {
        new InitSlider ( $( this ) );
    } );

    $.each( $( '.book' ), function() {
        new ChangeBookLanguage ( $( this ) );
    } );

    $.each( $( '.search' ), function() {
        new SearchForm ( $( this ) );
    } );

    $.each( $( '.orders' ), function() {
        new InitTableScroll ( $( this ) );
    } );

    $.each( $( '.success-stories' ), function() {
        new InitSlider ( $( this ) );
    } );

    $.each( $( '.recipe-books-promo' ), function() {
        new InitSlider ( $( this ) );
    } );

    $.each( $( '.mobile-app' ), function() {
        new InitSlider ( $( this ) );
    } );

    $.each( $( '.join-us' ), function() {
        new InitJoinUsSlider ( $( this ) );
    } );

    $.each( $( '#auto-load.free-recipes' ), function() {
        new FreeRecipesSection ( $( this ) );
    } );

    $.each( $( '.js-back-picture' ), function() {
        new BackPictureFullSize ( $( this ) );
    } );

    $.each( $( '.site__deco' ), function() {
        new SiteDeco ( $( this ) );
    } );

    $.each( $( '.categories' ), function() {
        new InitScroll ( $( this ) );
    } );

    $.each( $( '.blog' ), function() {
        new Blog ( $( this ) );
    } );

    $.each( $( '.book__gallery' ), function() {
        new BookGallery ( $( this ) );
    } );

    $.each( $( '.tabs' ), function() {
        new Tabs( $( this ) );
    } );

    $.each( $( '.blog__item-share' ), function() {
        new InitSocialShare( $( this ) );
    } );

    $.each( $( '.social-share' ), function() {
        new InitSocialShare( $( this ) );
    } );

    $.each( $( '.faq-wrap' ), function() {
        new OpenItems( $( this ) );
    } );

    $.each( $( '.cart-list' ), function() {
        new CartList( $( this ) );
    } );

    $.each( $('.authorization-form__warning'), function () {
        new AuthorizationFormWarning( $(this) );
    } );

    $.each( $('.hero-account'), function () {
        new TrueUser( $(this) );
    } );

    $.each( $('.stars'), function () {
        new Stars( $(this) );
    } );

    $.each( $('.reviews'), function () {
        new ReviewsItems( $(this) );
    } );

    $.each( $('.flash-sales'), function () {
        new OfferTimer( $(this) );
    } );

} );

var AddToCart = function( obj ){

    //private properties
    var _obj = obj,
        _url = $( 'body' ).data( 'action' ),
        _request = new XMLHttpRequest(),
        _timer, _delay = 1000;

    //private methods
    var _construct = function(){
            _onEvent();
        },
        _onEvent = function(){

            _obj.on( 'click', function () {
                _disabledBtn();
                return false;
            } );

        },
        _disabledBtn = function () {

            _obj.addClass( 'is-loading' );
            _obj.append( '<span class="btn__loader"><span></span></span>' );

            _ajaxSend();

        },
        _ajaxSend = function(){

            _request = $.ajax( {
                url: _url,
                dataType: 'json',
                timeout: 20000,
                type: "POST",
                data: {
                    action: 'add_to_cart_book',
                    id: _obj.attr( 'data-id' )
                },
                success: function ( data ) {

                    _showSuccessMessage();
                    BasketUpdate( data.result );

                },
                error: function (XMLHttpRequest) {
                    if (XMLHttpRequest.statusText != 'abort') {
                        alert(XMLHttpRequest.statusText);
                    }
                }
            } );

        },
        _showSuccessMessage = function () {

            _obj.removeClass( 'is-loading' ).addClass( 'is-success' );
            _obj.find( '.btn__loader' ).remove();

            _obj.append( '<span class="btn__success"><svg stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"><path d="M22 11.07V12a10 10 0 1 1-5.93-9.14"/><polyline points="23 3 12 14 9 11"/></svg></span>' );

            _timer = setTimeout( function () {

                _obj.removeClass( 'btn_type-sale ajax-add-to-cart is-success' ).addClass( 'btn_type-sold' );
                _obj.find( '.btn__success' ).remove();
                _obj.append( '<span>Already in cart</span>' );
                _obj.off( 'click' );

                if (  _obj.hasClass( 'close-popup') ){
                    $( '.popup' )[0].obj.closePopup();
                }

                clearTimeout( _timer );
            }, _delay );

        };

    //public properties

    //public methodsJOIN US ON YOUTUB

    _construct();

};

var AuthorizationFormWarning = function( obj ){

    //private properties
    var _obj = obj,
        _btnClose = _obj.find( '.btn' );

    //private methods
    var _construct = function(){
            _checkUser();
            _onEvent();
        },
        _onEvent = function(){

            _btnClose.on( 'click', function () {
                _obj.addClass( 'is-hide' );

                _obj.on( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function() {
                    _obj.remove();
                    localStorage.setItem( 'trueUser', true )
                } );

            } );

        },
        _checkUser = function () {

            var trueUser = localStorage.getItem( 'trueUser' );

            if ( trueUser ){
                _obj.remove();
            }

        };

    //public properties

    //public methods

    _construct();

};

var BasketUpdate = function ( data ) {

    var _data = $( data ),
        _newAmount = _data.text(),
        _newSymbol = _newAmount.slice(0,1),
        _newTotal = _newAmount.substring(1),
        _basketWrap = $( '.basket' ),
        _basketLayout = _basketWrap.find( '.basket__wrap' ),
        _totalWrap = _basketWrap.find( '.basket__amount' ),
        _timer;

    //private methods
    var _construct = function(){
            _appendNumber();
        },
        _appendNumber = function () {

            if ( _totalWrap.length > 0 ){

                if ( _newTotal > 0 ){

                    var duration = 500,
                        i = +( _totalWrap.text().substring(1) ),
                        stepTime = Math.abs( Math.floor( duration / Math.abs( _newTotal - i ) ) ),
                        timer;

                    if ( _newTotal > i ) {

                        _totalWrap.addClass( 'is-growing' );

                        timer = setInterval( function() {

                            i = i + 1;

                            _totalWrap.html( _newSymbol +''+  i );

                            if ( i == _newTotal ) {
                                clearInterval( timer );
                                _totalWrap.removeClass( 'is-growing' );
                            }

                        }, stepTime );

                    } else if ( _newTotal < i ) {

                        timer = setInterval( function() {

                            i = i - 1;

                            _totalWrap.html( _newSymbol +''+  i );

                            if ( i == _newTotal ) {
                                clearInterval( timer );
                            }

                        }, stepTime );

                    }

                } else {

                    _basketWrap.css( 'width', _basketWrap.outerWidth() );

                    _totalWrap.addClass( 'is-hide' );

                    _totalWrap.on( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function() {
                        _totalWrap.remove();
                        _totalWrap.off( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend' );
                        _basketWrap.css( 'width', _basketLayout.outerWidth() );
                    } );

                }

            } else {

                _basketWrap.css( 'width', _basketWrap.outerWidth() );

                _basketLayout.append( '<span class="basket__amount is-hide">'+ _newSymbol +''+ _newTotal +'</span>' );

                _basketWrap.css( 'width', _basketLayout.outerWidth() );
                _totalWrap = _basketWrap.find( '.basket__amount' );

                _timer = setTimeout( function () {
                    _totalWrap.removeClass( 'is-hide' ).addClass( 'is-growing' );

                    _totalWrap.on( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function() {
                        _totalWrap.removeClass( 'is-growing' );
                        clearTimeout(_timer);
                        _totalWrap.off( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend' );
                    } );

                }, 100 );

            }

        };

    //public properties

    //public methods

    _construct();

};

var BackPictureFullSize = function ( obj ) {

    var _obj = obj,
        _backgroundPicture = _obj.find( 'img' ),
        _window = $( window );

    var _onEvents = function() {

            _window.on( 'resize', function () {
                _setFullSize();
            } );

            _backgroundPicture.on( 'load', function () {
                _setFullSize();
            } );

        },
        _setFullSize = function () {

            _backgroundPicture.removeAttr( 'style' );

            var frameWidth = _obj.outerWidth(),
                frameHeight = _obj.outerHeight(),
                pictureWidth = _backgroundPicture.outerWidth(),
                pictureHeight = _backgroundPicture.outerHeight();

            if ( pictureWidth < frameWidth ){
                _backgroundPicture.css( {
                    'width': '100%',
                    'height': 'auto'
                } )
            } else if ( pictureHeight < frameHeight ) {
                _backgroundPicture.css( {
                    'width': 'auto',
                    'height': frameHeight
                } )
            }

        },
        _construct = function() {
            _onEvents();
            _setFullSize();
        };

    _construct()
};

var Blog = function ( obj ) {

    var _obj = obj,
        _blogWrap = _obj.find( '.blog__wrap' ),
        _blogList = _blogWrap.find( '.blog__list' ),
        _categoryList = $( '.categories' ),
        _categoryItem = _categoryList.find( '.categories__item' ),
        _currentId = _categoryItem.eq(0).data( 'id' ),
        _currentPage = 1,
        _maxPage = 1,
        _canSendRequest = true,
        _url = $( 'body' ).data( 'action' ),
        _request = new XMLHttpRequest(),
        _window = $( window ),
        _monthNames = [ "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec" ];

    var _onEvents = function() {

            _window.on( 'scroll', function () {
                if ( _window.scrollTop() + _window.height() >= _blogWrap.offset().top + _blogWrap.outerHeight() - 10 ) {
                    _loadData();
                }
            } );

            _categoryItem.on( 'click', function () {
                _changeCategory( $(this) );
                return false;
            } );

        },
        _changeCategory = function ( obj ) {

            _currentPage = 1;
            _maxPage = 1;

            _categoryItem.removeClass( 'is-active' );
            obj.addClass( 'is-active' );

            _blogList.empty();

            _currentId = obj.data( 'id' );

            localStorage.setItem( 'blogCategory', _currentId );

            _loadData();

        },
        _setBlogItem = function ( data ) {

            var blogItem = data,
                blogItemAuthor = blogItem.author,
                blogItemLink = blogItem.link,
                blogItemImage = blogItem.image,
                blogItemTitle = blogItem.title,
                blogItemContent = blogItem.content,
                blogItemTag = blogItem.tag,
                blogItemDate = blogItem.date,
                dateArr = blogItemDate.split('-'),
                frameItem;

            frameItem = '<article class="blog__item is-new">' +
                '<a href="'+ blogItemLink +'" class="blog__item-image js-back-picture">' +
                '<img src="'+ blogItemImage +'" alt="'+ blogItemTitle +'">' +
                '</a>' +
                '<div class="blog__item-content article">' +
                '<div class="blog__item-author">By '+ blogItemAuthor +'</div>' +
                '<div class="blog__item-category">'+ blogItemTag +'</div>\n' +
                '<h2 class="blog__item-title"><a href="'+ blogItemLink +'">'+ blogItemTitle +'</a></h2>\n' +
                '<div class="blog__item-text">'+ blogItemContent +'</div>' +
                '<div class="blog__item-share" data-social=\'' +
                '{"title": "'+ escape( blogItemTitle ) +'", "image": "'+ blogItemImage +'", "text": "'+ escape(blogItemContent) +'", "url": "'+ blogItemLink +'"}\'>' +
                '<a href="#" class="blog__item-share-link s_facebook" rel="nofollow">' +
                '<svg viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">' +
                '<g transform="translate(-160.000000, -2933.000000)" fill-rule="nonzero"><g transform="translate(160.000000, 2933.000000)"><g><g>' +
                '<path d="M17.87472,0 C8.01864,0 0,8.01864 0,17.87472 C0,27.73008 8.01864,35.74944 17.87472,35.74944 C27.73008,35.74944 35.74944,27.73008 35.74944,17.87472 C35.74944,8.01864 27.73152,0 17.87472,0 Z M22.32,18.504 L19.41192,18.504 C19.41192,23.15016 19.41192,28.86912 19.41192,28.86912 L15.10272,28.86912 C15.10272,28.86912 15.10272,23.2056 15.10272,18.504 L13.05432,18.504 L13.05432,14.84064 L15.10272,14.84064 L15.10272,12.47112 C15.10272,10.77408 15.90912,8.12232 19.45152,8.12232 L22.64472,8.13456 L22.64472,11.69064 C22.64472,11.69064 20.70432,11.69064 20.32704,11.69064 C19.94976,11.69064 19.41336,11.87928 19.41336,12.68856 L19.41336,14.84136 L22.69656,14.84136 L22.32,18.504 Z"></path>' +
                '</g></g></g></g></g></svg></a>' +
                '<a href="#" class="blog__item-share-link s_twitter" rel="nofollow">' +
                '<svg viewBox="0 0 56 56" xmlns="http://www.w3.org/2000/svg"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">'+
                '<g transform="translate(-931.000000, -10453.000000)" fill-rule="nonzero"><g transform="translate(-138.000000, 8602.000000)">'+
                '<g transform="translate(265.000000, 1668.000000)"><g transform="translate(0.000000, 11.000000)"><g transform="translate(0.000000, 127.000000)">'+
                '<g transform="translate(774.000000, 45.000000)"><g transform="translate(30.000000, 0.000000)"><g>'+
                '<path d="M27.80512,0 C12.47344,0 0,12.47344 0,27.80512 C0,43.13568 12.47344,55.61024 27.80512,55.61024 C43.13568,55.61024 55.61024,43.13568 55.61024,27.80512 C55.61024,12.47344 43.13792,0 27.80512,0 Z M40.20912,21.44128 C40.22144,21.7168 40.22816,21.99456 40.22816,22.27232 C40.22816,30.72944 33.79264,40.47792 22.01808,40.47792 C18.40384,40.47792 15.03936,39.42176 12.208,37.60512 C12.70864,37.66448 13.21824,37.69472 13.73456,37.69472 C16.73392,37.69472 19.49248,36.67104 21.6832,34.9552 C18.8832,34.90368 16.51888,33.05344 15.70464,30.50992 C16.0944,30.58384 16.49648,30.62528 16.90752,30.62528 C17.49104,30.62528 18.05776,30.54912 18.59424,30.4024 C15.66656,29.81552 13.46128,27.22944 13.46128,24.12704 C13.46128,24.10016 13.46128,24.07216 13.4624,24.0464 C14.3248,24.52464 15.31152,24.8136 16.35984,24.84608 C14.644,23.70032 13.51392,21.74032 13.51392,19.52048 C13.51392,18.34672 13.82864,17.24688 14.37968,16.3016 C17.53472,20.17456 22.25216,22.72144 27.56992,22.99024 C27.46016,22.52096 27.40528,22.03376 27.40528,21.53088 C27.40528,17.99728 30.27024,15.1312 33.80384,15.1312 C35.64512,15.1312 37.30608,15.90848 38.47536,17.15168 C39.93472,16.86496 41.30112,16.33408 42.54096,15.59824 C42.05936,17.09344 41.048,18.34672 39.72304,19.13968 C41.01888,18.98512 42.25536,18.6424 43.39888,18.1328 C42.54544,19.41408 41.46016,20.54192 40.20912,21.44128 Z"></path>'+
                '</g></g></g></g></g></g></g></g></g></svg></a>' +
                '<a href="#" class="blog__item-share-link s_pinterest" rel="nofollow">' +
                '<svg viewBox="0 0 56 56" xmlns="http://www.w3.org/2000/svg"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">'+
                '<g transform="translate(-1172.000000, -10454.000000)" fill-rule="nonzero"><g transform="translate(-138.000000, 8602.000000)">'+
                '<g transform="translate(265.000000, 1668.000000)"><g transform="translate(0.000000, 11.000000)"><g transform="translate(0.000000, 127.000000)">'+
                '<g transform="translate(1015.000000, 46.000000)"><g transform="translate(30.000000, 0.000000)"><g>'+
                '<path d="M28,0 C12.5363137,0 0,12.5363137 0,28 C0,43.4635948 12.5363137,56 28,56 C43.4635948,56 56,43.4635948 56,28 C56,12.5363137 43.4635948,0 28,0 Z M30.576,36.4788758 C28.5065621,36.4788758 26.559281,35.336 25.8898431,34.0377516 C25.8898431,34.0377516 24.7774379,38.5483137 24.540719,39.4188758 C24.1435948,40.8901569 23.3774379,42.3589673 22.6671895,43.5222484 C21.6541569,44.8458431 20.4857516,43.8633725 20.3457516,42.656719 C20.3,41.312719 20.3483137,39.7218431 20.6817516,38.2735294 C21.0508758,36.6852157 23.1483137,27.6055294 23.1483137,27.6055294 C23.1483137,27.6055294 22.5348758,26.3556863 22.5348758,24.5076863 C22.5348758,21.6058431 24.1818431,19.4396863 26.2334379,19.4396863 C27.9770327,19.4396863 28.8195948,20.7786536 28.8195948,22.3796863 C28.8195948,24.1691242 27.7021569,26.8469673 27.1268758,29.3262484 C26.6457516,31.4033725 28.1475948,33.0960915 30.1534379,33.0960915 C33.7857516,33.0960915 36.2345621,28.3309673 36.2345621,22.6876863 C36.2345621,18.3960915 33.4039085,15.1862484 28.2545621,15.1862484 C22.4381569,15.1862484 18.8134379,19.615281 18.8134379,24.5611242 C18.8134379,26.2665621 19.304719,27.4705621 20.0785621,28.3996863 C20.4324052,28.8273725 20.483281,29.0004052 20.3534379,29.4917778 C20.2618431,29.8532157 20.0505621,30.7186536 19.964,31.0622484 C19.836719,31.5586536 19.4421569,31.7343399 19.0043137,31.5510588 C16.324,30.4335294 15.076719,27.4375294 15.076719,24.0724967 C15.076719,18.5106536 19.671281,11.8415294 28.7814379,11.8415294 C36.1021569,11.8415294 40.920719,17.2506536 40.920719,23.0568105 C40.9231895,30.7414379 36.7410327,36.4788758 30.576,36.4788758 Z"></path>'+
                '</g></g></g></g></g></g></g></g></g></svg></a>' +
                '</div>\n' +
                '<div class="blog__item-footer">' +
                '<time datetime="'+ blogItemDate +'">'+ _monthNames[ dateArr[1] - 1 ] +' '+ dateArr[2] +', '+ dateArr[0] +'</time>' +
                '<a href="'+ blogItemLink +'" class="btn btn_color-1 btn_type-general"><span>Read More</span></a>' +
                '</div></div></article>';

            return frameItem;

        },
        _initSocialShare = function ( obj ) {

            var socialWrap = obj.find( '.blog__item-share' ),
                socialData = JSON.parse( socialWrap.attr( 'data-social' ) ),
                socialItem = socialWrap.find( 'a' );

            $.each( socialItem, function() {

                $(this).ShareLink( {
                    title: unescape( socialData[ 'title' ] ),
                    text: unescape( socialData[ 'text' ] ),
                    image: socialData[ 'image' ],
                    url: socialData[ 'url' ],
                    width: 640,
                    height: 480
                } );

            } );

        },
        _loadData = function () {

            if( _canSendRequest && _currentPage <= _maxPage ){
                _sendRequest();
            }

        },
        _sendRequest = function() {

            _canSendRequest = false;

            _request.abort();
            _blogWrap.addClass( 'is-loading' ).removeClass( 'is-empty' );

            _request = $.ajax( {
                url: _url,
                data: {
                    action: 'get_posts_by_category',
                    page: _currentPage,
                    taxId: _currentId
                },
                dataType: 'json',
                timeout: 20000,
                type: 'POST',
                success: function ( data ) {
                    _setList( data );
                },
                error: function ( XMLHttpRequest ) {
                    if ( XMLHttpRequest.statusText != "abort" ) {
                        console.error( 'err' );
                    }
                }
            } );

        },
        _setList = function( data ) {

            var blogData = data.blog,
                blogItemTotal = blogData.length;

            if ( blogItemTotal === 0 ){
                _canSendRequest = false;
                _blogWrap.addClass( 'is-empty' ).removeClass( 'is-loading' );
                return false;
            }

            _maxPage = data.maxPages;

            $.each( blogData, function( index ) {

                var blogFrame = _setBlogItem( this );

                _blogList.append( blogFrame );

                if ( index === blogItemTotal - 1 ){
                    _blogWrap.removeClass( 'is-loading' );
                    _canSendRequest = true;

                    _blogWrap.css( 'height', _blogList.outerHeight() );

                    var newItem = _blogList.find( '.is-new' );

                    newItem.each( function ( i ) {

                        var curItem = $( this );

                        _initSocialShare( curItem );
                        _showNewItems( curItem, i );

                    } );

                    var image = newItem.find( 'img' );

                    image.on( 'load', function () {
                        _blogWrap.css( 'height', _blogList.outerHeight() );
                    } );

                }

            } );

            _currentPage = _currentPage + 1;

        },
        _showNewItems = function ( item, index ) {

            var curItem = item;

            setTimeout( function() {
                curItem.removeClass( 'is-new' );
            }, 100 * index );

        },
        _construct = function() {
            _categoryItem.filter( '[data-id="'+ _currentId +'"]' ).addClass( 'is-active' );
            _onEvents();
            _loadData();
        };

    _construct()
};

var BookGallery = function ( obj ) {

    var _obj = obj,
        _item = _obj.find( '.book__gallery-item' );

    var _onEvents = function() {

            _item.on( 'click', function () {
                SwiperPopup( $( this ).parents( '.book__gallery' ), $( this ).index() );
                return false;
            } );

        },
        _construct = function() {
            _onEvents();
        };

    _construct()
};

var CartList = function ( obj ) {

    var _obj = obj,
        _table = _obj.find( '.cart-list__table' ),
        _footer = _obj.find( '.cart-list__btn-wrap' ),
        _item = _obj.find( '.cart-list__row' ),
        _deleteBtn = _item.find( '.cart-list__delete' ),
        _totalWrap = _obj.find( '.cart-list__total strong' ),
        _couponWrap = _obj.find( '.coupons' ),
        _couponForm = _couponWrap.find( '.coupons__form' ),
        _couponMessage = _couponWrap.find( '.coupons__message' ),
        _couponInput = _obj.find( 'input' ),
        _validation = new FormValidator( _obj ),
        _url = $( 'body' ).data( 'action' ),
        _request = new XMLHttpRequest();

    var _onEvents = function() {

            _deleteBtn.on( 'click', function () {
                _ajaxRequest( $( this ) );
                return false;
            } );

            _couponForm.on( 'submit', function (e) {
                e.preventDefault();

                _obj.addClass( 'is-loading' );

                if ( _validation.valid === true ) {
                    _ajaxCouponRequest();
                } else {
                    _obj.removeClass( 'is-loading' );
                }

            } );

        },
        _checkCounter = function () {

            _obj.removeClass( 'is-loading' );

            _obj.css( 'height', _obj.outerHeight() );

            _obj.addClass( 'is-empty' ).animate( { height: 0 }, 300 );

            _table.on( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function() {
                _table.remove();
                _footer.remove();
                _obj.removeAttr( 'style' )
            } );

        },
        _removeItem = function( obj ) {

            _obj.removeClass( 'is-loading' );

            var curRow = obj,
                timer;

            curRow.css( 'height', curRow.outerHeight() );

            curRow.animate( {
                    height: 0
                }, 300,
                function() {

                    timer = setTimeout( function () {
                        curRow.remove();
                        clearTimeout( timer );
                    }, 300 );

                } );

        },
        _ajaxRequest = function ( obj ) {

            _obj.addClass( 'is-loading' );

            _request.abort();

            var curRow = obj.parents( '.cart-list__row' ),
                _data = curRow.data( 'cart' );

            _request = $.ajax( {
                url: _url,
                data: {
                    action: 'remove_cart_item',
                    key: _data.key,
                    id: _data.id,
                    value: _data.value
                },
                dataType: 'json',
                type: 'POST',
                success: function ( data ) {

                    if ( data ){

                        if ( data.cartCountProducts == 0 ) {
                            _checkCounter();
                        } else {
                            _removeItem( curRow );
                        }

                        _setTotalValue( data );

                    } else {
                        _request.abort();
                    }

                },
                error: function ( XMLHttpRequest ) {
                    if ( XMLHttpRequest.statusText != "abort" ) {
                        console.error( 'err' );
                    }
                }
            } );

        },
        _ajaxCouponRequest = function () {

            _request.abort();

            _request = $.ajax({
                url: _url,
                data: {
                    action: 'apply_coupon_to_order',
                    coupon_name: _couponInput.val()
                },
                dataType: 'json',
                type: 'GET',
                success: function ( data ) {
                    _checkCoupon( data );
                },
                error: function ( XMLHttpRequest ) {
                    if ( XMLHttpRequest.statusText != "abort" ) {
                        console.error( 'err' );
                    }
                }
            });

        },
        _checkCoupon = function( data ){

            if ( data.status >= 1 ) {

                _couponMessage.html( data.message +'. Discount:'+ data.discount );
                _couponForm.remove();

                _setTotalValue( data );


            } else {

                var timer;

                _couponMessage.html( 'Wrong promo code. Try again' ).addClass( 'is-show' );

                timer = setTimeout( function () {
                    _couponMessage.removeClass( 'is-show' );
                    clearTimeout( timer );
                }, 2500 );

            }

            _obj.removeClass( 'is-loading' );

        },
        _setTotalValue = function( data ) {

            _totalWrap.html( $( data.total ).text()  );
            BasketUpdate( data.total );

        },
        _construct = function() {
            _onEvents();
        };

    _construct()
};

var ChangeBookLanguage = function ( obj ) {

    var _obj = obj,
        _bookPictureWrap = _obj.find( '.book__picture' ),
        _bookPicture = _bookPictureWrap.find( 'img' ),
        _languageWrap = _obj.find( '.book__language' ),
        _languageItem = _languageWrap.find( 'input' ),
        _addCartBtn = _obj.find( '.ajax-add-to-cart' );

    var _onEvents = function() {

            _languageItem.on( 'click', function () {
                _changeLanguage( $( this ) );
            } );

        },
        _changeLanguage = function( obj ) {

            var curItem = obj,
                curId = curItem.val();

            _bookPicture.addClass( 'hide' );
            _bookPicture.filter( '[data-id='+ curId +']' ).removeClass( 'hide' );

            _addCartBtn.attr( 'data-id', curId )

        },
        _construct = function() {
            _onEvents();
            _languageItem.eq(0).trigger( 'click' );
        };

    _construct()
};

var InitJoinUsSlider = function (obj) {

    //private properties
    var _obj = obj,
        _swiperSliser = _obj.find( '.swiper-container' ),
        _swiper;

    //private methods
    var _initSlider = function () {

            _swiper = new Swiper( _swiperSliser, {
                effect: 'slide',
                speed: 500,
                loop: true,
                threshold: 10,
                spaceBetween: 20,
                slidesPerView: 'auto',
                centeredSlides: true
            } );


        },
        _construct = function() {
            _initSlider();
        };

    //public properties

    //public methods

    _construct();

};

var InitScroll = function ( obj ) {

    var _obj = obj,
        _categoriesFrame = _obj.find( '.categories__wrap' ),
        _ps = null,
        _scrollWrap,
        _window = $( window );

    var _initScroll = function() {

            if ( _ps !== null ) {
                _ps.destroy();
                _ps = null;
            }

            _scrollWrap = document.querySelector( '.categories__wrap' );

            if ( _categoriesFrame.outerWidth() > _window.outerWidth() ) {

                _ps = new PerfectScrollbar( _scrollWrap, {
                    suppressScrollY: true
                } );

                _scrollToActive();

            }

        },
        _onEvent = function () {

            _window.on( 'resize', function () {
                _initScroll();
            } );

        },
        _scrollToActive = function () {

            var activeItem = _categoriesFrame.find( '.is-active' );

            if ( activeItem.length > 0 ){

                var windowWidth = _window.outerWidth(),
                    wrapWidth = activeItem.offset().left;

                _scrollWrap.scrollLeft = wrapWidth/2 - windowWidth/2 + wrapWidth;

            }

        },
        _construct = function() {
            _onEvent();
            _initScroll();
        };

    _construct()
};

var InitSlider = function (obj) {

    //private properties
    var _obj = obj,
        _swiperSliser = _obj.find( '.swiper-container' ),
        _swiperSlide = _obj.find( '.swiper-slide' ),
        _swiperPagination = _obj.find( '.pagination' ),
        _window = $( window ),
        _swiper,
        _isMobileSlider = false;

    //private methods
    var _onEvent = function () {

            _window.on( 'resize', function () {
                _updateSlider();
            } );

        },
        _initSlider = function () {

            if ( _swiperSlide.length === 1 ){
                return false
            }

            if ( _window.outerWidth() >= 768 ) {

                _isMobileSlider = false;

                _swiper = new Swiper( _swiperSliser, {
                    effect: 'fade',
                    speed: 300,
                    loop: true,
                    slidesPerView: 1,
                    threshold: 10,
                    autoplay: {
                        delay: 5000,
                        disableOnInteraction: true
                    },
                    pagination: {
                        el: _swiperPagination,
                        clickable: true
                    }
                } );

            } else if ( _window.outerWidth() < 768 ) {

                _isMobileSlider = true;

                _swiper = new Swiper( _swiperSliser, {
                    effect: 'fade',
                    speed: 300,
                    loop: true,
                    slidesPerView: 1,
                    threshold: 10,
                    autoHeight: true,
                    pagination: {
                        el: _swiperPagination,
                        clickable: true
                    }
                } );

            }

        },
        _updateSlider = function() {

            if ( _window.outerWidth() >= 768 && _isMobileSlider ) {

                _swiper.destroy( true, true );
                _initSlider();

            } else if ( _window.outerWidth() < 768 && !_isMobileSlider ) {

                _swiper.destroy( true, true );
                _initSlider();

            } else {

                setTimeout( function () {
                    _swiper.update( );
                } );

            }

        },
        _construct = function() {
            _onEvent();
            _initSlider();
        };

    //public properties

    //public methods

    _construct();

};

var InitSocialShare = function ( obj ) {

    //private properties
    var _socialWrap = obj,
        _socialData = _socialWrap.data( 'social' ),
        _socialItem = _socialWrap.find( '.social_item' );

    //private methods
    var _initShare = function () {

            _socialItem.each( function () {

                $( this ).ShareLink( {
                    title: unescape( _socialData[ 'title' ] ),
                    text: unescape(  _socialData[ 'text' ] ),
                    image: _socialData[ 'image' ],
                    url: _socialData[ 'url' ],
                    width: 640,
                    height: 480
                } );

            } );

        },
        _construct = function() {
            _initShare();
        };

    //public properties

    //public methods

    _construct();

};

var InitTableScroll = function ( obj ) {

    var _obj = obj,
        _tableFrame = _obj.find( '.orders__wrap' ),
        _ps = null,
        _window = $( window );

    var _initScroll = function() {

            if ( _tableFrame.outerWidth() >= _window.outerWidth() ) {

                var scrollWrap = document.querySelector( '.orders' );

                _ps = new PerfectScrollbar( scrollWrap, {
                    suppressScrollY: true
                } );

            }

        },
        _construct = function() {
            _initScroll();
        };

    _construct()
};

var FixHeader = function( obj ) {

    //private properties
    var _header = obj,
        _mobileFixedSection = _header.find( '.site__header-fixed' ),
        _desktopFixedSection = _header.find( '.site__header-wrap' ),
        _fixedWrap = null, _startPoint = null, _curDeviseSize = 0,
        _window = $( window );

    //private methods
    var _onEvent = function() {

            _window.on( {
                'resize': function () {
                    _checkFixedWrap();
                },
                'scroll': function () {
                    _checkPosition();
                }
            } );

        },
        _checkPosition = function () {
            _window.scrollTop() > _startPoint ? _fixHeader() : _unfixHeader()
        },
        _fixHeader = function () {
            _fixedWrap.addClass( 'is-fixed' )
        },
        _unfixHeader = function () {
            _fixedWrap.removeClass( 'is-fixed' )
        },
        _checkFixedWrap = function() {

            if ( _curDeviseSize !== 0 && ( ( _window.outerWidth() < 1200 && _curDeviseSize < 1200 ) ||
                ( _window.outerWidth() >= 1200 && _curDeviseSize >= 1200 ) ) ){
                return false;
            } else if ( _fixedWrap !== null ){
                _fixedWrap.removeClass( 'is-fixed' );
            }

            if ( _window.outerWidth() >= 1200  ) {
                _fixedWrap = _desktopFixedSection;
                _startPoint = 253;
            } else {
                _fixedWrap = _mobileFixedSection;
                _startPoint = 0;
            }

            _curDeviseSize = _window.outerWidth();

            _checkPosition();

        },
        _construct = function() {
            _onEvent();
            _checkFixedWrap();
        };

    //public properties

    //public methods

    _construct();
};

var FreeRecipesSection = function( obj ) {

    //private properties
    var _obj = obj,
        _options = _obj.data( 'options' ) || {"is_save_category":"false","is_save_page":"false","is_show_title":"false"},
        _optionsSaveCategory = ( _options['is_save_category'] === 'true' ) || false,
        _optionsShowFilterAsDefault = ( _options['show_as_default'] === 'true' ) || false,
        _optionsSavePage = ( _options['is_save_page'] === 'true' ) || false,
        _optionsShoveTitle = ( _options['is_show_title'] === 'true' ) || false,
        _categoriesFrame = _obj.find( '.free-recipes__categories-wrap' ),
        _categoriesItem = _categoriesFrame.find( '.free-recipes__categories-item' ),
        _catalogFrame = _obj.find( '.free-recipes__catalog' ),
        _catalogWrap = _catalogFrame.find( '.free-recipes__catalog-wrap' ),
        _pagination = _obj.find( '.free-recipes__pagination' ),
        _window = $( window ),
        _url = $( 'body' ).data( 'action' ),
        _ifFirstPage = true,
        _scrollWrap,
        _request = new XMLHttpRequest(),
        _ps = null, _recipesStorage = {},
        _isInitialFilterSetting = true;
        
    //private methods
    var _onEvent = function() {

            _window.on( 'resize', function () {
                _updateStyles();
                _initMobileCatalogScroll();
            } );

            _categoriesItem.on( 'click', function () {
                _changeCategory( $( this ), 1 );
                return false;
            } );

        },
        _activeAtFirstTime = function () {
            
            if ( _optionsSaveCategory || _optionsSavePage ) {
                
                if (!_optionsShowFilterAsDefault) {

                    var storage = JSON.parse( localStorage.getItem( 'FreeRecipes' ) );
               
                }

            }

            if ( storage == null || _optionsShowFilterAsDefault ){
            
                _categoriesItem.eq(0).trigger( 'click' );
            } else {
                var activeCategory = storage[ 'categoriesID' ] || _categoriesItem.eq(0).data( 'id' ),
                    activePage = storage[ 'page' ] || 1;

                _changeCategory( _categoriesItem.filter( '[data-id='+ activeCategory +']' ), activePage );
            }

        },
        _ajaxRequest = function ( id, page ) {

            _request.abort();

            _request = $.ajax( {
                url: _url,
                data: {
                    action: 'get_recipes_by_taxonomy',
                    page: page,
                    taxId: id
                },
                dataType: 'json',
                type: 'POST',
                success: function ( data ) {
                    _setGallery( data );
                },
                error: function ( XMLHttpRequest ) {
                    if ( XMLHttpRequest.statusText != "abort" ) {
                        console.error( 'err' );
                    }
                }
            } );

        },
        _initMobileCatalogScroll = function () {

            _scrollWrap = document.querySelector( '.free-recipes__categories-wrap' );

            if ( _ps === null && _categoriesFrame.outerWidth() > _window.outerWidth() ) {

                _ps = new PerfectScrollbar( _scrollWrap, {
                    suppressScrollY: true
                } );

                _scrollToActive();

            } else if ( _ps !== null && _categoriesFrame.outerWidth() <= _window.outerWidth() ) {

                _ps.destroy();
                _ps = null;

                _initMobileCatalogScroll();

            } else if ( _ps !== null ){

                _scrollToActive();

            }

        },
        _createItemFrame = function ( data ) {

            var recipesItem = data,
                recipesItemLink = recipesItem.link,
                recipesItemImage = recipesItem.image,
                recipesItemTitle = recipesItem.title,
                recipesFrameTitle = '',
                frameItem;

            if ( _optionsShoveTitle ) {
                recipesFrameTitle = '<div>'+ recipesItemTitle +'</div>';
            }

            frameItem = '<a href="'+ recipesItemLink +'" class="free-recipes__item">' +
                '<div class="free-recipes__picture">' +
                '<img src="'+ recipesItemImage +'" alt="'+ recipesItemTitle +'" />' +
                '</div>' + recipesFrameTitle + '</a>';

            return frameItem;

        },
        _changeCategory = function ( btn, page ) {
            
            var curBtn = btn,
                curPage = page;

            _categoriesItem.removeClass( 'is-active' );
            curBtn.addClass( 'is-active' );

            if ( _optionsSaveCategory ) {
                _recipesStorage['categoriesID'] = curBtn.data('id');
                _recipesStorage['page'] = curPage;

                if (!_optionsShowFilterAsDefault && !_isInitialFilterSetting) {
                    localStorage.setItem('FreeRecipes', JSON.stringify(_recipesStorage));
                    _isInitialFilterSetting = false
                }
   
            }

            if (_isInitialFilterSetting) {
                _isInitialFilterSetting = false
            }

            if ( !_optionsSavePage ){ curPage = 1 }

            _preparationFrame();
            _ajaxRequest( curBtn.data( 'id' ), curPage );

        },
        _changePage = function ( btn ) {

            var curBtn = btn,
                curCategories = _categoriesItem.filter( '.is-active' ),
                pageBtn = _pagination.find( 'span' );

            pageBtn.removeClass( 'is-active' );
            curBtn.addClass( 'is-active' );

            _catalogFrame.addClass( 'load load-page' );
            _catalogWrap.empty();

            if ( _optionsSaveCategory ){
                _recipesStorage[ 'categoriesID' ] = curCategories.data( 'id' );
                _recipesStorage[ 'page' ] = curBtn.attr( 'data-page' );

                localStorage.setItem( 'FreeRecipes', JSON.stringify( _recipesStorage ) );
            }

            _ajaxRequest( curCategories.data( 'id' ), curBtn.attr( 'data-page' ) );

        },
        _preparationFrame = function () {

            _catalogFrame.addClass( 'load' );

            _catalogWrap.empty();
            _pagination.empty();

            _ifFirstPage = true;

        },
        _setGallery = function ( data ) {

            if( data.recipes == undefined ){
                return false;
            }

            var recipes = data.recipes,
                totalPages = data.maxPages,
                recipesTotal = recipes.length,
                columns = 2,
                numberInColl = Math.round( recipesTotal / columns ),
                extraNumber = Math.abs( recipesTotal - numberInColl * columns ),
                columnFrame = $( '<li/>' ),
                curItem = 0, curColumn = 1;

            $.each( recipes, function( index ) {

                curItem = Math.floor( ( index + 1 ) / curColumn );

                var recipesItem = _createItemFrame( this );

                columnFrame.append( recipesItem );

                if ( curItem >= numberInColl ){
                    _catalogWrap.append( columnFrame );
                    columnFrame = $( '<li/>' );
                    curColumn ++;
                }

                if ( index === recipesTotal - 1 ){

                    if ( extraNumber > 0 ) {
                        _catalogWrap.append( columnFrame );
                    }

                    _setStyles();

                }

            } );

            if ( totalPages > 1 && _ifFirstPage ){
                _setPagination( totalPages );
                _ifFirstPage = false;
            }

        },
        _scrollToActive = function () {

            var activeItem = _categoriesFrame.find( '.is-active' );

            if ( activeItem.length > 0 ){

                var windowWidth = _window.outerWidth(),
                    wrapWidth = activeItem.offset().left;

                _scrollWrap.scrollLeft = wrapWidth/2 - windowWidth/2 + wrapWidth;

            }

        },
        _setStyles = function () {

            var image = _catalogWrap.find( 'img' ),
                totalImages = image.length,
                curItem = 1;

            image.on ( 'load', function () {

                var curPicture = $( this ),
                    curPictureFrame = curPicture.parent( '.free-recipes__picture' ),
                    frameHeight = curPicture.outerHeight(),
                    pictureHeight = curPictureFrame.outerHeight();

                if ( pictureHeight > frameHeight ) {
                    curPicture.css( {
                        'width': 'auto',
                        'height': '100%'
                    } )
                } else {
                    curPicture.removeAttr( 'style' );
                }

                if ( curItem === totalImages ) {
                    _catalogFrame.css( 'height', _catalogWrap.outerHeight() );
                    _catalogFrame.removeClass( 'load load-page' );
                }

                curItem++

            } );

        },
        _updateStyles = function () {

            var image = _catalogWrap.find( 'img' ),
                totalImages = image.length;

            image.each ( function ( index ) {

                var curPicture = $( this );

                curPicture.removeAttr( 'style' );

                var curPictureFrame = curPicture.parent( '.free-recipes__picture' ),
                    frameHeight = curPicture.outerHeight(),
                    pictureHeight = curPictureFrame.outerHeight();

                if ( pictureHeight > frameHeight ) {

                    curPicture.css( {
                        'width': 'auto',
                        'height': '100%'
                    } )
                }

                if ( index + 1 === totalImages ) {
                    _catalogFrame.css( 'height', _catalogWrap.outerHeight() );
                }

            } );

        },
        _setPagination = function ( pages ) {

            var totalPages = pages;

            for( var i = 1; i <= totalPages; i++ ){
                _pagination.append( '<span data-page="'+ i +'"></span>' )
            }

            var pageBtn = _pagination.find( 'span' );

            pageBtn.on( 'click', function () {
                _changePage( $( this ) )
            } );
            
            var activePage = _recipesStorage[ 'page' ]

            if (!activePage) {
                activePage = 1
            }

            pageBtn.filter( '[data-page='+ activePage +']' ).addClass( 'is-active' );

        },
        _construct = function() {
            _onEvent();
            _initMobileCatalogScroll();
            _activeAtFirstTime();
        };

    //public properties

    //public methods

    _construct();
};

var MobileMenu = function( obj ) {

    //private properties
    var _obj = obj,
        _menuWrap = _obj.find( 'ul' ),
        _mobileBtn = $( '.hamburger' ),
        _html = $( 'html' ),
        _body = $( 'body' ),
        _site = _body.find( '.site' ),
        _window = $( window ),
        _position = 0;

    //private methods
    var _onEvent = function() {

            _site.on( 'click', function ( e ) {

                if ( _obj.hasClass( 'is-show' ) && $( e.target ).closest( _menuWrap ).length === 0 ){
                    _hideMobileMenu();
                }

            } );

            _mobileBtn.on( 'click', function () {

                if ( $( this ).hasClass( 'is-active' ) ){
                    _hideMobileMenu();
                } else {
                    _showMobileMenu();
                }

                return false;
            } );

        },
        _hideMobileMenu = function () {

            _mobileBtn.removeClass( 'is-active' );

            _obj.removeClass( 'is-show' );

            _html.removeAttr( 'style' );
            _body.removeAttr( 'style' );
            _site.removeAttr( 'style' );

            _window.scrollTop( _position );

        },
        _showMobileMenu = function () {

            _mobileBtn.addClass( 'is-active' );

            _obj.addClass( 'is-show' );

            _position = _window.scrollTop();

            _html.css( 'overflow-y', 'hidden' );
            _body.css( 'overflow-y', 'hidden' );

            _site.css( {
                'position': 'relative',
                'top': _position * -1
            } );

        },
        _construct = function() {
            _onEvent();
        };

    //public properties

    //public methods

    _construct();
};

var OfferTimer = function ( obj ) {

    //private properties
    var _obj = obj,
        _millisecondsInSecond = 1000,
        _millisecondsInMinute = _millisecondsInSecond * 60,
        _millisecondsInHour = _millisecondsInMinute * 60,
        _millisecondsInDay = _millisecondsInHour * 24,
        _daysFrame = _obj.find( '.flash-sales__timer-days' ),
        _hoursFrame = _obj.find( '.flash-sales__timer-hours' ),
        _minutesFrame = _obj.find( '.flash-sales__timer-minutes' ),
        _secondsFrame = _obj.find( '.flash-sales__timer-seconds' ),
        _days = 0, _hours = 0, _minutes = 0,
        _stopped = false,

        _lastMoment = _obj.data( 'time-out' );

    //private methods
    var _onEvent = function () {

        },
        _setTimer = function () {

            var difference = new Date( _lastMoment ) - new Date();

            if( difference > 0 ){

                var days, hours, minutes, seconds;

                days =  Math.floor( difference / _millisecondsInDay );
                hours =  Math.floor( ( difference - ( days * _millisecondsInDay ) ) / _millisecondsInHour );
                minutes = Math.floor( ( difference - ( ( days * _millisecondsInDay ) + ( hours * _millisecondsInHour ) ) ) / _millisecondsInMinute );
                seconds = Math.floor( ( difference - ( ( days * _millisecondsInDay ) + ( hours * _millisecondsInHour ) + ( minutes * _millisecondsInMinute ) ) ) / _millisecondsInSecond );

                _setClockFace( seconds, _secondsFrame );

                if ( _minutes !== minutes ){
                    _minutes = minutes;
                    _setClockFace( minutes, _minutesFrame );

                    if ( _hours !== hours ){
                        _hours = hours;
                        _setClockFace( hours, _hoursFrame );

                        if ( _days !== days ){
                            _days = days;
                            _setClockFace( days, _daysFrame );
                        }

                    }

                }

                if ( _days == 0 ) {
                    _daysFrame.parents( '.flash-sales__clock-face' ).remove();
                }

            } else if( difference <= 0 ) {
                _stopped = true;
                _obj.addClass( 'is-hide' ).remove()
            }

        },
        _loop = function(){

            _setTimer();

            if( !_stopped ) {
                requestAnimationFrame( _loop );
            }

        },
        _setClockFace = function ( val, obj ) {

            var cutIntTime = val,
                cutStrTime = ''+ cutIntTime,
                time = [];

            if ( cutIntTime < 10 ){
                cutIntTime = '0' + val;
                time = cutIntTime.split('');
            } else {
                time = cutStrTime.split('');
            }

            obj.html( '<span>'+ time[0] +'</span><span>'+ time[1] +'</span>' )

        },
        _construct = function() {
            _onEvent();
            _loop();
        };

    //public properties

    //public methods

    _construct();

};

var OpenItems = function( obj ) {

    //private properties
    var _obj = obj,
        _item = _obj.find( '.faq-wrap__item' ),
        _tabs = $( '.tabs' ),
        _site = $( '.site' );

    //private methods
    var _onEvent = function () {

            _site.on( 'click', function ( e ) {

                if ( $( e.target ).closest( _item ).length == 0 ){
                    _item.removeClass( 'is-open' );
                }

            } );

            _item.on( {
                'click': function () {
                    _openItem( $( this ) );
                },
                'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend': function() {

                    if ( _tabs.length > 0 ){
                        _tabs[0].obj.setHeight();
                    }

                }
            } );

        },
        _openItem = function ( obj ) {

            var curItem = obj;

            if ( curItem.hasClass( 'is-open' ) ){
                _item.removeClass( 'is-open' );
            } else {
                _item.removeClass( 'is-open' );
                curItem.addClass( 'is-open' );
            }


        },
        _construct = function() {
            _onEvent();
        };

    //public properties

    //public methods

    _construct();

};

var Preloader = function (obj) {

    //private properties
    var _preloader = obj;

    //private methods
    var _showSite = function() {

        _preloader.addClass( 'preload_loaded' );

        _preloader.on( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function() {
            _preloader.remove();
        } );

    };

    //public properties

    //public methods

    _showSite();

};

var ReviewsItems = function( obj ){

    //private properties
    var _obj = obj,
        _swiperSliser = _obj.find( '.swiper-container' ),
        _item = _obj.find( 'li' ),
        _swiperPagination = $( '<div class="reviews__slider-pagination pagination"></div>' ),
        _count = 5,
        _swiper;

    //private methods
    var _onEvents = function(){

        },
        _checkQuantity = function(){

            if( _item.length <= _count ){ return false }

            var maxCount = 0;

            $.each( _item, function( index ) {

                maxCount = Math.ceil( ( index + 1 ) / _count );

                $( this ).attr( 'data-count', maxCount );

            } );

            for( var n = 0; n <= maxCount; n++ ){
                _item.filter( '[data-count="'+ n +'"]' ).wrapAll( '<ul class="swiper-slide"></ul>' )
            }

            _swiperSliser.append( _swiperPagination );
            _swiperPagination = _swiperSliser.find( '.reviews__slider-pagination' );

            _swiper = new Swiper( _swiperSliser, {
                speed: 300,
                loop: false,
                slidesPerView: 1,
                threshold: 10,
                spaceBetween: 80,
                autoHeight: true,
                pagination: {
                    el: _swiperPagination,
                    clickable: true
                }
            } );

        },
        _construct = function(){
            _onEvents();
            _checkQuantity();
        };

    //public properties

    //public methods

    _construct();

};

var SearchForm = function( obj ) {

    //private properties
    var _obj = obj,
        _searchForm = _obj.find( '.search__form' ),
        _searchHook = _searchForm.data( 'action' ),
        _searchInput = _searchForm.find( 'input' ),
        _searchPopup = _obj.find( '.search__popup' ),
        _searchPopupScrollWrap = _searchPopup.find( '.search__popup-scroll-wrap' ),
        _resultWrap = _searchPopup.find( '.search__result' ),
        _url = $( 'body' ).data( 'action' ),
        _site = $( '.site' ),
        _ps = null,
        _timer = null,
        _witchLetterStat = 2,
        _request = new XMLHttpRequest();

    //private methods
    var _onEvent = function () {

            _site.on( 'click', function ( e ) {

                if ( _searchPopup.hasClass( 'is-show' ) && $( e.target ).closest( _obj ).length == 0 ){
                    _hidePopup();
                }

            } );

            _searchInput.on ( 'keyup', function( e ) {

                var symbolNumber = _searchInput.val().length;

                switch ( e.keyCode ) {
                    case 27:
                        _hidePopup();
                        break;
                    case 13, 27, 37, 38, 39, 40:
                        (e).preventDefault();
                        break;
                    default:
                        if( symbolNumber > _witchLetterStat ){

                            _request.abort();
                            clearTimeout( _timer );

                            _timer = setTimeout( function () {
                                _searchForm.hasClass( 'is-show' ) ? _ajaxRequest() : _showPopup();
                            }, 500 );

                        } else if ( symbolNumber <= _witchLetterStat ) {

                            _request.abort();
                            clearTimeout( _timer );
                            _hidePopup();

                        }
                }

            } );

        },
        _ajaxRequest = function () {

            _searchPopup.addClass( 'is-loading' );

            _request.abort();

            _request = $.ajax( {
                url: _url,
                data: {
                    action: _searchHook,
                    search_value: _searchInput.val()
                },
                dataType: 'json',
                type: 'POST',
                success: function ( data ) {
                    _loadData( data );
                },
                error: function ( XMLHttpRequest ) {
                    if ( XMLHttpRequest.statusText != "abort" ) {
                        console.error( 'err' );
                    }
                }
            } );

        },
        _loadData = function ( data ) {

            var info;

            if ( _searchHook === 'get_posts_autocomplete' ){
                info = data.blog;
            } else if ( _searchHook === 'get_recipes_autocomplete' ) {
                info = data.recipes;
            }

            _resultWrap.empty();

            if ( !info ){
                _searchPopup.addClass( 'is-empty' );
                _searchPopup.removeClass( 'is-loading' );
                return false;
            }

            var recipesTotal = info.length;

            if ( recipesTotal !== 0 ){

                _searchPopup.removeClass( 'is-empty' );

                $.each( info, function( index ) {

                    var recipesItem = _createItemFrame( this );

                    _resultWrap.append( recipesItem );

                    if ( index === recipesTotal - 1 ){

                        _searchPopup.removeClass( 'is-loading' );

                        var image = _resultWrap.find( 'img' );

                        image.on( 'load', function () {
                            _setWrapHeight();
                        } );

                    }

                } );

            } else {
                _searchPopup.addClass( 'is-empty' );
                _searchPopup.removeClass( 'is-loading' );
            }

        },
        _createItemFrame = function ( data ) {

            var recipesItem = data,
                recipesItemLink = recipesItem.link,
                recipesItemImage = recipesItem.image,
                recipesItemTitle = recipesItem.title,
                recipesItemCookingTime = recipesItem.cookingTime,
                frameItem = null;

            if ( _searchHook === 'get_posts_autocomplete' ){

                frameItem = '<a href="'+ recipesItemLink +'" class="search__result-item">' +
                    '<div class="search__result-picture">' +
                    '<img src="'+ recipesItemImage +'" alt="'+ recipesItemTitle +'" />' +
                    '</div>' +
                    ' <div class="search__result-text">' +
                    '<p>'+ recipesItemTitle +'</p>' +
                    '</div></a>';

            } else if ( _searchHook === 'get_recipes_autocomplete' ) {

                frameItem = '<a href="'+ recipesItemLink +'" class="search__result-item">' +
                    '<div class="search__result-picture">' +
                    '<img src="'+ recipesItemImage +'" alt="'+ recipesItemTitle +'" />' +
                    '</div>' +
                    ' <div class="search__result-text">' +
                    '<p>'+ recipesItemTitle +'</p>' +
                    '<p>'+ recipesItemCookingTime +'</p>' +
                    '</div></a>';

            };

            return frameItem;

        },
        _showPopup = function () {

            _searchPopup.addClass( 'is-show' );
            _ajaxRequest();

        },
        _setWrapHeight = function () {

            _searchPopup.css( 'height', _resultWrap.outerHeight() + 37 );

            _searchPopup.on( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function () {
                if ( _ps == null ){
                    _initScroll();
                } else {
                    _ps.update();
                }
                _searchPopup.off( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend' );
            } );

        },
        _hidePopup = function () {

            if ( !_searchPopup.hasClass( 'is-show' ) ){
                return false;
            }

            _searchPopup.removeClass( 'is-show' );

            _searchPopup.on( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function() {
                _resultWrap.empty();

                if ( _ps !== null ) {
                    _ps.destroy();
                    _ps = null;
                }

                _searchPopup.off( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend' );

            } );


        },
        _initScroll = function () {

            if ( _searchPopupScrollWrap.outerHeight() > _searchPopup.outerHeight() - 37 ){

                var searchPopupScrollWrap = document.querySelector( '.search__popup-scroll-wrap' );

                _ps = new PerfectScrollbar( searchPopupScrollWrap, {
                    suppressScrollX: true
                } );

            }

        },
        _construct = function() {
            _onEvent();
        };

    //public properties

    //public methods

    _construct();

};

var SetSizeIframe = function (obj) {

    //private properties
    var _obj = obj,
        _window = $( window );

    //private methods
    var _onEvent = function() {

            _window.on( 'resize', function () {
                _setSize();
            } );

        },
        _setSize = function () {

            _obj.css( 'height', _obj.outerWidth() / 1.78 + 'px' );

        },
        _construct = function() {
            _onEvent();
            _setSize();
        };

    //public properties

    //public methods

    _construct();

};

var SiteDeco = function ( obj ) {

    var _obj = obj,
        _objPosition = $( '.'+ _obj.data( 'position' ) ).offset().top - _obj.outerHeight() / 4,
        _window = $( window );

    var _onEvent = function () {

            _window.on( 'scroll', function () {
                _paralax();
            } );

        },
        _paralax = function() {

            var curPosition = _window.scrollTop() + _window.outerHeight();

            if ( curPosition >= _objPosition ){
                _obj.css( 'transform', 'translateY('+ ( curPosition - _objPosition ) * -.3  +'px)' );

                var opacity = 1 - ( ( _window.scrollTop() - _obj.offset().top ) / ( _obj.outerHeight() / 1.33 ) );

                if ( 1 > opacity && opacity > 0  ) {
                    _obj.css( 'opacity', opacity );
                }

            }

        },
        _setPosition = function() {

            _obj.css( {
                'top': _objPosition
            }, 600);

        },
        _construct = function() {
            _onEvent();
            _setPosition();
            _paralax();
        };

    _construct()
};

var Stars = function( obj ){

    //private properties
    var _obj = obj,
        _item = _obj.find( 'a' ),
        _active = null;

    //private methods
    var _onEvents = function(){

            _item.on( {
                'mouseover': function() {
                    _item.removeClass( 'active prev' );
                    _hoverStars( $(this).index(), 'hover' );
                },
                'mouseleave': function() {
                    _item.removeClass( 'hover' );

                    if ( _active !== null ){
                        _hoverStars( _active, 'prev' );
                        _item.eq( _active ).addClass( 'active' );
                    }

                },
                'click': function () {
                    _item.removeClass( 'prev' );
                    _active = $(this).index();
                    _hoverStars( $(this).index(), 'prev' );
                }
            } );

        },
        _hoverStars = function( item, name ){

            for( var n = 0; n <= item; n++ ){
                _item.eq( n ).addClass( name );
            }

        },
        _construct = function(){
            _onEvents();
        };

    //public properties

    //public methods

    _construct();

};

var SwiperPopup = function ( obj, index ) {

    var _obj = obj,
        _html = $( 'html' ),
        _body = $( 'body' ),
        _site = $( '.site' ),
        _links = _obj.find( '.book__gallery-item' ),
        _window = $( window ),
        _popup = null,
        _popupInner = null,
        _popupClose = null,
        _swiperWrapper = null,
        _swiperContainer = null,
        _swiperBtnNext = null,
        _swiperBtnPrev = null,
        _swiper = null,
        _position = 0;

    var _addEvents = function(){

            _popupInner.parent().on( 'click', function() {
                _closePopup();
            } );

            _popupInner.on( 'click', function( event ) {
                event.stopPropagation();
            } );

            _popupClose.on( 'click', function() {
                _closePopup();
                return false;
            } );

        },
        _addingVariables = function(){

            _popup = $( '<div class="swiper-popup">\
                                    <div class="swiper-container">\
                                        <a href="#" class="swiper-popup__close"></a>\
                                        <div class="swiper-wrapper"></div>\
                                        <div class="swiper-button-next"></div>\
                                        <div class="swiper-button-prev"></div>\
                                    </div>\
                                </div>' );
            _swiperWrapper = _popup.find( '.swiper-wrapper' );
            _swiperContainer = _popup.find( '.swiper-container' );
            _swiperBtnNext = _popup.find( '.swiper-button-next' );
            _swiperBtnPrev = _popup.find( '.swiper-button-prev' );

        },
        _buildPopup = function(){

            _addingVariables();
            _contentFilling();
            _initSwiper();
            _swiper.slideTo( index, 0 );
            _popup.addClass( 'active' );
            _setStyles();

        },
        _closePopup = function(){

            _popup.removeClass( 'active' );

            _popup.on( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function() {

                _html.removeAttr( 'style' );
                _body.removeAttr( 'style' );
                _site.removeAttr( 'style' );

                _window.scrollTop( _position );
                _position = 0;

                _popup.remove();

            } );

        },
        _contentFilling = function(){

            $.each( _links, function(){

                var innerContent = null,
                    innerImg = null,
                    dataSRC = null,
                    innerTitle = null,
                    preloader = null;

                preloader = '';
                innerContent = $( this ).children( 'img' );
                innerImg = '<img src="' + innerContent.attr( 'src' ) + '">';
                dataSRC = '';

                var newItem = $( '<div class="swiper-slide">\
                                        <div class="swiper-popup__inner" ' + dataSRC + '>\
                                            ' + preloader + '\
                                            ' + innerImg + '\
                                        </div>\
                                    </div>' );

                _swiperWrapper.append( newItem );

            } );

            _body.append( _popup );

            _popupInner = _popup.find( '.swiper-popup__inner' );
            _popupClose = _popup.find( '.swiper-popup__close' );

        },
        _getScrollWidth = function (){

            var scrollDiv = document.createElement( 'div'),
                scrollBarWidth;

            scrollDiv.className = 'popup__scrollbar-measure';

            document.body.appendChild( scrollDiv );

            scrollBarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;

            document.body.removeChild(scrollDiv);

            return scrollBarWidth;

        },
        _initSwiper = function(){

            _swiper = new Swiper( _swiperContainer, {
                slidesPerView: 1,
                threshold: 10,
                navigation: {
                    nextEl: _swiperBtnNext,
                    prevEl: _swiperBtnPrev
                }
            });

        },
        _construct = function () {
            _buildPopup();
            _addEvents();
        },
        _setStyles = function(){

            if ( _window.scrollTop() !== 0 ){
                _position = _window.scrollTop();
            }

            _html.css( {
                overflowY: 'hidden',
                paddingRight: _getScrollWidth()
            } );

            _body.css( 'overflow-y', 'hidden' );

            _site.css( {
                'position': 'relative',
                'top': _position * -1
            } );

        };

    _construct();

};

var Tabs = function( obj ) {

    //private properties
    var _obj = obj,
        _self = this,
        _tabBtnWrap = _obj.find( '.tabs__items-wrap' ),
        _tabScrollContent = _tabBtnWrap.find( '.tabs__items-scroll' ),
        _tabBtn = _tabBtnWrap.find( '.tabs__item' ),
        _tabWrap = _obj.find( '.tabs__wrap' ),
        _tabContent = _tabWrap.find( '.tabs__content' ),
        _scrollWrap,
        _ps = null,
        _swiper = null,
        _window = $( window );

    //private methods
    var _onEvent = function() {

            _tabBtn.on( 'click', function () {
                var curBtn = $( this ),
                    curBtnIndex = curBtn.index();

                _showTabWrap( curBtnIndex );

            } );

            _window.on( 'resize', function () {
                _setContentHeight();
            } );

        },
        _showTabWrap = function ( num ) {

            var curTabIndex = num,
                curTabBtn = _tabBtn.eq( curTabIndex ),
                activeContent = _tabContent.eq( curTabIndex );

            _tabBtn.removeClass( 'is-active' );
            curTabBtn.addClass( 'is-active' );

            _tabContent.removeClass( 'is-show' );
            activeContent.addClass( 'is-show' );

            _setContentHeight();
            _initSlider();

        },
        _initSlider = function (  ) {

            var activeContent = _tabContent.filter( '.is-show' ),
                swiperSlider = activeContent.find( '.swiper-container' ),
                swiperSlide = activeContent.find( '.swiper-slide' );

            if ( swiperSlider === undefined || swiperSlider.length === 0 ) {

                if ( _swiper !== null ){
                    _swiper.destroy();
                    _swiper = null;
                }

                return false;

            }

            if ( _swiper == null && swiperSlide.length > 1 ) {

                var swiperPagination = _obj.find( '.pagination' );

                _swiper = new Swiper( swiperSlider, {
                    effect: 'slider',
                    speed: 500,
                    spaceBetween: 30,
                    loop: true,
                    slidesPerView: 1,
                    threshold: 10,
                    pagination: {
                        el: swiperPagination,
                        clickable: true
                    },
                    on: {
                        init: function () {

                            _setContentHeight();

                            var image = swiperSlide.eq(0).find( 'img' );

                            image.on ( 'load', function () {
                                _setContentHeight();
                            } );

                        }
                    }
                } );

            } else if ( swiperSlide.length == 1 ){

                var image = swiperSlide.find( 'img' );

                image.on ( 'load', function () {
                    _setContentHeight();
                } );

            }

        },
        _setContentHeight = function () {

            var activeContent = _tabContent.filter( '.is-show' );

            _tabWrap.css( 'height', activeContent.outerHeight() );

        },
        _initScroll = function () {

            if ( _ps !== null ) {
                _ps.destroy();
                _ps = null;
            }

            _scrollWrap = document.querySelector( '.tabs__items-scroll' );

            if ( _tabScrollContent.outerWidth() > _window.outerWidth() ) {

                _ps = new PerfectScrollbar( _scrollWrap, {
                    suppressScrollY: true
                } );

                _scrollToActive();

            }

        },
        _scrollToActive = function () {

            var activeItem = _tabBtnWrap.find( '.is-active' );

            if ( activeItem.length > 0 ){

                var windowWidth = _window.outerWidth(),
                    wrapWidth = activeItem.offset().left;

                _scrollWrap.scrollLeft = wrapWidth/2 - windowWidth/2 + wrapWidth;

            }

        },
        _checkActive = function () {

            var activeTabBtn = _tabBtn.filter( '.is-active' );

            if ( activeTabBtn.length > 0 ) {
                activeTabBtn.trigger( 'click' )
            } else {
                _tabBtn.eq( 0 ).trigger( 'click' );
            }

        },
        _construct = function() {
            _onEvent();
            _initScroll();
            _checkActive();

            _obj[0].obj = _self

        };

    //public properties

    //public methods
    _self.setHeight = function () {
        _setContentHeight();
    };

    _construct();
};

var TrueUser = function( obj ){

    //private properties
    var _obj = obj;

    //private methods
    var _construct = function(){
            localStorage.setItem( 'trueUser', true )
        };

    //public properties

    //public methods

    _construct();

};
$( function () {

    "use strict";

    $.each( $( '.contact-us__form' ), function() {
        new ContactForm ( $( this ) );
    } );

    $.each( $( '.contact-us__file-field' ), function() {
        new LabelFileItem ( $( this ) );
    } );

} );

var ContactForm = function( obj ){

    //private properties
    var _obj = obj,
        _btn = _obj.find( 'button' ),
        _url = $( 'body' ).data( 'action' ),
        _request = new XMLHttpRequest(),
        _validation = new FormValidator( _obj ),
        _popup = $( '.popup' ),
        _timer;

    //private methods
    var _construct = function(){
            _onEvent();
        },
        _onEvent = function(){

            _obj.on( 'submit', function (e) {
                e.preventDefault();

                _obj.addClass( 'is-loading' );

                if ( _validation.valid === true ) {
                    _ajaxSend();
                } else {
                    _obj.removeClass( 'is-loading' );
                }

            } );

        },
        _ajaxSend = function(){

            var formData = new FormData( _obj[0] );
            formData.append( 'action', 'send_contact_form' );

            _request = $.ajax( {
                url: _url,
                dataType: 'html',
                timeout: 20000,
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                cache: false,
                success: function (data) {
                    _showSuccessMessage();
                },
                error: function (XMLHttpRequest) {
                    if (XMLHttpRequest.statusText != 'abort') {
                        alert(XMLHttpRequest.statusText);
                    }
                }
            } );
            return false;

        },
        _showSuccessMessage = function () {

            _obj.removeClass( 'is-loading' );

            _obj[0].reset();
            $( '.contact-us__file-field' )[0].obj.emptyField();

            _popup[0].obj.openPopup( _btn );

            _timer = setTimeout( function () {
                _popup[0].obj.closePopup();
                clearTimeout( _timer );
                _timer = null;
            }, 5000 );

        };

    //public properties

    //public methods

    _construct();

};

var LabelFileItem = function( obj ) {

    //private properties
    var _obj = obj,
        _self = this,
        _labelText = _obj.find( 'span' ),
        _placeholder = _labelText.text(),
        _input = _obj.find( 'input[type=file]' );

    //private methods
    var _onEvent = function() {

            _input.on( 'change', function () {

                var name = _input.val();

                if ( name !== '' ) {

                    var format = name.split('.').pop();

                    if ( format == 'jpg' || format == 'png' || format == 'pdf' ) {

                        _labelText.text( name.split('\\').pop() );
                        _obj.addClass( 'is-full' );

                    } else {
                        _emptyField();
                    }

                } else {
                    _emptyField();
                }

            } );

        },
        _emptyField = function(){

            _labelText.text( _placeholder );
            _obj.removeClass( 'is-full' );

        },
        _init = function() {
            _onEvent();
            _obj[ 0 ].obj = _self;
        };

    //public properties

    //public methods
    _self.emptyField = function () {
        _emptyField();
    };

    _init();
};

var ZendeskCreateTicketForm = function( obj ){

    //private properties
    var _obj = obj,
        _nameFielder = _obj.find( 'input[name=subscribe-name]' ),
        _emailFielder = _obj.find( 'input[name=subscribe-email]' ),
        _subjectFielder = _obj.find( 'input[name=subscribe-subject]' ),
        _messageFielder = _obj.find( 'textarea[name=subscribe-message]' ),
        _fileFielder = _obj.find( 'input[type=file]' ),
        _url = $( 'body' ).data( 'action' ),
        _btn = _obj.find( 'button' ),
        _validation = new FormValidator( _obj ),
        _request = new XMLHttpRequest(),
        _popup = $( '.popup' ),
        _uploadFiles = null,
        _fileToken = null,
        _timer = null;

    //private methods
    var _construct = function(){
            _onEvent();
        },
        _onEvent = function(){

            _fileFielder.on( 'change', function (e) {
                _uploadFiles = e.target.files;
            } );

            _obj.on( 'submit', function (e) {
                e.preventDefault();

                _obj.addClass( 'is-loading' );

                if ( _validation.valid === true ) {

                    if ( _uploadFiles !== null && _uploadFiles.length > 0 ) {
                        _ajaxSendFile();
                    } else {
                        _ajaxCreateTicket();
                    }

                } else {
                    _obj.removeClass( 'is-loading' );
                }

            } );

        },
        _ajaxSendFile = function(){

            var formData = new FormData();

            formData.append( 'action', 'send_file' );

            $.each( _uploadFiles, function( key, value ) {
                formData.append( key, value );
            } );

            _obj.addClass( 'is-loading' );

            _request.abort();
            _request = $.ajax( {
                url: _url,
                dataType: 'json',
                timeout: 20000,
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                cache: false,
                success: function ( data ) {
                    _fileToken = data['upload']['token'];
                    _ajaxCreateTicket();
                },
                error: function (XMLHttpRequest) {
                    if (XMLHttpRequest.statusText != 'abort') {
                        alert(XMLHttpRequest.statusText);
                    }
                }
            } );
            return false;

        },
        _ajaxCreateTicket = function(){

            _request.abort();
            _obj.addClass( 'is-loading' );

            _request = $.ajax( {
                url: _url,
                dataType: 'json',
                timeout: 20000,
                type: "POST",
                data: {
                    action: 'subscribe_form',
                    name: _nameFielder.val(),
                    email: _emailFielder.val(),
                    subject: _subjectFielder.val(),
                    message: _messageFielder.val(),
                    file: _fileToken
                },
                success: function ( data ) {
                    _showSuccessMessage();
                },
                error: function (XMLHttpRequest) {
                    if (XMLHttpRequest.statusText != 'abort') {
                        alert(XMLHttpRequest.statusText);
                    }
                }
            } );
            return false;

        },
        _showSuccessMessage = function () {

            _obj.removeClass( 'is-loading' );
            _obj[0].reset();

            _popup[0].obj.openPopup( _btn );

            _timer = setTimeout( function () {
                _popup[0].obj.closePopup();
                clearTimeout( _timer );
                _timer = null;
            }, 5000 );

        };

    //public properties

    //public methods

    _construct();

};

var FormValidator = function (obj) {

    //private properties
    var _obj = obj,
        _self = this,
        _fields = _obj.find( '[required]:not(select)' ),
        _textInputs = _obj.find( 'input[type!=checkbox], textarea' ),
        _checkboxInputs = _obj.find( 'input[type=checkbox][required]' ),
        _citySelect = _obj.find( '.city-selector[data-required]' ),
        _select = _obj.find( 'select[required]' ),
        _multipleSelect = _obj.find( '.custom-multiple-select[data-required]' ),
        _multipleSelectOptions = _multipleSelect.find( 'input[type=checkbox]' ),
        _site = $( '#site' );

    //private methods
    var _construct = function () {
            _onEvents();
            _obj[ 0 ].obj = _self;
        },
        _addNotTouchedClass = function () {
            _fields.each( function() {

                var curItem = $(this);

                if( curItem.val() === '' ){
                    curItem.addClass( 'is-not-touched' );
                }

                if ( curItem.hasClass( 'is-valid' ) ){
                    curItem.removeClass( 'is-not-touched' );
                }

            } );
            _checkboxInputs.each( function() {

                var curItem = $(this);

                if ( !curItem.is( ':checked' ) ){
                    curItem.addClass( 'is-not-touched' )
                }

            } );
            _citySelect.each( function() {

                var curItem = $(this),
                    citySelectOptions = curItem.find( 'option' );

                if ( citySelectOptions.filter( ':selected' ).val() == 0 ){
                    $( this ).addClass( 'is-not-touched' )
                }

            } );
            _select.each( function() {

                var curItem = $(this),
                    selectOptions = curItem.find( 'option' );

                if ( selectOptions.filter( ':selected' ).val() == 0 ){
                    curItem.parents( '.select' ).addClass( 'is-not-touched' )
                }

            } );
            _multipleSelect.each( function() {

                var curItem = $(this),
                    multipleSelectOptions = curItem.find( 'input[type=checkbox]' );

                if ( multipleSelectOptions.filter( ':checked' ).length <= 0 ){
                    curItem.parents( '.multiple-select' ).addClass( 'is-not-touched' )
                }

            } );
        },
        _onEvents = function () {

            _site.on( 'click', function ( e ) {
                if ( $( e.target ).closest( _obj ).length === 0 ){
                    _checkFillingForm();
                }
            } );

            _fields.on( {
                'focus': function() {
                    $( this ).removeClass( 'is-not-touched' );
                },
                'focusout': function() {
                    _validateField( $( this ) );
                },
                'keyup': function () {

                    var curItem = $(this);

                    if ( curItem.hasClass( 'is-not-valid' ) ){
                        _validateField( curItem );
                    }

                }
            } );

            _textInputs.on( 'focusout', function() {
                _checkFillingForm();
            } );

            _multipleSelect.parents( '.multiple-select' ).on( {
                'click': function() {
                    $( this ).parents( '.multiple-select' ).removeClass( 'is-not-touched' );
                }
            } );

            _multipleSelectOptions.on( 'change', function() {
                if ( _multipleSelectOptions.filter( ':checked' ).length > 0 ){
                    _multipleSelect.parents( '.multiple-select' ).removeClass( 'is-not-touched' )
                }
            } );

            _citySelect.on( 'click', function() {
                $( this ).removeClass( 'is-not-touched' );
            } );

            _citySelect.find( 'select' ).on( 'change', function() {
                if ( $( this ).find( 'option' ).filter( ':selected' ).val() == 0 ){
                    $( this ).parents( '.city-selector' ).removeClass( 'is-not-touched' )
                }
            } );

            _select.parents( '.select' ).on( {
                'click': function() {
                    $( this ).removeClass( 'is-not-touched' );
                }
            } );

            _select.on( 'change', function() {
                if ( $( this ).find( 'option' ).filter( ':selected' ).val() == 0 ){
                    _select.parents( '.select' ).removeClass( 'is-not-touched' )
                }
            } );

            _obj.on( 'submit', function() {

                _addNotTouchedClass();

                if( _fields.hasClass( 'is-not-touched' ) ||
                    _fields.hasClass( 'is-not-valid' ) ||
                    _citySelect.hasClass( 'is-not-valid' ) ||
                    _select.parents( '.select' ).hasClass( 'is-not-valid' ) ||
                    _multipleSelect.parents( '.multiple-select' ).hasClass( 'is-not-touched' ) ) {

                    _self.valid = false;

                    return false;
                }

                _controlCheck();

                return false;

            } );

            _checkboxInputs.on( 'click', function() {

                var curItem = $(this);

                if ( curItem.is( ':checked' ) ){
                    curItem.addClass( 'is-valid' ).removeClass( 'is-not-touched' );
                } else {
                    curItem.removeClass( 'is-valid' );
                }

            } );

        },
        _checkFillingForm = function () {

            var letterCounter = 0;

            _textInputs.each( function () {

                var curItem = $(this);

                if ( curItem.val().length > 0 ){
                    letterCounter = letterCounter + 1
                }

            } );

            if ( letterCounter === 0 ) {
                _textInputs.removeClass( 'is-not-touched' );
                _textInputs.removeClass( 'is-not-valid' );
                _citySelect.removeClass( 'is-not-touched' );
                _select.parents( '.select' ).removeClass( 'is-not-touched' );
                _multipleSelect.parents( '.multiple-select' ).removeClass( 'is-not-touched' );
            }

        },
        _makeNotValid = function ( field ) {
            field.addClass( 'is-not-valid' );
            field.removeClass( 'is-valid' );
            _self.valid = false;
        },
        _makeValid = function ( field ) {
            field.removeClass( 'is-not-valid' );
            field.addClass( 'is-valid' );
            _controlCheck();
        },
        _validateEmail = function ( email ) {
            var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(email);
        },
        _validateField = function ( field ) {

            var type = field.attr( 'type' ),
                tagName = field[0].tagName;

            if( type === 'email' || type === 'text' ){
                if( field.val() === '' ){
                    _makeNotValid( field );
                    return false;
                }
            }

            if( type === 'email' ){
                if( !_validateEmail( field.val() ) ){
                    _makeNotValid( field );
                    return false;
                }
            }

            if( tagName.toLocaleLowerCase() === 'textarea' ){
                if( field.val() === '' ){
                    _makeNotValid( field );
                    return false;
                }
            }

            _makeValid( field );

        },
        _controlCheck = function () {

            if( _fields.filter( '.is-valid' ).length === _fields.length &&
                !_multipleSelect.parents( '.multiple-select' ).hasClass( 'is-not-touched' ) &&
                !_select.parents( '.select' ).hasClass( 'is-not-touched' ) &&
                !_citySelect.hasClass( 'is-not-touched' ) ) {
                _fields.removeClass( 'is-valid' );
                _self.valid = true;
            }

        };

    //public properties
    _self.valid = false;

    _construct();
};
$( function() {

    $( '.popup' ).each(function(){
        new Popup($(this));
    } );

} );

var Popup = function( obj ){
    //private properties
    var _self = this,
        _btnShow =  $( '.popup__open' ),
        _obj = obj,
        _popupWrap = _obj.find( '.popup__wrap' ),
        _popupContents = _obj.find( '.popup__content' ),
        _btnClose = _obj.find( '.popup__close, .popup__cancel' ),
        _siteHeader = $( '.site__header-layout' ),
        _videoFile, _productContent,
        _scrollConteiner = $( 'html' ),
        _body = $( 'body' ),
        _site = _body.find( '.site' ),
        _url = _body.data( 'action' ),
        _position = 0, _isOpen = false,
        _window = $( window ),
        _request = new XMLHttpRequest();

    //private methods
    var _getScrollWidth = function (){
            var scrollDiv = document.createElement( 'div'),
                scrollBarWidth;

            scrollDiv.className = 'popup__scrollbar-measure';

            document.body.appendChild( scrollDiv );

            scrollBarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;

            document.body.removeChild(scrollDiv);

            return scrollBarWidth;

        },
        _hidePopup = function(){

            _isOpen = false;

            _obj.addClass( 'is-hide' ).removeClass( 'is-opened' );

            _obj.on( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function() {

                _scrollConteiner.removeAttr( 'style' );
                _body.removeAttr( 'style' );
                _site.removeAttr( 'style' );
                _siteHeader.removeAttr( 'style' );
                _obj.removeAttr( 'style' );

                _window.scrollTop( _position );
                _position = 0;

                _obj.removeClass( 'is-hide' );

                if ( _videoFile != null ) {
                    _videoFile.remove();
                    _videoFile = null;
                }

                if ( _productContent != null ) {
                    _productContent.empty();
                    _productContent = null;
                }

                _obj.addClass( 'is-loading' );

                _obj.off( 'webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend' );

            } );

        },
        _onEvents = function(){

            _obj.on( 'click', function ( e ) {

                if ( $( e.target ).closest( _popupContents ).length === 0 ){
                    _hidePopup();
                }

            } );

            _btnShow.on( 'click', function() {

                var curBtn = $( this );

                _showPopup( curBtn );
                return false;
            } );

            _btnClose.on( 'click', function(){
                _hidePopup();
                return false;
            } );

        },
        _showPopup = function( btn ){

            _isOpen = true;

            _setPopupContent( btn );

            if ( _window.scrollTop() !== 0 ){
                _position = _window.scrollTop();
            }

            _scrollConteiner.css( {
                overflowY: 'hidden',
                paddingRight: _getScrollWidth()
            } );

            _body.css( 'overflow-y', 'hidden' );

            _site.css( {
                'position': 'relative',
                'top': _position * -1
            } );

            if ( _popupWrap.outerHeight() <= _window.outerHeight() ) {
                _obj.css( {
                    paddingRight: _getScrollWidth()
                } );
            }

            _obj.addClass( 'is-opened' );

        },
        _setPopupContent = function( btn ){

            var curBtn = btn,
                className = curBtn.data( 'popup' ),
                curContent = _popupContents.filter( '.popup_' + className );

            _popupContents.css( { display: 'none' } );
            curContent.css( { display: 'block' } );

            if ( className === 'join-us-video' ) { _setVideoFile( curBtn.data( 'video' ), curContent ) }
            if ( className === 'product' ) { _setAJAXRequest( curBtn.data( 'id' ), curContent ) }
            if ( className === 'delete-account' ) { _onEventDeleteAccount( curBtn.data( 'id' ), curContent ) }

        },
        _setVideoFile = function ( id, obj ) {

            var curContent = obj;

            curContent.append( '<iframe src="https://www.youtube.com/embed/'+ id +'?rel=0&amp;showinfo=0&amp;autoplay=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>' );

            _videoFile = curContent.find( 'iframe' );

            _videoFile.on( 'load', function () {
                _setVideoSize();
                _obj.removeClass( 'is-loading' );
            } );

            _window.on( 'resize', function () {
                _setVideoSize();
            } );

        },
        _setVideoSize = function () {

            var videoWidth = _videoFile.outerWidth();

            _videoFile.css( 'height', videoWidth / 1.7777 + 'px' );

        },
        _setAJAXRequest = function ( id, obj ) {

            _request = $.ajax( {
                url: _url,
                data: {
                    action: 'get_variable_product_for_adding_to_cart',
                    id: id
                },
                dataType: 'JSON',
                timeout: 20000,
                type: 'POST',
                success: function ( data ) {
                    _setProductPopup( data, obj );
                },
                error: function ( XMLHttpRequest ) {
                    if ( XMLHttpRequest.statusText != "abort" ) {
                        console.error( 'err' );
                    }
                }
            } );

        },
        _onEventDeleteAccount = function ( id, obj ) {

            var curPopup = obj,
                btnDeleteAccount = curPopup.find( '.btn-delete' );

            btnDeleteAccount.on( 'click', function () {

                curPopup.addClass( 'is-loading' );

                _request = $.ajax( {
                    url: _url,
                    data: {
                        action: 'delete_my_account',
                        user_id: btnDeleteAccount.attr( 'data-id' )
                    },
                    dataType: 'JSON',
                    timeout: 20000,
                    type: 'POST',
                    success: function ( data ) {

                        if ( data.status == 'success' ){
                            window.location.replace('/');
                        } else {
                            curPopup.removeClass( 'is-loading' );
                            curPopup.find( '.popup__delete-text' ).html( '<p>Sorry</p><p>You can\'t delete your account. Write to your administrator.</p>' )
                        }

                    },
                    error: function ( XMLHttpRequest ) {
                        if ( XMLHttpRequest.statusText != "abort" ) {
                            console.error( 'err' )
                        }
                    }
                } );

            } )

        },
        _setProductPopup = function ( data, obj ) {

            _productContent = obj.find( '.popup__product-wrap' );

            var popupData = data,
                popupPrice = $( popupData.price ).text(),
                popupOption = popupData.variations,
                popupOptionTotal = popupOption.length,
                popupContent = $( '<div class="book">' +
                '<div class="book__picture js-back-picture"></div>' +
                '<div class="book__info article">' + popupData.text +
                '<div class="book__language"></div>' +
                '<div class="book__footer">' +
                '<a href="#" class="btn btn_color-2 btn_type-sale ajax-add-to-cart close-popup" data-id="'+ popupOption[0].id +'"><span>Add to Cart - <strong>'+ popupPrice +'</strong></span></a>' +
                '</div></div></div>' );

            _productContent.html( popupContent );

            for ( var i = 0; i <= popupOptionTotal - 1; i++ ){

                _productContent.find( '.book__picture' ).append( '<img src="'+ popupOption[i].image +'" alt="'+ popupOption[i].title +'" data-id="'+ popupOption[i].id +'">' )
                _productContent.find( '.book__language' ).append( '<label><input type="radio" value="'+ popupOption[i].id +'" name="language"><span>'+ popupOption[i].title +'</span></label>' )

                if ( i + 1 == popupOptionTotal ) {

                    new AddToCart ( _productContent.find( '.ajax-add-to-cart' ) );
                    new BackPictureFullSize ( _productContent.find( '.js-back-picture' ) );
                    new ChangeBookLanguage ( popupContent );

                    _obj.removeClass( 'is-loading' );

                }

            }

        },
        _construct = function(){

            _onEvents();
            _obj[ 0 ].obj = _self;

        };

    //public properties

    //public methods
    _self.openPopup = function ( obj ) {

        var curBtn = obj;

        _showPopup( curBtn );

    };
    _self.closePopup = function () {
        if ( _isOpen ){
            _hidePopup();
        }
    };

    _construct();

};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5tYWluLmpzIiwianF1ZXJ5LmNvbnRhY3QtdXMuanMiLCJqcXVlcnkudmFsaWRhdGlvbi5qcyIsImpxdWVyeS5wb3B1cC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2Z0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaFNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3UEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImNvbW1vbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIkKCBmdW5jdGlvbiAoKSB7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIG5ldyBQcmVsb2FkZXIoICQoICcucHJlbG9hZCcgKSApO1xuXG4gICAgbmV3ICBGaXhIZWFkZXIoICQoICcuc2l0ZV9faGVhZGVyJyApICk7XG5cbiAgICBuZXcgIE1vYmlsZU1lbnUoICQoICcubWVudScgKSApO1xuXG4gICAgJC5lYWNoKCAkKCAnLmFqYXgtYWRkLXRvLWNhcnQnICksIGZ1bmN0aW9uKCkge1xuICAgICAgICBuZXcgQWRkVG9DYXJ0ICggJCggdGhpcyApICk7XG4gICAgfSApO1xuXG4gICAgJC5lYWNoKCAkKCAnLnlvdXR1YmUtZnJhbWUnICksIGZ1bmN0aW9uKCkge1xuICAgICAgICBuZXcgU2V0U2l6ZUlmcmFtZSAoICQoIHRoaXMgKSApO1xuICAgIH0gKTtcblxuICAgICQuZWFjaCggJCggJy5ibG9nLWFydGljbGUgaWZyYW1lJyApLCBmdW5jdGlvbigpIHtcbiAgICAgICAgbmV3IFNldFNpemVJZnJhbWUgKCAkKCB0aGlzICkgKTtcbiAgICB9ICk7XG5cbiAgICAkLmVhY2goICQoICcuaGVybycgKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgIG5ldyBJbml0U2xpZGVyICggJCggdGhpcyApICk7XG4gICAgfSApO1xuXG4gICAgJC5lYWNoKCAkKCAnLmJvb2snICksIGZ1bmN0aW9uKCkge1xuICAgICAgICBuZXcgQ2hhbmdlQm9va0xhbmd1YWdlICggJCggdGhpcyApICk7XG4gICAgfSApO1xuXG4gICAgJC5lYWNoKCAkKCAnLnNlYXJjaCcgKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgIG5ldyBTZWFyY2hGb3JtICggJCggdGhpcyApICk7XG4gICAgfSApO1xuXG4gICAgJC5lYWNoKCAkKCAnLm9yZGVycycgKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgIG5ldyBJbml0VGFibGVTY3JvbGwgKCAkKCB0aGlzICkgKTtcbiAgICB9ICk7XG5cbiAgICAkLmVhY2goICQoICcuc3VjY2Vzcy1zdG9yaWVzJyApLCBmdW5jdGlvbigpIHtcbiAgICAgICAgbmV3IEluaXRTbGlkZXIgKCAkKCB0aGlzICkgKTtcbiAgICB9ICk7XG5cbiAgICAkLmVhY2goICQoICcucmVjaXBlLWJvb2tzLXByb21vJyApLCBmdW5jdGlvbigpIHtcbiAgICAgICAgbmV3IEluaXRTbGlkZXIgKCAkKCB0aGlzICkgKTtcbiAgICB9ICk7XG5cbiAgICAkLmVhY2goICQoICcubW9iaWxlLWFwcCcgKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgIG5ldyBJbml0U2xpZGVyICggJCggdGhpcyApICk7XG4gICAgfSApO1xuXG4gICAgJC5lYWNoKCAkKCAnLmpvaW4tdXMnICksIGZ1bmN0aW9uKCkge1xuICAgICAgICBuZXcgSW5pdEpvaW5Vc1NsaWRlciAoICQoIHRoaXMgKSApO1xuICAgIH0gKTtcblxuICAgICQuZWFjaCggJCggJyNhdXRvLWxvYWQuZnJlZS1yZWNpcGVzJyApLCBmdW5jdGlvbigpIHtcbiAgICAgICAgbmV3IEZyZWVSZWNpcGVzU2VjdGlvbiAoICQoIHRoaXMgKSApO1xuICAgIH0gKTtcblxuICAgICQuZWFjaCggJCggJy5qcy1iYWNrLXBpY3R1cmUnICksIGZ1bmN0aW9uKCkge1xuICAgICAgICBuZXcgQmFja1BpY3R1cmVGdWxsU2l6ZSAoICQoIHRoaXMgKSApO1xuICAgIH0gKTtcblxuICAgICQuZWFjaCggJCggJy5zaXRlX19kZWNvJyApLCBmdW5jdGlvbigpIHtcbiAgICAgICAgbmV3IFNpdGVEZWNvICggJCggdGhpcyApICk7XG4gICAgfSApO1xuXG4gICAgJC5lYWNoKCAkKCAnLmNhdGVnb3JpZXMnICksIGZ1bmN0aW9uKCkge1xuICAgICAgICBuZXcgSW5pdFNjcm9sbCAoICQoIHRoaXMgKSApO1xuICAgIH0gKTtcblxuICAgICQuZWFjaCggJCggJy5ibG9nJyApLCBmdW5jdGlvbigpIHtcbiAgICAgICAgbmV3IEJsb2cgKCAkKCB0aGlzICkgKTtcbiAgICB9ICk7XG5cbiAgICAkLmVhY2goICQoICcuYm9va19fZ2FsbGVyeScgKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgIG5ldyBCb29rR2FsbGVyeSAoICQoIHRoaXMgKSApO1xuICAgIH0gKTtcblxuICAgICQuZWFjaCggJCggJy50YWJzJyApLCBmdW5jdGlvbigpIHtcbiAgICAgICAgbmV3IFRhYnMoICQoIHRoaXMgKSApO1xuICAgIH0gKTtcblxuICAgICQuZWFjaCggJCggJy5ibG9nX19pdGVtLXNoYXJlJyApLCBmdW5jdGlvbigpIHtcbiAgICAgICAgbmV3IEluaXRTb2NpYWxTaGFyZSggJCggdGhpcyApICk7XG4gICAgfSApO1xuXG4gICAgJC5lYWNoKCAkKCAnLnNvY2lhbC1zaGFyZScgKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgIG5ldyBJbml0U29jaWFsU2hhcmUoICQoIHRoaXMgKSApO1xuICAgIH0gKTtcblxuICAgICQuZWFjaCggJCggJy5mYXEtd3JhcCcgKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgIG5ldyBPcGVuSXRlbXMoICQoIHRoaXMgKSApO1xuICAgIH0gKTtcblxuICAgICQuZWFjaCggJCggJy5jYXJ0LWxpc3QnICksIGZ1bmN0aW9uKCkge1xuICAgICAgICBuZXcgQ2FydExpc3QoICQoIHRoaXMgKSApO1xuICAgIH0gKTtcblxuICAgICQuZWFjaCggJCgnLmF1dGhvcml6YXRpb24tZm9ybV9fd2FybmluZycpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIG5ldyBBdXRob3JpemF0aW9uRm9ybVdhcm5pbmcoICQodGhpcykgKTtcbiAgICB9ICk7XG5cbiAgICAkLmVhY2goICQoJy5oZXJvLWFjY291bnQnKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICBuZXcgVHJ1ZVVzZXIoICQodGhpcykgKTtcbiAgICB9ICk7XG5cbiAgICAkLmVhY2goICQoJy5zdGFycycpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIG5ldyBTdGFycyggJCh0aGlzKSApO1xuICAgIH0gKTtcblxuICAgICQuZWFjaCggJCgnLnJldmlld3MnKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICBuZXcgUmV2aWV3c0l0ZW1zKCAkKHRoaXMpICk7XG4gICAgfSApO1xuXG4gICAgJC5lYWNoKCAkKCcuZmxhc2gtc2FsZXMnKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICBuZXcgT2ZmZXJUaW1lciggJCh0aGlzKSApO1xuICAgIH0gKTtcblxufSApO1xuXG52YXIgQWRkVG9DYXJ0ID0gZnVuY3Rpb24oIG9iaiApe1xuXG4gICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgX3VybCA9ICQoICdib2R5JyApLmRhdGEoICdhY3Rpb24nICksXG4gICAgICAgIF9yZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCksXG4gICAgICAgIF90aW1lciwgX2RlbGF5ID0gMTAwMDtcblxuICAgIC8vcHJpdmF0ZSBtZXRob2RzXG4gICAgdmFyIF9jb25zdHJ1Y3QgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgX29uRXZlbnQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgX29uRXZlbnQgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICBfb2JqLm9uKCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX2Rpc2FibGVkQnRuKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9kaXNhYmxlZEJ0biA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgX29iai5hZGRDbGFzcyggJ2lzLWxvYWRpbmcnICk7XG4gICAgICAgICAgICBfb2JqLmFwcGVuZCggJzxzcGFuIGNsYXNzPVwiYnRuX19sb2FkZXJcIj48c3Bhbj48L3NwYW4+PC9zcGFuPicgKTtcblxuICAgICAgICAgICAgX2FqYXhTZW5kKCk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2FqYXhTZW5kID0gZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgX3JlcXVlc3QgPSAkLmFqYXgoIHtcbiAgICAgICAgICAgICAgICB1cmw6IF91cmwsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICB0aW1lb3V0OiAyMDAwMCxcbiAgICAgICAgICAgICAgICB0eXBlOiBcIlBPU1RcIixcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2FkZF90b19jYXJ0X2Jvb2snLFxuICAgICAgICAgICAgICAgICAgICBpZDogX29iai5hdHRyKCAnZGF0YS1pZCcgKVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCBkYXRhICkge1xuXG4gICAgICAgICAgICAgICAgICAgIF9zaG93U3VjY2Vzc01lc3NhZ2UoKTtcbiAgICAgICAgICAgICAgICAgICAgQmFza2V0VXBkYXRlKCBkYXRhLnJlc3VsdCApO1xuXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKFhNTEh0dHBSZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChYTUxIdHRwUmVxdWVzdC5zdGF0dXNUZXh0ICE9ICdhYm9ydCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KFhNTEh0dHBSZXF1ZXN0LnN0YXR1c1RleHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9zaG93U3VjY2Vzc01lc3NhZ2UgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIF9vYmoucmVtb3ZlQ2xhc3MoICdpcy1sb2FkaW5nJyApLmFkZENsYXNzKCAnaXMtc3VjY2VzcycgKTtcbiAgICAgICAgICAgIF9vYmouZmluZCggJy5idG5fX2xvYWRlcicgKS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgX29iai5hcHBlbmQoICc8c3BhbiBjbGFzcz1cImJ0bl9fc3VjY2Vzc1wiPjxzdmcgc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZS1saW5lam9pbj1cInJvdW5kXCIgc3Ryb2tlLXdpZHRoPVwiMlwiIHZpZXdCb3g9XCIwIDAgMjQgMjRcIj48cGF0aCBkPVwiTTIyIDExLjA3VjEyYTEwIDEwIDAgMSAxLTUuOTMtOS4xNFwiLz48cG9seWxpbmUgcG9pbnRzPVwiMjMgMyAxMiAxNCA5IDExXCIvPjwvc3ZnPjwvc3Bhbj4nICk7XG5cbiAgICAgICAgICAgIF90aW1lciA9IHNldFRpbWVvdXQoIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIF9vYmoucmVtb3ZlQ2xhc3MoICdidG5fdHlwZS1zYWxlIGFqYXgtYWRkLXRvLWNhcnQgaXMtc3VjY2VzcycgKS5hZGRDbGFzcyggJ2J0bl90eXBlLXNvbGQnICk7XG4gICAgICAgICAgICAgICAgX29iai5maW5kKCAnLmJ0bl9fc3VjY2VzcycgKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBfb2JqLmFwcGVuZCggJzxzcGFuPkFscmVhZHkgaW4gY2FydDwvc3Bhbj4nICk7XG4gICAgICAgICAgICAgICAgX29iai5vZmYoICdjbGljaycgKTtcblxuICAgICAgICAgICAgICAgIGlmICggIF9vYmouaGFzQ2xhc3MoICdjbG9zZS1wb3B1cCcpICl7XG4gICAgICAgICAgICAgICAgICAgICQoICcucG9wdXAnIClbMF0ub2JqLmNsb3NlUG9wdXAoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoIF90aW1lciApO1xuICAgICAgICAgICAgfSwgX2RlbGF5ICk7XG5cbiAgICAgICAgfTtcblxuICAgIC8vcHVibGljIHByb3BlcnRpZXNcblxuICAgIC8vcHVibGljIG1ldGhvZHNKT0lOIFVTIE9OIFlPVVRVQlxuXG4gICAgX2NvbnN0cnVjdCgpO1xuXG59O1xuXG52YXIgQXV0aG9yaXphdGlvbkZvcm1XYXJuaW5nID0gZnVuY3Rpb24oIG9iaiApe1xuXG4gICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgX2J0bkNsb3NlID0gX29iai5maW5kKCAnLmJ0bicgKTtcblxuICAgIC8vcHJpdmF0ZSBtZXRob2RzXG4gICAgdmFyIF9jb25zdHJ1Y3QgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgX2NoZWNrVXNlcigpO1xuICAgICAgICAgICAgX29uRXZlbnQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgX29uRXZlbnQgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICBfYnRuQ2xvc2Uub24oICdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfb2JqLmFkZENsYXNzKCAnaXMtaGlkZScgKTtcblxuICAgICAgICAgICAgICAgIF9vYmoub24oICd3ZWJraXRUcmFuc2l0aW9uRW5kIG90cmFuc2l0aW9uZW5kIG9UcmFuc2l0aW9uRW5kIG1zVHJhbnNpdGlvbkVuZCB0cmFuc2l0aW9uZW5kJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIF9vYmoucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCAndHJ1ZVVzZXInLCB0cnVlIClcbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICB9LFxuICAgICAgICBfY2hlY2tVc2VyID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2YXIgdHJ1ZVVzZXIgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSggJ3RydWVVc2VyJyApO1xuXG4gICAgICAgICAgICBpZiAoIHRydWVVc2VyICl7XG4gICAgICAgICAgICAgICAgX29iai5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9O1xuXG4gICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgX2NvbnN0cnVjdCgpO1xuXG59O1xuXG52YXIgQmFza2V0VXBkYXRlID0gZnVuY3Rpb24gKCBkYXRhICkge1xuXG4gICAgdmFyIF9kYXRhID0gJCggZGF0YSApLFxuICAgICAgICBfbmV3QW1vdW50ID0gX2RhdGEudGV4dCgpLFxuICAgICAgICBfbmV3U3ltYm9sID0gX25ld0Ftb3VudC5zbGljZSgwLDEpLFxuICAgICAgICBfbmV3VG90YWwgPSBfbmV3QW1vdW50LnN1YnN0cmluZygxKSxcbiAgICAgICAgX2Jhc2tldFdyYXAgPSAkKCAnLmJhc2tldCcgKSxcbiAgICAgICAgX2Jhc2tldExheW91dCA9IF9iYXNrZXRXcmFwLmZpbmQoICcuYmFza2V0X193cmFwJyApLFxuICAgICAgICBfdG90YWxXcmFwID0gX2Jhc2tldFdyYXAuZmluZCggJy5iYXNrZXRfX2Ftb3VudCcgKSxcbiAgICAgICAgX3RpbWVyO1xuXG4gICAgLy9wcml2YXRlIG1ldGhvZHNcbiAgICB2YXIgX2NvbnN0cnVjdCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBfYXBwZW5kTnVtYmVyKCk7XG4gICAgICAgIH0sXG4gICAgICAgIF9hcHBlbmROdW1iZXIgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIGlmICggX3RvdGFsV3JhcC5sZW5ndGggPiAwICl7XG5cbiAgICAgICAgICAgICAgICBpZiAoIF9uZXdUb3RhbCA+IDAgKXtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZHVyYXRpb24gPSA1MDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBpID0gKyggX3RvdGFsV3JhcC50ZXh0KCkuc3Vic3RyaW5nKDEpICksXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGVwVGltZSA9IE1hdGguYWJzKCBNYXRoLmZsb29yKCBkdXJhdGlvbiAvIE1hdGguYWJzKCBfbmV3VG90YWwgLSBpICkgKSApLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZXI7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBfbmV3VG90YWwgPiBpICkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBfdG90YWxXcmFwLmFkZENsYXNzKCAnaXMtZ3Jvd2luZycgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZXIgPSBzZXRJbnRlcnZhbCggZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpID0gaSArIDE7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdG90YWxXcmFwLmh0bWwoIF9uZXdTeW1ib2wgKycnKyAgaSApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBpID09IF9uZXdUb3RhbCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCggdGltZXIgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RvdGFsV3JhcC5yZW1vdmVDbGFzcyggJ2lzLWdyb3dpbmcnICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBzdGVwVGltZSApO1xuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIF9uZXdUb3RhbCA8IGkgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVyID0gc2V0SW50ZXJ2YWwoIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaSA9IGkgLSAxO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RvdGFsV3JhcC5odG1sKCBfbmV3U3ltYm9sICsnJysgIGkgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggaSA9PSBfbmV3VG90YWwgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoIHRpbWVyICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBzdGVwVGltZSApO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgX2Jhc2tldFdyYXAuY3NzKCAnd2lkdGgnLCBfYmFza2V0V3JhcC5vdXRlcldpZHRoKCkgKTtcblxuICAgICAgICAgICAgICAgICAgICBfdG90YWxXcmFwLmFkZENsYXNzKCAnaXMtaGlkZScgKTtcblxuICAgICAgICAgICAgICAgICAgICBfdG90YWxXcmFwLm9uKCAnd2Via2l0VHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCBvVHJhbnNpdGlvbkVuZCBtc1RyYW5zaXRpb25FbmQgdHJhbnNpdGlvbmVuZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RvdGFsV3JhcC5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90b3RhbFdyYXAub2ZmKCAnd2Via2l0VHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCBvVHJhbnNpdGlvbkVuZCBtc1RyYW5zaXRpb25FbmQgdHJhbnNpdGlvbmVuZCcgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9iYXNrZXRXcmFwLmNzcyggJ3dpZHRoJywgX2Jhc2tldExheW91dC5vdXRlcldpZHRoKCkgKTtcbiAgICAgICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgX2Jhc2tldFdyYXAuY3NzKCAnd2lkdGgnLCBfYmFza2V0V3JhcC5vdXRlcldpZHRoKCkgKTtcblxuICAgICAgICAgICAgICAgIF9iYXNrZXRMYXlvdXQuYXBwZW5kKCAnPHNwYW4gY2xhc3M9XCJiYXNrZXRfX2Ftb3VudCBpcy1oaWRlXCI+JysgX25ld1N5bWJvbCArJycrIF9uZXdUb3RhbCArJzwvc3Bhbj4nICk7XG5cbiAgICAgICAgICAgICAgICBfYmFza2V0V3JhcC5jc3MoICd3aWR0aCcsIF9iYXNrZXRMYXlvdXQub3V0ZXJXaWR0aCgpICk7XG4gICAgICAgICAgICAgICAgX3RvdGFsV3JhcCA9IF9iYXNrZXRXcmFwLmZpbmQoICcuYmFza2V0X19hbW91bnQnICk7XG5cbiAgICAgICAgICAgICAgICBfdGltZXIgPSBzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF90b3RhbFdyYXAucmVtb3ZlQ2xhc3MoICdpcy1oaWRlJyApLmFkZENsYXNzKCAnaXMtZ3Jvd2luZycgKTtcblxuICAgICAgICAgICAgICAgICAgICBfdG90YWxXcmFwLm9uKCAnd2Via2l0VHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCBvVHJhbnNpdGlvbkVuZCBtc1RyYW5zaXRpb25FbmQgdHJhbnNpdGlvbmVuZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RvdGFsV3JhcC5yZW1vdmVDbGFzcyggJ2lzLWdyb3dpbmcnICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoX3RpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90b3RhbFdyYXAub2ZmKCAnd2Via2l0VHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCBvVHJhbnNpdGlvbkVuZCBtc1RyYW5zaXRpb25FbmQgdHJhbnNpdGlvbmVuZCcgKTtcbiAgICAgICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgfSwgMTAwICk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9O1xuXG4gICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgX2NvbnN0cnVjdCgpO1xuXG59O1xuXG52YXIgQmFja1BpY3R1cmVGdWxsU2l6ZSA9IGZ1bmN0aW9uICggb2JqICkge1xuXG4gICAgdmFyIF9vYmogPSBvYmosXG4gICAgICAgIF9iYWNrZ3JvdW5kUGljdHVyZSA9IF9vYmouZmluZCggJ2ltZycgKSxcbiAgICAgICAgX3dpbmRvdyA9ICQoIHdpbmRvdyApO1xuXG4gICAgdmFyIF9vbkV2ZW50cyA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBfd2luZG93Lm9uKCAncmVzaXplJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF9zZXRGdWxsU2l6ZSgpO1xuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICBfYmFja2dyb3VuZFBpY3R1cmUub24oICdsb2FkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF9zZXRGdWxsU2l6ZSgpO1xuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9zZXRGdWxsU2l6ZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgX2JhY2tncm91bmRQaWN0dXJlLnJlbW92ZUF0dHIoICdzdHlsZScgKTtcblxuICAgICAgICAgICAgdmFyIGZyYW1lV2lkdGggPSBfb2JqLm91dGVyV2lkdGgoKSxcbiAgICAgICAgICAgICAgICBmcmFtZUhlaWdodCA9IF9vYmoub3V0ZXJIZWlnaHQoKSxcbiAgICAgICAgICAgICAgICBwaWN0dXJlV2lkdGggPSBfYmFja2dyb3VuZFBpY3R1cmUub3V0ZXJXaWR0aCgpLFxuICAgICAgICAgICAgICAgIHBpY3R1cmVIZWlnaHQgPSBfYmFja2dyb3VuZFBpY3R1cmUub3V0ZXJIZWlnaHQoKTtcblxuICAgICAgICAgICAgaWYgKCBwaWN0dXJlV2lkdGggPCBmcmFtZVdpZHRoICl7XG4gICAgICAgICAgICAgICAgX2JhY2tncm91bmRQaWN0dXJlLmNzcygge1xuICAgICAgICAgICAgICAgICAgICAnd2lkdGgnOiAnMTAwJScsXG4gICAgICAgICAgICAgICAgICAgICdoZWlnaHQnOiAnYXV0bydcbiAgICAgICAgICAgICAgICB9IClcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIHBpY3R1cmVIZWlnaHQgPCBmcmFtZUhlaWdodCApIHtcbiAgICAgICAgICAgICAgICBfYmFja2dyb3VuZFBpY3R1cmUuY3NzKCB7XG4gICAgICAgICAgICAgICAgICAgICd3aWR0aCc6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICAgICAgJ2hlaWdodCc6IGZyYW1lSGVpZ2h0XG4gICAgICAgICAgICAgICAgfSApXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2NvbnN0cnVjdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgX29uRXZlbnRzKCk7XG4gICAgICAgICAgICBfc2V0RnVsbFNpemUoKTtcbiAgICAgICAgfTtcblxuICAgIF9jb25zdHJ1Y3QoKVxufTtcblxudmFyIEJsb2cgPSBmdW5jdGlvbiAoIG9iaiApIHtcblxuICAgIHZhciBfb2JqID0gb2JqLFxuICAgICAgICBfYmxvZ1dyYXAgPSBfb2JqLmZpbmQoICcuYmxvZ19fd3JhcCcgKSxcbiAgICAgICAgX2Jsb2dMaXN0ID0gX2Jsb2dXcmFwLmZpbmQoICcuYmxvZ19fbGlzdCcgKSxcbiAgICAgICAgX2NhdGVnb3J5TGlzdCA9ICQoICcuY2F0ZWdvcmllcycgKSxcbiAgICAgICAgX2NhdGVnb3J5SXRlbSA9IF9jYXRlZ29yeUxpc3QuZmluZCggJy5jYXRlZ29yaWVzX19pdGVtJyApLFxuICAgICAgICBfY3VycmVudElkID0gX2NhdGVnb3J5SXRlbS5lcSgwKS5kYXRhKCAnaWQnICksXG4gICAgICAgIF9jdXJyZW50UGFnZSA9IDEsXG4gICAgICAgIF9tYXhQYWdlID0gMSxcbiAgICAgICAgX2NhblNlbmRSZXF1ZXN0ID0gdHJ1ZSxcbiAgICAgICAgX3VybCA9ICQoICdib2R5JyApLmRhdGEoICdhY3Rpb24nICksXG4gICAgICAgIF9yZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCksXG4gICAgICAgIF93aW5kb3cgPSAkKCB3aW5kb3cgKSxcbiAgICAgICAgX21vbnRoTmFtZXMgPSBbIFwiSmFuXCIsIFwiRmViXCIsIFwiTWFyXCIsIFwiQXByXCIsIFwiTWF5XCIsIFwiSnVuXCIsIFwiSnVsXCIsIFwiQXVnXCIsIFwiU2VwXCIsIFwiT2N0XCIsIFwiTm92XCIsIFwiRGVjXCIgXTtcblxuICAgIHZhciBfb25FdmVudHMgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgX3dpbmRvdy5vbiggJ3Njcm9sbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoIF93aW5kb3cuc2Nyb2xsVG9wKCkgKyBfd2luZG93LmhlaWdodCgpID49IF9ibG9nV3JhcC5vZmZzZXQoKS50b3AgKyBfYmxvZ1dyYXAub3V0ZXJIZWlnaHQoKSAtIDEwICkge1xuICAgICAgICAgICAgICAgICAgICBfbG9hZERhdGEoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIF9jYXRlZ29yeUl0ZW0ub24oICdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfY2hhbmdlQ2F0ZWdvcnkoICQodGhpcykgKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2NoYW5nZUNhdGVnb3J5ID0gZnVuY3Rpb24gKCBvYmogKSB7XG5cbiAgICAgICAgICAgIF9jdXJyZW50UGFnZSA9IDE7XG4gICAgICAgICAgICBfbWF4UGFnZSA9IDE7XG5cbiAgICAgICAgICAgIF9jYXRlZ29yeUl0ZW0ucmVtb3ZlQ2xhc3MoICdpcy1hY3RpdmUnICk7XG4gICAgICAgICAgICBvYmouYWRkQ2xhc3MoICdpcy1hY3RpdmUnICk7XG5cbiAgICAgICAgICAgIF9ibG9nTGlzdC5lbXB0eSgpO1xuXG4gICAgICAgICAgICBfY3VycmVudElkID0gb2JqLmRhdGEoICdpZCcgKTtcblxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oICdibG9nQ2F0ZWdvcnknLCBfY3VycmVudElkICk7XG5cbiAgICAgICAgICAgIF9sb2FkRGF0YSgpO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9zZXRCbG9nSXRlbSA9IGZ1bmN0aW9uICggZGF0YSApIHtcblxuICAgICAgICAgICAgdmFyIGJsb2dJdGVtID0gZGF0YSxcbiAgICAgICAgICAgICAgICBibG9nSXRlbUF1dGhvciA9IGJsb2dJdGVtLmF1dGhvcixcbiAgICAgICAgICAgICAgICBibG9nSXRlbUxpbmsgPSBibG9nSXRlbS5saW5rLFxuICAgICAgICAgICAgICAgIGJsb2dJdGVtSW1hZ2UgPSBibG9nSXRlbS5pbWFnZSxcbiAgICAgICAgICAgICAgICBibG9nSXRlbVRpdGxlID0gYmxvZ0l0ZW0udGl0bGUsXG4gICAgICAgICAgICAgICAgYmxvZ0l0ZW1Db250ZW50ID0gYmxvZ0l0ZW0uY29udGVudCxcbiAgICAgICAgICAgICAgICBibG9nSXRlbVRhZyA9IGJsb2dJdGVtLnRhZyxcbiAgICAgICAgICAgICAgICBibG9nSXRlbURhdGUgPSBibG9nSXRlbS5kYXRlLFxuICAgICAgICAgICAgICAgIGRhdGVBcnIgPSBibG9nSXRlbURhdGUuc3BsaXQoJy0nKSxcbiAgICAgICAgICAgICAgICBmcmFtZUl0ZW07XG5cbiAgICAgICAgICAgIGZyYW1lSXRlbSA9ICc8YXJ0aWNsZSBjbGFzcz1cImJsb2dfX2l0ZW0gaXMtbmV3XCI+JyArXG4gICAgICAgICAgICAgICAgJzxhIGhyZWY9XCInKyBibG9nSXRlbUxpbmsgKydcIiBjbGFzcz1cImJsb2dfX2l0ZW0taW1hZ2UganMtYmFjay1waWN0dXJlXCI+JyArXG4gICAgICAgICAgICAgICAgJzxpbWcgc3JjPVwiJysgYmxvZ0l0ZW1JbWFnZSArJ1wiIGFsdD1cIicrIGJsb2dJdGVtVGl0bGUgKydcIj4nICtcbiAgICAgICAgICAgICAgICAnPC9hPicgK1xuICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiYmxvZ19faXRlbS1jb250ZW50IGFydGljbGVcIj4nICtcbiAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImJsb2dfX2l0ZW0tYXV0aG9yXCI+QnkgJysgYmxvZ0l0ZW1BdXRob3IgKyc8L2Rpdj4nICtcbiAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImJsb2dfX2l0ZW0tY2F0ZWdvcnlcIj4nKyBibG9nSXRlbVRhZyArJzwvZGl2PlxcbicgK1xuICAgICAgICAgICAgICAgICc8aDIgY2xhc3M9XCJibG9nX19pdGVtLXRpdGxlXCI+PGEgaHJlZj1cIicrIGJsb2dJdGVtTGluayArJ1wiPicrIGJsb2dJdGVtVGl0bGUgKyc8L2E+PC9oMj5cXG4nICtcbiAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImJsb2dfX2l0ZW0tdGV4dFwiPicrIGJsb2dJdGVtQ29udGVudCArJzwvZGl2PicgK1xuICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiYmxvZ19faXRlbS1zaGFyZVwiIGRhdGEtc29jaWFsPVxcJycgK1xuICAgICAgICAgICAgICAgICd7XCJ0aXRsZVwiOiBcIicrIGVzY2FwZSggYmxvZ0l0ZW1UaXRsZSApICsnXCIsIFwiaW1hZ2VcIjogXCInKyBibG9nSXRlbUltYWdlICsnXCIsIFwidGV4dFwiOiBcIicrIGVzY2FwZShibG9nSXRlbUNvbnRlbnQpICsnXCIsIFwidXJsXCI6IFwiJysgYmxvZ0l0ZW1MaW5rICsnXCJ9XFwnPicgK1xuICAgICAgICAgICAgICAgICc8YSBocmVmPVwiI1wiIGNsYXNzPVwiYmxvZ19faXRlbS1zaGFyZS1saW5rIHNfZmFjZWJvb2tcIiByZWw9XCJub2ZvbGxvd1wiPicgK1xuICAgICAgICAgICAgICAgICc8c3ZnIHZpZXdCb3g9XCIwIDAgMzYgMzZcIiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCI+PGcgc3Ryb2tlPVwibm9uZVwiIHN0cm9rZS13aWR0aD1cIjFcIiBmaWxsPVwibm9uZVwiIGZpbGwtcnVsZT1cImV2ZW5vZGRcIj4nICtcbiAgICAgICAgICAgICAgICAnPGcgdHJhbnNmb3JtPVwidHJhbnNsYXRlKC0xNjAuMDAwMDAwLCAtMjkzMy4wMDAwMDApXCIgZmlsbC1ydWxlPVwibm9uemVyb1wiPjxnIHRyYW5zZm9ybT1cInRyYW5zbGF0ZSgxNjAuMDAwMDAwLCAyOTMzLjAwMDAwMClcIj48Zz48Zz4nICtcbiAgICAgICAgICAgICAgICAnPHBhdGggZD1cIk0xNy44NzQ3MiwwIEM4LjAxODY0LDAgMCw4LjAxODY0IDAsMTcuODc0NzIgQzAsMjcuNzMwMDggOC4wMTg2NCwzNS43NDk0NCAxNy44NzQ3MiwzNS43NDk0NCBDMjcuNzMwMDgsMzUuNzQ5NDQgMzUuNzQ5NDQsMjcuNzMwMDggMzUuNzQ5NDQsMTcuODc0NzIgQzM1Ljc0OTQ0LDguMDE4NjQgMjcuNzMxNTIsMCAxNy44NzQ3MiwwIFogTTIyLjMyLDE4LjUwNCBMMTkuNDExOTIsMTguNTA0IEMxOS40MTE5MiwyMy4xNTAxNiAxOS40MTE5MiwyOC44NjkxMiAxOS40MTE5MiwyOC44NjkxMiBMMTUuMTAyNzIsMjguODY5MTIgQzE1LjEwMjcyLDI4Ljg2OTEyIDE1LjEwMjcyLDIzLjIwNTYgMTUuMTAyNzIsMTguNTA0IEwxMy4wNTQzMiwxOC41MDQgTDEzLjA1NDMyLDE0Ljg0MDY0IEwxNS4xMDI3MiwxNC44NDA2NCBMMTUuMTAyNzIsMTIuNDcxMTIgQzE1LjEwMjcyLDEwLjc3NDA4IDE1LjkwOTEyLDguMTIyMzIgMTkuNDUxNTIsOC4xMjIzMiBMMjIuNjQ0NzIsOC4xMzQ1NiBMMjIuNjQ0NzIsMTEuNjkwNjQgQzIyLjY0NDcyLDExLjY5MDY0IDIwLjcwNDMyLDExLjY5MDY0IDIwLjMyNzA0LDExLjY5MDY0IEMxOS45NDk3NiwxMS42OTA2NCAxOS40MTMzNiwxMS44NzkyOCAxOS40MTMzNiwxMi42ODg1NiBMMTkuNDEzMzYsMTQuODQxMzYgTDIyLjY5NjU2LDE0Ljg0MTM2IEwyMi4zMiwxOC41MDQgWlwiPjwvcGF0aD4nICtcbiAgICAgICAgICAgICAgICAnPC9nPjwvZz48L2c+PC9nPjwvZz48L3N2Zz48L2E+JyArXG4gICAgICAgICAgICAgICAgJzxhIGhyZWY9XCIjXCIgY2xhc3M9XCJibG9nX19pdGVtLXNoYXJlLWxpbmsgc190d2l0dGVyXCIgcmVsPVwibm9mb2xsb3dcIj4nICtcbiAgICAgICAgICAgICAgICAnPHN2ZyB2aWV3Qm94PVwiMCAwIDU2IDU2XCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiPjxnIHN0cm9rZT1cIm5vbmVcIiBzdHJva2Utd2lkdGg9XCIxXCIgZmlsbD1cIm5vbmVcIiBmaWxsLXJ1bGU9XCJldmVub2RkXCI+JytcbiAgICAgICAgICAgICAgICAnPGcgdHJhbnNmb3JtPVwidHJhbnNsYXRlKC05MzEuMDAwMDAwLCAtMTA0NTMuMDAwMDAwKVwiIGZpbGwtcnVsZT1cIm5vbnplcm9cIj48ZyB0cmFuc2Zvcm09XCJ0cmFuc2xhdGUoLTEzOC4wMDAwMDAsIDg2MDIuMDAwMDAwKVwiPicrXG4gICAgICAgICAgICAgICAgJzxnIHRyYW5zZm9ybT1cInRyYW5zbGF0ZSgyNjUuMDAwMDAwLCAxNjY4LjAwMDAwMClcIj48ZyB0cmFuc2Zvcm09XCJ0cmFuc2xhdGUoMC4wMDAwMDAsIDExLjAwMDAwMClcIj48ZyB0cmFuc2Zvcm09XCJ0cmFuc2xhdGUoMC4wMDAwMDAsIDEyNy4wMDAwMDApXCI+JytcbiAgICAgICAgICAgICAgICAnPGcgdHJhbnNmb3JtPVwidHJhbnNsYXRlKDc3NC4wMDAwMDAsIDQ1LjAwMDAwMClcIj48ZyB0cmFuc2Zvcm09XCJ0cmFuc2xhdGUoMzAuMDAwMDAwLCAwLjAwMDAwMClcIj48Zz4nK1xuICAgICAgICAgICAgICAgICc8cGF0aCBkPVwiTTI3LjgwNTEyLDAgQzEyLjQ3MzQ0LDAgMCwxMi40NzM0NCAwLDI3LjgwNTEyIEMwLDQzLjEzNTY4IDEyLjQ3MzQ0LDU1LjYxMDI0IDI3LjgwNTEyLDU1LjYxMDI0IEM0My4xMzU2OCw1NS42MTAyNCA1NS42MTAyNCw0My4xMzU2OCA1NS42MTAyNCwyNy44MDUxMiBDNTUuNjEwMjQsMTIuNDczNDQgNDMuMTM3OTIsMCAyNy44MDUxMiwwIFogTTQwLjIwOTEyLDIxLjQ0MTI4IEM0MC4yMjE0NCwyMS43MTY4IDQwLjIyODE2LDIxLjk5NDU2IDQwLjIyODE2LDIyLjI3MjMyIEM0MC4yMjgxNiwzMC43Mjk0NCAzMy43OTI2NCw0MC40Nzc5MiAyMi4wMTgwOCw0MC40Nzc5MiBDMTguNDAzODQsNDAuNDc3OTIgMTUuMDM5MzYsMzkuNDIxNzYgMTIuMjA4LDM3LjYwNTEyIEMxMi43MDg2NCwzNy42NjQ0OCAxMy4yMTgyNCwzNy42OTQ3MiAxMy43MzQ1NiwzNy42OTQ3MiBDMTYuNzMzOTIsMzcuNjk0NzIgMTkuNDkyNDgsMzYuNjcxMDQgMjEuNjgzMiwzNC45NTUyIEMxOC44ODMyLDM0LjkwMzY4IDE2LjUxODg4LDMzLjA1MzQ0IDE1LjcwNDY0LDMwLjUwOTkyIEMxNi4wOTQ0LDMwLjU4Mzg0IDE2LjQ5NjQ4LDMwLjYyNTI4IDE2LjkwNzUyLDMwLjYyNTI4IEMxNy40OTEwNCwzMC42MjUyOCAxOC4wNTc3NiwzMC41NDkxMiAxOC41OTQyNCwzMC40MDI0IEMxNS42NjY1NiwyOS44MTU1MiAxMy40NjEyOCwyNy4yMjk0NCAxMy40NjEyOCwyNC4xMjcwNCBDMTMuNDYxMjgsMjQuMTAwMTYgMTMuNDYxMjgsMjQuMDcyMTYgMTMuNDYyNCwyNC4wNDY0IEMxNC4zMjQ4LDI0LjUyNDY0IDE1LjMxMTUyLDI0LjgxMzYgMTYuMzU5ODQsMjQuODQ2MDggQzE0LjY0NCwyMy43MDAzMiAxMy41MTM5MiwyMS43NDAzMiAxMy41MTM5MiwxOS41MjA0OCBDMTMuNTEzOTIsMTguMzQ2NzIgMTMuODI4NjQsMTcuMjQ2ODggMTQuMzc5NjgsMTYuMzAxNiBDMTcuNTM0NzIsMjAuMTc0NTYgMjIuMjUyMTYsMjIuNzIxNDQgMjcuNTY5OTIsMjIuOTkwMjQgQzI3LjQ2MDE2LDIyLjUyMDk2IDI3LjQwNTI4LDIyLjAzMzc2IDI3LjQwNTI4LDIxLjUzMDg4IEMyNy40MDUyOCwxNy45OTcyOCAzMC4yNzAyNCwxNS4xMzEyIDMzLjgwMzg0LDE1LjEzMTIgQzM1LjY0NTEyLDE1LjEzMTIgMzcuMzA2MDgsMTUuOTA4NDggMzguNDc1MzYsMTcuMTUxNjggQzM5LjkzNDcyLDE2Ljg2NDk2IDQxLjMwMTEyLDE2LjMzNDA4IDQyLjU0MDk2LDE1LjU5ODI0IEM0Mi4wNTkzNiwxNy4wOTM0NCA0MS4wNDgsMTguMzQ2NzIgMzkuNzIzMDQsMTkuMTM5NjggQzQxLjAxODg4LDE4Ljk4NTEyIDQyLjI1NTM2LDE4LjY0MjQgNDMuMzk4ODgsMTguMTMyOCBDNDIuNTQ1NDQsMTkuNDE0MDggNDEuNDYwMTYsMjAuNTQxOTIgNDAuMjA5MTIsMjEuNDQxMjggWlwiPjwvcGF0aD4nK1xuICAgICAgICAgICAgICAgICc8L2c+PC9nPjwvZz48L2c+PC9nPjwvZz48L2c+PC9nPjwvZz48L3N2Zz48L2E+JyArXG4gICAgICAgICAgICAgICAgJzxhIGhyZWY9XCIjXCIgY2xhc3M9XCJibG9nX19pdGVtLXNoYXJlLWxpbmsgc19waW50ZXJlc3RcIiByZWw9XCJub2ZvbGxvd1wiPicgK1xuICAgICAgICAgICAgICAgICc8c3ZnIHZpZXdCb3g9XCIwIDAgNTYgNTZcIiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCI+PGcgc3Ryb2tlPVwibm9uZVwiIHN0cm9rZS13aWR0aD1cIjFcIiBmaWxsPVwibm9uZVwiIGZpbGwtcnVsZT1cImV2ZW5vZGRcIj4nK1xuICAgICAgICAgICAgICAgICc8ZyB0cmFuc2Zvcm09XCJ0cmFuc2xhdGUoLTExNzIuMDAwMDAwLCAtMTA0NTQuMDAwMDAwKVwiIGZpbGwtcnVsZT1cIm5vbnplcm9cIj48ZyB0cmFuc2Zvcm09XCJ0cmFuc2xhdGUoLTEzOC4wMDAwMDAsIDg2MDIuMDAwMDAwKVwiPicrXG4gICAgICAgICAgICAgICAgJzxnIHRyYW5zZm9ybT1cInRyYW5zbGF0ZSgyNjUuMDAwMDAwLCAxNjY4LjAwMDAwMClcIj48ZyB0cmFuc2Zvcm09XCJ0cmFuc2xhdGUoMC4wMDAwMDAsIDExLjAwMDAwMClcIj48ZyB0cmFuc2Zvcm09XCJ0cmFuc2xhdGUoMC4wMDAwMDAsIDEyNy4wMDAwMDApXCI+JytcbiAgICAgICAgICAgICAgICAnPGcgdHJhbnNmb3JtPVwidHJhbnNsYXRlKDEwMTUuMDAwMDAwLCA0Ni4wMDAwMDApXCI+PGcgdHJhbnNmb3JtPVwidHJhbnNsYXRlKDMwLjAwMDAwMCwgMC4wMDAwMDApXCI+PGc+JytcbiAgICAgICAgICAgICAgICAnPHBhdGggZD1cIk0yOCwwIEMxMi41MzYzMTM3LDAgMCwxMi41MzYzMTM3IDAsMjggQzAsNDMuNDYzNTk0OCAxMi41MzYzMTM3LDU2IDI4LDU2IEM0My40NjM1OTQ4LDU2IDU2LDQzLjQ2MzU5NDggNTYsMjggQzU2LDEyLjUzNjMxMzcgNDMuNDYzNTk0OCwwIDI4LDAgWiBNMzAuNTc2LDM2LjQ3ODg3NTggQzI4LjUwNjU2MjEsMzYuNDc4ODc1OCAyNi41NTkyODEsMzUuMzM2IDI1Ljg4OTg0MzEsMzQuMDM3NzUxNiBDMjUuODg5ODQzMSwzNC4wMzc3NTE2IDI0Ljc3NzQzNzksMzguNTQ4MzEzNyAyNC41NDA3MTksMzkuNDE4ODc1OCBDMjQuMTQzNTk0OCw0MC44OTAxNTY5IDIzLjM3NzQzNzksNDIuMzU4OTY3MyAyMi42NjcxODk1LDQzLjUyMjI0ODQgQzIxLjY1NDE1NjksNDQuODQ1ODQzMSAyMC40ODU3NTE2LDQzLjg2MzM3MjUgMjAuMzQ1NzUxNiw0Mi42NTY3MTkgQzIwLjMsNDEuMzEyNzE5IDIwLjM0ODMxMzcsMzkuNzIxODQzMSAyMC42ODE3NTE2LDM4LjI3MzUyOTQgQzIxLjA1MDg3NTgsMzYuNjg1MjE1NyAyMy4xNDgzMTM3LDI3LjYwNTUyOTQgMjMuMTQ4MzEzNywyNy42MDU1Mjk0IEMyMy4xNDgzMTM3LDI3LjYwNTUyOTQgMjIuNTM0ODc1OCwyNi4zNTU2ODYzIDIyLjUzNDg3NTgsMjQuNTA3Njg2MyBDMjIuNTM0ODc1OCwyMS42MDU4NDMxIDI0LjE4MTg0MzEsMTkuNDM5Njg2MyAyNi4yMzM0Mzc5LDE5LjQzOTY4NjMgQzI3Ljk3NzAzMjcsMTkuNDM5Njg2MyAyOC44MTk1OTQ4LDIwLjc3ODY1MzYgMjguODE5NTk0OCwyMi4zNzk2ODYzIEMyOC44MTk1OTQ4LDI0LjE2OTEyNDIgMjcuNzAyMTU2OSwyNi44NDY5NjczIDI3LjEyNjg3NTgsMjkuMzI2MjQ4NCBDMjYuNjQ1NzUxNiwzMS40MDMzNzI1IDI4LjE0NzU5NDgsMzMuMDk2MDkxNSAzMC4xNTM0Mzc5LDMzLjA5NjA5MTUgQzMzLjc4NTc1MTYsMzMuMDk2MDkxNSAzNi4yMzQ1NjIxLDI4LjMzMDk2NzMgMzYuMjM0NTYyMSwyMi42ODc2ODYzIEMzNi4yMzQ1NjIxLDE4LjM5NjA5MTUgMzMuNDAzOTA4NSwxNS4xODYyNDg0IDI4LjI1NDU2MjEsMTUuMTg2MjQ4NCBDMjIuNDM4MTU2OSwxNS4xODYyNDg0IDE4LjgxMzQzNzksMTkuNjE1MjgxIDE4LjgxMzQzNzksMjQuNTYxMTI0MiBDMTguODEzNDM3OSwyNi4yNjY1NjIxIDE5LjMwNDcxOSwyNy40NzA1NjIxIDIwLjA3ODU2MjEsMjguMzk5Njg2MyBDMjAuNDMyNDA1MiwyOC44MjczNzI1IDIwLjQ4MzI4MSwyOS4wMDA0MDUyIDIwLjM1MzQzNzksMjkuNDkxNzc3OCBDMjAuMjYxODQzMSwyOS44NTMyMTU3IDIwLjA1MDU2MjEsMzAuNzE4NjUzNiAxOS45NjQsMzEuMDYyMjQ4NCBDMTkuODM2NzE5LDMxLjU1ODY1MzYgMTkuNDQyMTU2OSwzMS43MzQzMzk5IDE5LjAwNDMxMzcsMzEuNTUxMDU4OCBDMTYuMzI0LDMwLjQzMzUyOTQgMTUuMDc2NzE5LDI3LjQzNzUyOTQgMTUuMDc2NzE5LDI0LjA3MjQ5NjcgQzE1LjA3NjcxOSwxOC41MTA2NTM2IDE5LjY3MTI4MSwxMS44NDE1Mjk0IDI4Ljc4MTQzNzksMTEuODQxNTI5NCBDMzYuMTAyMTU2OSwxMS44NDE1Mjk0IDQwLjkyMDcxOSwxNy4yNTA2NTM2IDQwLjkyMDcxOSwyMy4wNTY4MTA1IEM0MC45MjMxODk1LDMwLjc0MTQzNzkgMzYuNzQxMDMyNywzNi40Nzg4NzU4IDMwLjU3NiwzNi40Nzg4NzU4IFpcIj48L3BhdGg+JytcbiAgICAgICAgICAgICAgICAnPC9nPjwvZz48L2c+PC9nPjwvZz48L2c+PC9nPjwvZz48L2c+PC9zdmc+PC9hPicgK1xuICAgICAgICAgICAgICAgICc8L2Rpdj5cXG4nICtcbiAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImJsb2dfX2l0ZW0tZm9vdGVyXCI+JyArXG4gICAgICAgICAgICAgICAgJzx0aW1lIGRhdGV0aW1lPVwiJysgYmxvZ0l0ZW1EYXRlICsnXCI+JysgX21vbnRoTmFtZXNbIGRhdGVBcnJbMV0gLSAxIF0gKycgJysgZGF0ZUFyclsyXSArJywgJysgZGF0ZUFyclswXSArJzwvdGltZT4nICtcbiAgICAgICAgICAgICAgICAnPGEgaHJlZj1cIicrIGJsb2dJdGVtTGluayArJ1wiIGNsYXNzPVwiYnRuIGJ0bl9jb2xvci0xIGJ0bl90eXBlLWdlbmVyYWxcIj48c3Bhbj5SZWFkIE1vcmU8L3NwYW4+PC9hPicgK1xuICAgICAgICAgICAgICAgICc8L2Rpdj48L2Rpdj48L2FydGljbGU+JztcblxuICAgICAgICAgICAgcmV0dXJuIGZyYW1lSXRlbTtcblxuICAgICAgICB9LFxuICAgICAgICBfaW5pdFNvY2lhbFNoYXJlID0gZnVuY3Rpb24gKCBvYmogKSB7XG5cbiAgICAgICAgICAgIHZhciBzb2NpYWxXcmFwID0gb2JqLmZpbmQoICcuYmxvZ19faXRlbS1zaGFyZScgKSxcbiAgICAgICAgICAgICAgICBzb2NpYWxEYXRhID0gSlNPTi5wYXJzZSggc29jaWFsV3JhcC5hdHRyKCAnZGF0YS1zb2NpYWwnICkgKSxcbiAgICAgICAgICAgICAgICBzb2NpYWxJdGVtID0gc29jaWFsV3JhcC5maW5kKCAnYScgKTtcblxuICAgICAgICAgICAgJC5lYWNoKCBzb2NpYWxJdGVtLCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICQodGhpcykuU2hhcmVMaW5rKCB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiB1bmVzY2FwZSggc29jaWFsRGF0YVsgJ3RpdGxlJyBdICksXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHVuZXNjYXBlKCBzb2NpYWxEYXRhWyAndGV4dCcgXSApLFxuICAgICAgICAgICAgICAgICAgICBpbWFnZTogc29jaWFsRGF0YVsgJ2ltYWdlJyBdLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IHNvY2lhbERhdGFbICd1cmwnIF0sXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiA2NDAsXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDgwXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2xvYWREYXRhID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICBpZiggX2NhblNlbmRSZXF1ZXN0ICYmIF9jdXJyZW50UGFnZSA8PSBfbWF4UGFnZSApe1xuICAgICAgICAgICAgICAgIF9zZW5kUmVxdWVzdCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG4gICAgICAgIF9zZW5kUmVxdWVzdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBfY2FuU2VuZFJlcXVlc3QgPSBmYWxzZTtcblxuICAgICAgICAgICAgX3JlcXVlc3QuYWJvcnQoKTtcbiAgICAgICAgICAgIF9ibG9nV3JhcC5hZGRDbGFzcyggJ2lzLWxvYWRpbmcnICkucmVtb3ZlQ2xhc3MoICdpcy1lbXB0eScgKTtcblxuICAgICAgICAgICAgX3JlcXVlc3QgPSAkLmFqYXgoIHtcbiAgICAgICAgICAgICAgICB1cmw6IF91cmwsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdnZXRfcG9zdHNfYnlfY2F0ZWdvcnknLFxuICAgICAgICAgICAgICAgICAgICBwYWdlOiBfY3VycmVudFBhZ2UsXG4gICAgICAgICAgICAgICAgICAgIHRheElkOiBfY3VycmVudElkXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIHRpbWVvdXQ6IDIwMDAwLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgIF9zZXRMaXN0KCBkYXRhICk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCBYTUxIdHRwUmVxdWVzdCApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBYTUxIdHRwUmVxdWVzdC5zdGF0dXNUZXh0ICE9IFwiYWJvcnRcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoICdlcnInICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX3NldExpc3QgPSBmdW5jdGlvbiggZGF0YSApIHtcblxuICAgICAgICAgICAgdmFyIGJsb2dEYXRhID0gZGF0YS5ibG9nLFxuICAgICAgICAgICAgICAgIGJsb2dJdGVtVG90YWwgPSBibG9nRGF0YS5sZW5ndGg7XG5cbiAgICAgICAgICAgIGlmICggYmxvZ0l0ZW1Ub3RhbCA9PT0gMCApe1xuICAgICAgICAgICAgICAgIF9jYW5TZW5kUmVxdWVzdCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIF9ibG9nV3JhcC5hZGRDbGFzcyggJ2lzLWVtcHR5JyApLnJlbW92ZUNsYXNzKCAnaXMtbG9hZGluZycgKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIF9tYXhQYWdlID0gZGF0YS5tYXhQYWdlcztcblxuICAgICAgICAgICAgJC5lYWNoKCBibG9nRGF0YSwgZnVuY3Rpb24oIGluZGV4ICkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGJsb2dGcmFtZSA9IF9zZXRCbG9nSXRlbSggdGhpcyApO1xuXG4gICAgICAgICAgICAgICAgX2Jsb2dMaXN0LmFwcGVuZCggYmxvZ0ZyYW1lICk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIGluZGV4ID09PSBibG9nSXRlbVRvdGFsIC0gMSApe1xuICAgICAgICAgICAgICAgICAgICBfYmxvZ1dyYXAucmVtb3ZlQ2xhc3MoICdpcy1sb2FkaW5nJyApO1xuICAgICAgICAgICAgICAgICAgICBfY2FuU2VuZFJlcXVlc3QgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgIF9ibG9nV3JhcC5jc3MoICdoZWlnaHQnLCBfYmxvZ0xpc3Qub3V0ZXJIZWlnaHQoKSApO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXdJdGVtID0gX2Jsb2dMaXN0LmZpbmQoICcuaXMtbmV3JyApO1xuXG4gICAgICAgICAgICAgICAgICAgIG5ld0l0ZW0uZWFjaCggZnVuY3Rpb24gKCBpICkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VySXRlbSA9ICQoIHRoaXMgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgX2luaXRTb2NpYWxTaGFyZSggY3VySXRlbSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3Nob3dOZXdJdGVtcyggY3VySXRlbSwgaSApO1xuXG4gICAgICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgaW1hZ2UgPSBuZXdJdGVtLmZpbmQoICdpbWcnICk7XG5cbiAgICAgICAgICAgICAgICAgICAgaW1hZ2Uub24oICdsb2FkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2Jsb2dXcmFwLmNzcyggJ2hlaWdodCcsIF9ibG9nTGlzdC5vdXRlckhlaWdodCgpICk7XG4gICAgICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICBfY3VycmVudFBhZ2UgPSBfY3VycmVudFBhZ2UgKyAxO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9zaG93TmV3SXRlbXMgPSBmdW5jdGlvbiAoIGl0ZW0sIGluZGV4ICkge1xuXG4gICAgICAgICAgICB2YXIgY3VySXRlbSA9IGl0ZW07XG5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGN1ckl0ZW0ucmVtb3ZlQ2xhc3MoICdpcy1uZXcnICk7XG4gICAgICAgICAgICB9LCAxMDAgKiBpbmRleCApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9jb25zdHJ1Y3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIF9jYXRlZ29yeUl0ZW0uZmlsdGVyKCAnW2RhdGEtaWQ9XCInKyBfY3VycmVudElkICsnXCJdJyApLmFkZENsYXNzKCAnaXMtYWN0aXZlJyApO1xuICAgICAgICAgICAgX29uRXZlbnRzKCk7XG4gICAgICAgICAgICBfbG9hZERhdGEoKTtcbiAgICAgICAgfTtcblxuICAgIF9jb25zdHJ1Y3QoKVxufTtcblxudmFyIEJvb2tHYWxsZXJ5ID0gZnVuY3Rpb24gKCBvYmogKSB7XG5cbiAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgX2l0ZW0gPSBfb2JqLmZpbmQoICcuYm9va19fZ2FsbGVyeS1pdGVtJyApO1xuXG4gICAgdmFyIF9vbkV2ZW50cyA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBfaXRlbS5vbiggJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIFN3aXBlclBvcHVwKCAkKCB0aGlzICkucGFyZW50cyggJy5ib29rX19nYWxsZXJ5JyApLCAkKCB0aGlzICkuaW5kZXgoKSApO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICB9LFxuICAgICAgICBfY29uc3RydWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBfb25FdmVudHMoKTtcbiAgICAgICAgfTtcblxuICAgIF9jb25zdHJ1Y3QoKVxufTtcblxudmFyIENhcnRMaXN0ID0gZnVuY3Rpb24gKCBvYmogKSB7XG5cbiAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgX3RhYmxlID0gX29iai5maW5kKCAnLmNhcnQtbGlzdF9fdGFibGUnICksXG4gICAgICAgIF9mb290ZXIgPSBfb2JqLmZpbmQoICcuY2FydC1saXN0X19idG4td3JhcCcgKSxcbiAgICAgICAgX2l0ZW0gPSBfb2JqLmZpbmQoICcuY2FydC1saXN0X19yb3cnICksXG4gICAgICAgIF9kZWxldGVCdG4gPSBfaXRlbS5maW5kKCAnLmNhcnQtbGlzdF9fZGVsZXRlJyApLFxuICAgICAgICBfdG90YWxXcmFwID0gX29iai5maW5kKCAnLmNhcnQtbGlzdF9fdG90YWwgc3Ryb25nJyApLFxuICAgICAgICBfY291cG9uV3JhcCA9IF9vYmouZmluZCggJy5jb3Vwb25zJyApLFxuICAgICAgICBfY291cG9uRm9ybSA9IF9jb3Vwb25XcmFwLmZpbmQoICcuY291cG9uc19fZm9ybScgKSxcbiAgICAgICAgX2NvdXBvbk1lc3NhZ2UgPSBfY291cG9uV3JhcC5maW5kKCAnLmNvdXBvbnNfX21lc3NhZ2UnICksXG4gICAgICAgIF9jb3Vwb25JbnB1dCA9IF9vYmouZmluZCggJ2lucHV0JyApLFxuICAgICAgICBfdmFsaWRhdGlvbiA9IG5ldyBGb3JtVmFsaWRhdG9yKCBfb2JqICksXG4gICAgICAgIF91cmwgPSAkKCAnYm9keScgKS5kYXRhKCAnYWN0aW9uJyApLFxuICAgICAgICBfcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG4gICAgdmFyIF9vbkV2ZW50cyA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBfZGVsZXRlQnRuLm9uKCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX2FqYXhSZXF1ZXN0KCAkKCB0aGlzICkgKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIF9jb3Vwb25Gb3JtLm9uKCAnc3VibWl0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBfb2JqLmFkZENsYXNzKCAnaXMtbG9hZGluZycgKTtcblxuICAgICAgICAgICAgICAgIGlmICggX3ZhbGlkYXRpb24udmFsaWQgPT09IHRydWUgKSB7XG4gICAgICAgICAgICAgICAgICAgIF9hamF4Q291cG9uUmVxdWVzdCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIF9vYmoucmVtb3ZlQ2xhc3MoICdpcy1sb2FkaW5nJyApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9jaGVja0NvdW50ZXIgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIF9vYmoucmVtb3ZlQ2xhc3MoICdpcy1sb2FkaW5nJyApO1xuXG4gICAgICAgICAgICBfb2JqLmNzcyggJ2hlaWdodCcsIF9vYmoub3V0ZXJIZWlnaHQoKSApO1xuXG4gICAgICAgICAgICBfb2JqLmFkZENsYXNzKCAnaXMtZW1wdHknICkuYW5pbWF0ZSggeyBoZWlnaHQ6IDAgfSwgMzAwICk7XG5cbiAgICAgICAgICAgIF90YWJsZS5vbiggJ3dlYmtpdFRyYW5zaXRpb25FbmQgb3RyYW5zaXRpb25lbmQgb1RyYW5zaXRpb25FbmQgbXNUcmFuc2l0aW9uRW5kIHRyYW5zaXRpb25lbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBfdGFibGUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgX2Zvb3Rlci5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBfb2JqLnJlbW92ZUF0dHIoICdzdHlsZScgKVxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9yZW1vdmVJdGVtID0gZnVuY3Rpb24oIG9iaiApIHtcblxuICAgICAgICAgICAgX29iai5yZW1vdmVDbGFzcyggJ2lzLWxvYWRpbmcnICk7XG5cbiAgICAgICAgICAgIHZhciBjdXJSb3cgPSBvYmosXG4gICAgICAgICAgICAgICAgdGltZXI7XG5cbiAgICAgICAgICAgIGN1clJvdy5jc3MoICdoZWlnaHQnLCBjdXJSb3cub3V0ZXJIZWlnaHQoKSApO1xuXG4gICAgICAgICAgICBjdXJSb3cuYW5pbWF0ZSgge1xuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDBcbiAgICAgICAgICAgICAgICB9LCAzMDAsXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdGltZXIgPSBzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJSb3cucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoIHRpbWVyICk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMCApO1xuXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9hamF4UmVxdWVzdCA9IGZ1bmN0aW9uICggb2JqICkge1xuXG4gICAgICAgICAgICBfb2JqLmFkZENsYXNzKCAnaXMtbG9hZGluZycgKTtcblxuICAgICAgICAgICAgX3JlcXVlc3QuYWJvcnQoKTtcblxuICAgICAgICAgICAgdmFyIGN1clJvdyA9IG9iai5wYXJlbnRzKCAnLmNhcnQtbGlzdF9fcm93JyApLFxuICAgICAgICAgICAgICAgIF9kYXRhID0gY3VyUm93LmRhdGEoICdjYXJ0JyApO1xuXG4gICAgICAgICAgICBfcmVxdWVzdCA9ICQuYWpheCgge1xuICAgICAgICAgICAgICAgIHVybDogX3VybCxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3JlbW92ZV9jYXJ0X2l0ZW0nLFxuICAgICAgICAgICAgICAgICAgICBrZXk6IF9kYXRhLmtleSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IF9kYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogX2RhdGEudmFsdWVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICggZGF0YSApIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIGRhdGEgKXtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBkYXRhLmNhcnRDb3VudFByb2R1Y3RzID09IDAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NoZWNrQ291bnRlcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcmVtb3ZlSXRlbSggY3VyUm93ICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9zZXRUb3RhbFZhbHVlKCBkYXRhICk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZXF1ZXN0LmFib3J0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICggWE1MSHR0cFJlcXVlc3QgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggWE1MSHR0cFJlcXVlc3Quc3RhdHVzVGV4dCAhPSBcImFib3J0XCIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCAnZXJyJyApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9hamF4Q291cG9uUmVxdWVzdCA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgX3JlcXVlc3QuYWJvcnQoKTtcblxuICAgICAgICAgICAgX3JlcXVlc3QgPSAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIHVybDogX3VybCxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2FwcGx5X2NvdXBvbl90b19vcmRlcicsXG4gICAgICAgICAgICAgICAgICAgIGNvdXBvbl9uYW1lOiBfY291cG9uSW5wdXQudmFsKClcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICBfY2hlY2tDb3Vwb24oIGRhdGEgKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoIFhNTEh0dHBSZXF1ZXN0ICkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIFhNTEh0dHBSZXF1ZXN0LnN0YXR1c1RleHQgIT0gXCJhYm9ydFwiICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvciggJ2VycicgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9jaGVja0NvdXBvbiA9IGZ1bmN0aW9uKCBkYXRhICl7XG5cbiAgICAgICAgICAgIGlmICggZGF0YS5zdGF0dXMgPj0gMSApIHtcblxuICAgICAgICAgICAgICAgIF9jb3Vwb25NZXNzYWdlLmh0bWwoIGRhdGEubWVzc2FnZSArJy4gRGlzY291bnQ6JysgZGF0YS5kaXNjb3VudCApO1xuICAgICAgICAgICAgICAgIF9jb3Vwb25Gb3JtLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICAgICAgX3NldFRvdGFsVmFsdWUoIGRhdGEgKTtcblxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgdmFyIHRpbWVyO1xuXG4gICAgICAgICAgICAgICAgX2NvdXBvbk1lc3NhZ2UuaHRtbCggJ1dyb25nIHByb21vIGNvZGUuIFRyeSBhZ2FpbicgKS5hZGRDbGFzcyggJ2lzLXNob3cnICk7XG5cbiAgICAgICAgICAgICAgICB0aW1lciA9IHNldFRpbWVvdXQoIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX2NvdXBvbk1lc3NhZ2UucmVtb3ZlQ2xhc3MoICdpcy1zaG93JyApO1xuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoIHRpbWVyICk7XG4gICAgICAgICAgICAgICAgfSwgMjUwMCApO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIF9vYmoucmVtb3ZlQ2xhc3MoICdpcy1sb2FkaW5nJyApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9zZXRUb3RhbFZhbHVlID0gZnVuY3Rpb24oIGRhdGEgKSB7XG5cbiAgICAgICAgICAgIF90b3RhbFdyYXAuaHRtbCggJCggZGF0YS50b3RhbCApLnRleHQoKSAgKTtcbiAgICAgICAgICAgIEJhc2tldFVwZGF0ZSggZGF0YS50b3RhbCApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9jb25zdHJ1Y3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIF9vbkV2ZW50cygpO1xuICAgICAgICB9O1xuXG4gICAgX2NvbnN0cnVjdCgpXG59O1xuXG52YXIgQ2hhbmdlQm9va0xhbmd1YWdlID0gZnVuY3Rpb24gKCBvYmogKSB7XG5cbiAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgX2Jvb2tQaWN0dXJlV3JhcCA9IF9vYmouZmluZCggJy5ib29rX19waWN0dXJlJyApLFxuICAgICAgICBfYm9va1BpY3R1cmUgPSBfYm9va1BpY3R1cmVXcmFwLmZpbmQoICdpbWcnICksXG4gICAgICAgIF9sYW5ndWFnZVdyYXAgPSBfb2JqLmZpbmQoICcuYm9va19fbGFuZ3VhZ2UnICksXG4gICAgICAgIF9sYW5ndWFnZUl0ZW0gPSBfbGFuZ3VhZ2VXcmFwLmZpbmQoICdpbnB1dCcgKSxcbiAgICAgICAgX2FkZENhcnRCdG4gPSBfb2JqLmZpbmQoICcuYWpheC1hZGQtdG8tY2FydCcgKTtcblxuICAgIHZhciBfb25FdmVudHMgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgX2xhbmd1YWdlSXRlbS5vbiggJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF9jaGFuZ2VMYW5ndWFnZSggJCggdGhpcyApICk7XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2NoYW5nZUxhbmd1YWdlID0gZnVuY3Rpb24oIG9iaiApIHtcblxuICAgICAgICAgICAgdmFyIGN1ckl0ZW0gPSBvYmosXG4gICAgICAgICAgICAgICAgY3VySWQgPSBjdXJJdGVtLnZhbCgpO1xuXG4gICAgICAgICAgICBfYm9va1BpY3R1cmUuYWRkQ2xhc3MoICdoaWRlJyApO1xuICAgICAgICAgICAgX2Jvb2tQaWN0dXJlLmZpbHRlciggJ1tkYXRhLWlkPScrIGN1cklkICsnXScgKS5yZW1vdmVDbGFzcyggJ2hpZGUnICk7XG5cbiAgICAgICAgICAgIF9hZGRDYXJ0QnRuLmF0dHIoICdkYXRhLWlkJywgY3VySWQgKVxuXG4gICAgICAgIH0sXG4gICAgICAgIF9jb25zdHJ1Y3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIF9vbkV2ZW50cygpO1xuICAgICAgICAgICAgX2xhbmd1YWdlSXRlbS5lcSgwKS50cmlnZ2VyKCAnY2xpY2snICk7XG4gICAgICAgIH07XG5cbiAgICBfY29uc3RydWN0KClcbn07XG5cbnZhciBJbml0Sm9pblVzU2xpZGVyID0gZnVuY3Rpb24gKG9iaikge1xuXG4gICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgX3N3aXBlclNsaXNlciA9IF9vYmouZmluZCggJy5zd2lwZXItY29udGFpbmVyJyApLFxuICAgICAgICBfc3dpcGVyO1xuXG4gICAgLy9wcml2YXRlIG1ldGhvZHNcbiAgICB2YXIgX2luaXRTbGlkZXIgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIF9zd2lwZXIgPSBuZXcgU3dpcGVyKCBfc3dpcGVyU2xpc2VyLCB7XG4gICAgICAgICAgICAgICAgZWZmZWN0OiAnc2xpZGUnLFxuICAgICAgICAgICAgICAgIHNwZWVkOiA1MDAsXG4gICAgICAgICAgICAgICAgbG9vcDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0aHJlc2hvbGQ6IDEwLFxuICAgICAgICAgICAgICAgIHNwYWNlQmV0d2VlbjogMjAsXG4gICAgICAgICAgICAgICAgc2xpZGVzUGVyVmlldzogJ2F1dG8nLFxuICAgICAgICAgICAgICAgIGNlbnRlcmVkU2xpZGVzOiB0cnVlXG4gICAgICAgICAgICB9ICk7XG5cblxuICAgICAgICB9LFxuICAgICAgICBfY29uc3RydWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBfaW5pdFNsaWRlcigpO1xuICAgICAgICB9O1xuXG4gICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgX2NvbnN0cnVjdCgpO1xuXG59O1xuXG52YXIgSW5pdFNjcm9sbCA9IGZ1bmN0aW9uICggb2JqICkge1xuXG4gICAgdmFyIF9vYmogPSBvYmosXG4gICAgICAgIF9jYXRlZ29yaWVzRnJhbWUgPSBfb2JqLmZpbmQoICcuY2F0ZWdvcmllc19fd3JhcCcgKSxcbiAgICAgICAgX3BzID0gbnVsbCxcbiAgICAgICAgX3Njcm9sbFdyYXAsXG4gICAgICAgIF93aW5kb3cgPSAkKCB3aW5kb3cgKTtcblxuICAgIHZhciBfaW5pdFNjcm9sbCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBpZiAoIF9wcyAhPT0gbnVsbCApIHtcbiAgICAgICAgICAgICAgICBfcHMuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgIF9wcyA9IG51bGw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIF9zY3JvbGxXcmFwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciggJy5jYXRlZ29yaWVzX193cmFwJyApO1xuXG4gICAgICAgICAgICBpZiAoIF9jYXRlZ29yaWVzRnJhbWUub3V0ZXJXaWR0aCgpID4gX3dpbmRvdy5vdXRlcldpZHRoKCkgKSB7XG5cbiAgICAgICAgICAgICAgICBfcHMgPSBuZXcgUGVyZmVjdFNjcm9sbGJhciggX3Njcm9sbFdyYXAsIHtcbiAgICAgICAgICAgICAgICAgICAgc3VwcHJlc3NTY3JvbGxZOiB0cnVlXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgX3Njcm9sbFRvQWN0aXZlKCk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuICAgICAgICBfb25FdmVudCA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgX3dpbmRvdy5vbiggJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfaW5pdFNjcm9sbCgpO1xuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9zY3JvbGxUb0FjdGl2ZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgdmFyIGFjdGl2ZUl0ZW0gPSBfY2F0ZWdvcmllc0ZyYW1lLmZpbmQoICcuaXMtYWN0aXZlJyApO1xuXG4gICAgICAgICAgICBpZiAoIGFjdGl2ZUl0ZW0ubGVuZ3RoID4gMCApe1xuXG4gICAgICAgICAgICAgICAgdmFyIHdpbmRvd1dpZHRoID0gX3dpbmRvdy5vdXRlcldpZHRoKCksXG4gICAgICAgICAgICAgICAgICAgIHdyYXBXaWR0aCA9IGFjdGl2ZUl0ZW0ub2Zmc2V0KCkubGVmdDtcblxuICAgICAgICAgICAgICAgIF9zY3JvbGxXcmFwLnNjcm9sbExlZnQgPSB3cmFwV2lkdGgvMiAtIHdpbmRvd1dpZHRoLzIgKyB3cmFwV2lkdGg7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuICAgICAgICBfY29uc3RydWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBfb25FdmVudCgpO1xuICAgICAgICAgICAgX2luaXRTY3JvbGwoKTtcbiAgICAgICAgfTtcblxuICAgIF9jb25zdHJ1Y3QoKVxufTtcblxudmFyIEluaXRTbGlkZXIgPSBmdW5jdGlvbiAob2JqKSB7XG5cbiAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgIHZhciBfb2JqID0gb2JqLFxuICAgICAgICBfc3dpcGVyU2xpc2VyID0gX29iai5maW5kKCAnLnN3aXBlci1jb250YWluZXInICksXG4gICAgICAgIF9zd2lwZXJTbGlkZSA9IF9vYmouZmluZCggJy5zd2lwZXItc2xpZGUnICksXG4gICAgICAgIF9zd2lwZXJQYWdpbmF0aW9uID0gX29iai5maW5kKCAnLnBhZ2luYXRpb24nICksXG4gICAgICAgIF93aW5kb3cgPSAkKCB3aW5kb3cgKSxcbiAgICAgICAgX3N3aXBlcixcbiAgICAgICAgX2lzTW9iaWxlU2xpZGVyID0gZmFsc2U7XG5cbiAgICAvL3ByaXZhdGUgbWV0aG9kc1xuICAgIHZhciBfb25FdmVudCA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgX3dpbmRvdy5vbiggJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfdXBkYXRlU2xpZGVyKCk7XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2luaXRTbGlkZXIgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIGlmICggX3N3aXBlclNsaWRlLmxlbmd0aCA9PT0gMSApe1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIF93aW5kb3cub3V0ZXJXaWR0aCgpID49IDc2OCApIHtcblxuICAgICAgICAgICAgICAgIF9pc01vYmlsZVNsaWRlciA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgX3N3aXBlciA9IG5ldyBTd2lwZXIoIF9zd2lwZXJTbGlzZXIsIHtcbiAgICAgICAgICAgICAgICAgICAgZWZmZWN0OiAnZmFkZScsXG4gICAgICAgICAgICAgICAgICAgIHNwZWVkOiAzMDAsXG4gICAgICAgICAgICAgICAgICAgIGxvb3A6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgICAgICAgICAgICAgICAgIHRocmVzaG9sZDogMTAsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9wbGF5OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogNTAwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVPbkludGVyYWN0aW9uOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsOiBfc3dpcGVyUGFnaW5hdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrYWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKCBfd2luZG93Lm91dGVyV2lkdGgoKSA8IDc2OCApIHtcblxuICAgICAgICAgICAgICAgIF9pc01vYmlsZVNsaWRlciA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICBfc3dpcGVyID0gbmV3IFN3aXBlciggX3N3aXBlclNsaXNlciwge1xuICAgICAgICAgICAgICAgICAgICBlZmZlY3Q6ICdmYWRlJyxcbiAgICAgICAgICAgICAgICAgICAgc3BlZWQ6IDMwMCxcbiAgICAgICAgICAgICAgICAgICAgbG9vcDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICAgICAgICAgICAgICAgICAgdGhyZXNob2xkOiAxMCxcbiAgICAgICAgICAgICAgICAgICAgYXV0b0hlaWdodDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWw6IF9zd2lwZXJQYWdpbmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2thYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuICAgICAgICBfdXBkYXRlU2xpZGVyID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIGlmICggX3dpbmRvdy5vdXRlcldpZHRoKCkgPj0gNzY4ICYmIF9pc01vYmlsZVNsaWRlciApIHtcblxuICAgICAgICAgICAgICAgIF9zd2lwZXIuZGVzdHJveSggdHJ1ZSwgdHJ1ZSApO1xuICAgICAgICAgICAgICAgIF9pbml0U2xpZGVyKCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIF93aW5kb3cub3V0ZXJXaWR0aCgpIDwgNzY4ICYmICFfaXNNb2JpbGVTbGlkZXIgKSB7XG5cbiAgICAgICAgICAgICAgICBfc3dpcGVyLmRlc3Ryb3koIHRydWUsIHRydWUgKTtcbiAgICAgICAgICAgICAgICBfaW5pdFNsaWRlcigpO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCggZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBfc3dpcGVyLnVwZGF0ZSggKTtcbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuICAgICAgICBfY29uc3RydWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBfb25FdmVudCgpO1xuICAgICAgICAgICAgX2luaXRTbGlkZXIoKTtcbiAgICAgICAgfTtcblxuICAgIC8vcHVibGljIHByb3BlcnRpZXNcblxuICAgIC8vcHVibGljIG1ldGhvZHNcblxuICAgIF9jb25zdHJ1Y3QoKTtcblxufTtcblxudmFyIEluaXRTb2NpYWxTaGFyZSA9IGZ1bmN0aW9uICggb2JqICkge1xuXG4gICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICB2YXIgX3NvY2lhbFdyYXAgPSBvYmosXG4gICAgICAgIF9zb2NpYWxEYXRhID0gX3NvY2lhbFdyYXAuZGF0YSggJ3NvY2lhbCcgKSxcbiAgICAgICAgX3NvY2lhbEl0ZW0gPSBfc29jaWFsV3JhcC5maW5kKCAnLnNvY2lhbF9pdGVtJyApO1xuXG4gICAgLy9wcml2YXRlIG1ldGhvZHNcbiAgICB2YXIgX2luaXRTaGFyZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgX3NvY2lhbEl0ZW0uZWFjaCggZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgJCggdGhpcyApLlNoYXJlTGluaygge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogdW5lc2NhcGUoIF9zb2NpYWxEYXRhWyAndGl0bGUnIF0gKSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogdW5lc2NhcGUoICBfc29jaWFsRGF0YVsgJ3RleHQnIF0gKSxcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IF9zb2NpYWxEYXRhWyAnaW1hZ2UnIF0sXG4gICAgICAgICAgICAgICAgICAgIHVybDogX3NvY2lhbERhdGFbICd1cmwnIF0sXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiA2NDAsXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDgwXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2NvbnN0cnVjdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgX2luaXRTaGFyZSgpO1xuICAgICAgICB9O1xuXG4gICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgX2NvbnN0cnVjdCgpO1xuXG59O1xuXG52YXIgSW5pdFRhYmxlU2Nyb2xsID0gZnVuY3Rpb24gKCBvYmogKSB7XG5cbiAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgX3RhYmxlRnJhbWUgPSBfb2JqLmZpbmQoICcub3JkZXJzX193cmFwJyApLFxuICAgICAgICBfcHMgPSBudWxsLFxuICAgICAgICBfd2luZG93ID0gJCggd2luZG93ICk7XG5cbiAgICB2YXIgX2luaXRTY3JvbGwgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgaWYgKCBfdGFibGVGcmFtZS5vdXRlcldpZHRoKCkgPj0gX3dpbmRvdy5vdXRlcldpZHRoKCkgKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgc2Nyb2xsV3JhcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoICcub3JkZXJzJyApO1xuXG4gICAgICAgICAgICAgICAgX3BzID0gbmV3IFBlcmZlY3RTY3JvbGxiYXIoIHNjcm9sbFdyYXAsIHtcbiAgICAgICAgICAgICAgICAgICAgc3VwcHJlc3NTY3JvbGxZOiB0cnVlXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2NvbnN0cnVjdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgX2luaXRTY3JvbGwoKTtcbiAgICAgICAgfTtcblxuICAgIF9jb25zdHJ1Y3QoKVxufTtcblxudmFyIEZpeEhlYWRlciA9IGZ1bmN0aW9uKCBvYmogKSB7XG5cbiAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgIHZhciBfaGVhZGVyID0gb2JqLFxuICAgICAgICBfbW9iaWxlRml4ZWRTZWN0aW9uID0gX2hlYWRlci5maW5kKCAnLnNpdGVfX2hlYWRlci1maXhlZCcgKSxcbiAgICAgICAgX2Rlc2t0b3BGaXhlZFNlY3Rpb24gPSBfaGVhZGVyLmZpbmQoICcuc2l0ZV9faGVhZGVyLXdyYXAnICksXG4gICAgICAgIF9maXhlZFdyYXAgPSBudWxsLCBfc3RhcnRQb2ludCA9IG51bGwsIF9jdXJEZXZpc2VTaXplID0gMCxcbiAgICAgICAgX3dpbmRvdyA9ICQoIHdpbmRvdyApO1xuXG4gICAgLy9wcml2YXRlIG1ldGhvZHNcbiAgICB2YXIgX29uRXZlbnQgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgX3dpbmRvdy5vbigge1xuICAgICAgICAgICAgICAgICdyZXNpemUnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF9jaGVja0ZpeGVkV3JhcCgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgJ3Njcm9sbCc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX2NoZWNrUG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2NoZWNrUG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfd2luZG93LnNjcm9sbFRvcCgpID4gX3N0YXJ0UG9pbnQgPyBfZml4SGVhZGVyKCkgOiBfdW5maXhIZWFkZXIoKVxuICAgICAgICB9LFxuICAgICAgICBfZml4SGVhZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX2ZpeGVkV3JhcC5hZGRDbGFzcyggJ2lzLWZpeGVkJyApXG4gICAgICAgIH0sXG4gICAgICAgIF91bmZpeEhlYWRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF9maXhlZFdyYXAucmVtb3ZlQ2xhc3MoICdpcy1maXhlZCcgKVxuICAgICAgICB9LFxuICAgICAgICBfY2hlY2tGaXhlZFdyYXAgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgaWYgKCBfY3VyRGV2aXNlU2l6ZSAhPT0gMCAmJiAoICggX3dpbmRvdy5vdXRlcldpZHRoKCkgPCAxMjAwICYmIF9jdXJEZXZpc2VTaXplIDwgMTIwMCApIHx8XG4gICAgICAgICAgICAgICAgKCBfd2luZG93Lm91dGVyV2lkdGgoKSA+PSAxMjAwICYmIF9jdXJEZXZpc2VTaXplID49IDEyMDAgKSApICl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICggX2ZpeGVkV3JhcCAhPT0gbnVsbCApe1xuICAgICAgICAgICAgICAgIF9maXhlZFdyYXAucmVtb3ZlQ2xhc3MoICdpcy1maXhlZCcgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCBfd2luZG93Lm91dGVyV2lkdGgoKSA+PSAxMjAwICApIHtcbiAgICAgICAgICAgICAgICBfZml4ZWRXcmFwID0gX2Rlc2t0b3BGaXhlZFNlY3Rpb247XG4gICAgICAgICAgICAgICAgX3N0YXJ0UG9pbnQgPSAyNTM7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIF9maXhlZFdyYXAgPSBfbW9iaWxlRml4ZWRTZWN0aW9uO1xuICAgICAgICAgICAgICAgIF9zdGFydFBvaW50ID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgX2N1ckRldmlzZVNpemUgPSBfd2luZG93Lm91dGVyV2lkdGgoKTtcblxuICAgICAgICAgICAgX2NoZWNrUG9zaXRpb24oKTtcblxuICAgICAgICB9LFxuICAgICAgICBfY29uc3RydWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBfb25FdmVudCgpO1xuICAgICAgICAgICAgX2NoZWNrRml4ZWRXcmFwKCk7XG4gICAgICAgIH07XG5cbiAgICAvL3B1YmxpYyBwcm9wZXJ0aWVzXG5cbiAgICAvL3B1YmxpYyBtZXRob2RzXG5cbiAgICBfY29uc3RydWN0KCk7XG59O1xuXG52YXIgRnJlZVJlY2lwZXNTZWN0aW9uID0gZnVuY3Rpb24oIG9iaiApIHtcblxuICAgIC8vcHJpdmF0ZSBwcm9wZXJ0aWVzXG4gICAgdmFyIF9vYmogPSBvYmosXG4gICAgICAgIF9vcHRpb25zID0gX29iai5kYXRhKCAnb3B0aW9ucycgKSB8fCB7XCJpc19zYXZlX2NhdGVnb3J5XCI6XCJmYWxzZVwiLFwiaXNfc2F2ZV9wYWdlXCI6XCJmYWxzZVwiLFwiaXNfc2hvd190aXRsZVwiOlwiZmFsc2VcIn0sXG4gICAgICAgIF9vcHRpb25zU2F2ZUNhdGVnb3J5ID0gKCBfb3B0aW9uc1snaXNfc2F2ZV9jYXRlZ29yeSddID09PSAndHJ1ZScgKSB8fCBmYWxzZSxcbiAgICAgICAgX29wdGlvbnNTaG93RmlsdGVyQXNEZWZhdWx0ID0gKCBfb3B0aW9uc1snc2hvd19hc19kZWZhdWx0J10gPT09ICd0cnVlJyApIHx8IGZhbHNlLFxuICAgICAgICBfb3B0aW9uc1NhdmVQYWdlID0gKCBfb3B0aW9uc1snaXNfc2F2ZV9wYWdlJ10gPT09ICd0cnVlJyApIHx8IGZhbHNlLFxuICAgICAgICBfb3B0aW9uc1Nob3ZlVGl0bGUgPSAoIF9vcHRpb25zWydpc19zaG93X3RpdGxlJ10gPT09ICd0cnVlJyApIHx8IGZhbHNlLFxuICAgICAgICBfY2F0ZWdvcmllc0ZyYW1lID0gX29iai5maW5kKCAnLmZyZWUtcmVjaXBlc19fY2F0ZWdvcmllcy13cmFwJyApLFxuICAgICAgICBfY2F0ZWdvcmllc0l0ZW0gPSBfY2F0ZWdvcmllc0ZyYW1lLmZpbmQoICcuZnJlZS1yZWNpcGVzX19jYXRlZ29yaWVzLWl0ZW0nICksXG4gICAgICAgIF9jYXRhbG9nRnJhbWUgPSBfb2JqLmZpbmQoICcuZnJlZS1yZWNpcGVzX19jYXRhbG9nJyApLFxuICAgICAgICBfY2F0YWxvZ1dyYXAgPSBfY2F0YWxvZ0ZyYW1lLmZpbmQoICcuZnJlZS1yZWNpcGVzX19jYXRhbG9nLXdyYXAnICksXG4gICAgICAgIF9wYWdpbmF0aW9uID0gX29iai5maW5kKCAnLmZyZWUtcmVjaXBlc19fcGFnaW5hdGlvbicgKSxcbiAgICAgICAgX3dpbmRvdyA9ICQoIHdpbmRvdyApLFxuICAgICAgICBfdXJsID0gJCggJ2JvZHknICkuZGF0YSggJ2FjdGlvbicgKSxcbiAgICAgICAgX2lmRmlyc3RQYWdlID0gdHJ1ZSxcbiAgICAgICAgX3Njcm9sbFdyYXAsXG4gICAgICAgIF9yZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCksXG4gICAgICAgIF9wcyA9IG51bGwsIF9yZWNpcGVzU3RvcmFnZSA9IHt9LFxuICAgICAgICBfaXNJbml0aWFsRmlsdGVyU2V0dGluZyA9IHRydWU7XG4gICAgICAgIFxuICAgIC8vcHJpdmF0ZSBtZXRob2RzXG4gICAgdmFyIF9vbkV2ZW50ID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIF93aW5kb3cub24oICdyZXNpemUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3VwZGF0ZVN0eWxlcygpO1xuICAgICAgICAgICAgICAgIF9pbml0TW9iaWxlQ2F0YWxvZ1Njcm9sbCgpO1xuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICBfY2F0ZWdvcmllc0l0ZW0ub24oICdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfY2hhbmdlQ2F0ZWdvcnkoICQoIHRoaXMgKSwgMSApO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICB9LFxuICAgICAgICBfYWN0aXZlQXRGaXJzdFRpbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICggX29wdGlvbnNTYXZlQ2F0ZWdvcnkgfHwgX29wdGlvbnNTYXZlUGFnZSApIHtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAoIV9vcHRpb25zU2hvd0ZpbHRlckFzRGVmYXVsdCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yYWdlID0gSlNPTi5wYXJzZSggbG9jYWxTdG9yYWdlLmdldEl0ZW0oICdGcmVlUmVjaXBlcycgKSApO1xuICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggc3RvcmFnZSA9PSBudWxsIHx8IF9vcHRpb25zU2hvd0ZpbHRlckFzRGVmYXVsdCApe1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgX2NhdGVnb3JpZXNJdGVtLmVxKDApLnRyaWdnZXIoICdjbGljaycgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGFjdGl2ZUNhdGVnb3J5ID0gc3RvcmFnZVsgJ2NhdGVnb3JpZXNJRCcgXSB8fCBfY2F0ZWdvcmllc0l0ZW0uZXEoMCkuZGF0YSggJ2lkJyApLFxuICAgICAgICAgICAgICAgICAgICBhY3RpdmVQYWdlID0gc3RvcmFnZVsgJ3BhZ2UnIF0gfHwgMTtcblxuICAgICAgICAgICAgICAgIF9jaGFuZ2VDYXRlZ29yeSggX2NhdGVnb3JpZXNJdGVtLmZpbHRlciggJ1tkYXRhLWlkPScrIGFjdGl2ZUNhdGVnb3J5ICsnXScgKSwgYWN0aXZlUGFnZSApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG4gICAgICAgIF9hamF4UmVxdWVzdCA9IGZ1bmN0aW9uICggaWQsIHBhZ2UgKSB7XG5cbiAgICAgICAgICAgIF9yZXF1ZXN0LmFib3J0KCk7XG5cbiAgICAgICAgICAgIF9yZXF1ZXN0ID0gJC5hamF4KCB7XG4gICAgICAgICAgICAgICAgdXJsOiBfdXJsLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnZ2V0X3JlY2lwZXNfYnlfdGF4b25vbXknLFxuICAgICAgICAgICAgICAgICAgICBwYWdlOiBwYWdlLFxuICAgICAgICAgICAgICAgICAgICB0YXhJZDogaWRcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgX3NldEdhbGxlcnkoIGRhdGEgKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoIFhNTEh0dHBSZXF1ZXN0ICkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIFhNTEh0dHBSZXF1ZXN0LnN0YXR1c1RleHQgIT0gXCJhYm9ydFwiICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvciggJ2VycicgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICB9LFxuICAgICAgICBfaW5pdE1vYmlsZUNhdGFsb2dTY3JvbGwgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIF9zY3JvbGxXcmFwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciggJy5mcmVlLXJlY2lwZXNfX2NhdGVnb3JpZXMtd3JhcCcgKTtcblxuICAgICAgICAgICAgaWYgKCBfcHMgPT09IG51bGwgJiYgX2NhdGVnb3JpZXNGcmFtZS5vdXRlcldpZHRoKCkgPiBfd2luZG93Lm91dGVyV2lkdGgoKSApIHtcblxuICAgICAgICAgICAgICAgIF9wcyA9IG5ldyBQZXJmZWN0U2Nyb2xsYmFyKCBfc2Nyb2xsV3JhcCwge1xuICAgICAgICAgICAgICAgICAgICBzdXBwcmVzc1Njcm9sbFk6IHRydWVcbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICBfc2Nyb2xsVG9BY3RpdmUoKTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmICggX3BzICE9PSBudWxsICYmIF9jYXRlZ29yaWVzRnJhbWUub3V0ZXJXaWR0aCgpIDw9IF93aW5kb3cub3V0ZXJXaWR0aCgpICkge1xuXG4gICAgICAgICAgICAgICAgX3BzLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICBfcHMgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgX2luaXRNb2JpbGVDYXRhbG9nU2Nyb2xsKCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIF9wcyAhPT0gbnVsbCApe1xuXG4gICAgICAgICAgICAgICAgX3Njcm9sbFRvQWN0aXZlKCk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuICAgICAgICBfY3JlYXRlSXRlbUZyYW1lID0gZnVuY3Rpb24gKCBkYXRhICkge1xuXG4gICAgICAgICAgICB2YXIgcmVjaXBlc0l0ZW0gPSBkYXRhLFxuICAgICAgICAgICAgICAgIHJlY2lwZXNJdGVtTGluayA9IHJlY2lwZXNJdGVtLmxpbmssXG4gICAgICAgICAgICAgICAgcmVjaXBlc0l0ZW1JbWFnZSA9IHJlY2lwZXNJdGVtLmltYWdlLFxuICAgICAgICAgICAgICAgIHJlY2lwZXNJdGVtVGl0bGUgPSByZWNpcGVzSXRlbS50aXRsZSxcbiAgICAgICAgICAgICAgICByZWNpcGVzRnJhbWVUaXRsZSA9ICcnLFxuICAgICAgICAgICAgICAgIGZyYW1lSXRlbTtcblxuICAgICAgICAgICAgaWYgKCBfb3B0aW9uc1Nob3ZlVGl0bGUgKSB7XG4gICAgICAgICAgICAgICAgcmVjaXBlc0ZyYW1lVGl0bGUgPSAnPGRpdj4nKyByZWNpcGVzSXRlbVRpdGxlICsnPC9kaXY+JztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnJhbWVJdGVtID0gJzxhIGhyZWY9XCInKyByZWNpcGVzSXRlbUxpbmsgKydcIiBjbGFzcz1cImZyZWUtcmVjaXBlc19faXRlbVwiPicgK1xuICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZnJlZS1yZWNpcGVzX19waWN0dXJlXCI+JyArXG4gICAgICAgICAgICAgICAgJzxpbWcgc3JjPVwiJysgcmVjaXBlc0l0ZW1JbWFnZSArJ1wiIGFsdD1cIicrIHJlY2lwZXNJdGVtVGl0bGUgKydcIiAvPicgK1xuICAgICAgICAgICAgICAgICc8L2Rpdj4nICsgcmVjaXBlc0ZyYW1lVGl0bGUgKyAnPC9hPic7XG5cbiAgICAgICAgICAgIHJldHVybiBmcmFtZUl0ZW07XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2NoYW5nZUNhdGVnb3J5ID0gZnVuY3Rpb24gKCBidG4sIHBhZ2UgKSB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciBjdXJCdG4gPSBidG4sXG4gICAgICAgICAgICAgICAgY3VyUGFnZSA9IHBhZ2U7XG5cbiAgICAgICAgICAgIF9jYXRlZ29yaWVzSXRlbS5yZW1vdmVDbGFzcyggJ2lzLWFjdGl2ZScgKTtcbiAgICAgICAgICAgIGN1ckJ0bi5hZGRDbGFzcyggJ2lzLWFjdGl2ZScgKTtcblxuICAgICAgICAgICAgaWYgKCBfb3B0aW9uc1NhdmVDYXRlZ29yeSApIHtcbiAgICAgICAgICAgICAgICBfcmVjaXBlc1N0b3JhZ2VbJ2NhdGVnb3JpZXNJRCddID0gY3VyQnRuLmRhdGEoJ2lkJyk7XG4gICAgICAgICAgICAgICAgX3JlY2lwZXNTdG9yYWdlWydwYWdlJ10gPSBjdXJQYWdlO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFfb3B0aW9uc1Nob3dGaWx0ZXJBc0RlZmF1bHQgJiYgIV9pc0luaXRpYWxGaWx0ZXJTZXR0aW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdGcmVlUmVjaXBlcycsIEpTT04uc3RyaW5naWZ5KF9yZWNpcGVzU3RvcmFnZSkpO1xuICAgICAgICAgICAgICAgICAgICBfaXNJbml0aWFsRmlsdGVyU2V0dGluZyA9IGZhbHNlXG4gICAgICAgICAgICAgICAgfVxuICAgXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChfaXNJbml0aWFsRmlsdGVyU2V0dGluZykge1xuICAgICAgICAgICAgICAgIF9pc0luaXRpYWxGaWx0ZXJTZXR0aW5nID0gZmFsc2VcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCAhX29wdGlvbnNTYXZlUGFnZSApeyBjdXJQYWdlID0gMSB9XG5cbiAgICAgICAgICAgIF9wcmVwYXJhdGlvbkZyYW1lKCk7XG4gICAgICAgICAgICBfYWpheFJlcXVlc3QoIGN1ckJ0bi5kYXRhKCAnaWQnICksIGN1clBhZ2UgKTtcblxuICAgICAgICB9LFxuICAgICAgICBfY2hhbmdlUGFnZSA9IGZ1bmN0aW9uICggYnRuICkge1xuXG4gICAgICAgICAgICB2YXIgY3VyQnRuID0gYnRuLFxuICAgICAgICAgICAgICAgIGN1ckNhdGVnb3JpZXMgPSBfY2F0ZWdvcmllc0l0ZW0uZmlsdGVyKCAnLmlzLWFjdGl2ZScgKSxcbiAgICAgICAgICAgICAgICBwYWdlQnRuID0gX3BhZ2luYXRpb24uZmluZCggJ3NwYW4nICk7XG5cbiAgICAgICAgICAgIHBhZ2VCdG4ucmVtb3ZlQ2xhc3MoICdpcy1hY3RpdmUnICk7XG4gICAgICAgICAgICBjdXJCdG4uYWRkQ2xhc3MoICdpcy1hY3RpdmUnICk7XG5cbiAgICAgICAgICAgIF9jYXRhbG9nRnJhbWUuYWRkQ2xhc3MoICdsb2FkIGxvYWQtcGFnZScgKTtcbiAgICAgICAgICAgIF9jYXRhbG9nV3JhcC5lbXB0eSgpO1xuXG4gICAgICAgICAgICBpZiAoIF9vcHRpb25zU2F2ZUNhdGVnb3J5ICl7XG4gICAgICAgICAgICAgICAgX3JlY2lwZXNTdG9yYWdlWyAnY2F0ZWdvcmllc0lEJyBdID0gY3VyQ2F0ZWdvcmllcy5kYXRhKCAnaWQnICk7XG4gICAgICAgICAgICAgICAgX3JlY2lwZXNTdG9yYWdlWyAncGFnZScgXSA9IGN1ckJ0bi5hdHRyKCAnZGF0YS1wYWdlJyApO1xuXG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oICdGcmVlUmVjaXBlcycsIEpTT04uc3RyaW5naWZ5KCBfcmVjaXBlc1N0b3JhZ2UgKSApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBfYWpheFJlcXVlc3QoIGN1ckNhdGVnb3JpZXMuZGF0YSggJ2lkJyApLCBjdXJCdG4uYXR0ciggJ2RhdGEtcGFnZScgKSApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9wcmVwYXJhdGlvbkZyYW1lID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICBfY2F0YWxvZ0ZyYW1lLmFkZENsYXNzKCAnbG9hZCcgKTtcblxuICAgICAgICAgICAgX2NhdGFsb2dXcmFwLmVtcHR5KCk7XG4gICAgICAgICAgICBfcGFnaW5hdGlvbi5lbXB0eSgpO1xuXG4gICAgICAgICAgICBfaWZGaXJzdFBhZ2UgPSB0cnVlO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9zZXRHYWxsZXJ5ID0gZnVuY3Rpb24gKCBkYXRhICkge1xuXG4gICAgICAgICAgICBpZiggZGF0YS5yZWNpcGVzID09IHVuZGVmaW5lZCApe1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHJlY2lwZXMgPSBkYXRhLnJlY2lwZXMsXG4gICAgICAgICAgICAgICAgdG90YWxQYWdlcyA9IGRhdGEubWF4UGFnZXMsXG4gICAgICAgICAgICAgICAgcmVjaXBlc1RvdGFsID0gcmVjaXBlcy5sZW5ndGgsXG4gICAgICAgICAgICAgICAgY29sdW1ucyA9IDIsXG4gICAgICAgICAgICAgICAgbnVtYmVySW5Db2xsID0gTWF0aC5yb3VuZCggcmVjaXBlc1RvdGFsIC8gY29sdW1ucyApLFxuICAgICAgICAgICAgICAgIGV4dHJhTnVtYmVyID0gTWF0aC5hYnMoIHJlY2lwZXNUb3RhbCAtIG51bWJlckluQ29sbCAqIGNvbHVtbnMgKSxcbiAgICAgICAgICAgICAgICBjb2x1bW5GcmFtZSA9ICQoICc8bGkvPicgKSxcbiAgICAgICAgICAgICAgICBjdXJJdGVtID0gMCwgY3VyQ29sdW1uID0gMTtcblxuICAgICAgICAgICAgJC5lYWNoKCByZWNpcGVzLCBmdW5jdGlvbiggaW5kZXggKSB7XG5cbiAgICAgICAgICAgICAgICBjdXJJdGVtID0gTWF0aC5mbG9vciggKCBpbmRleCArIDEgKSAvIGN1ckNvbHVtbiApO1xuXG4gICAgICAgICAgICAgICAgdmFyIHJlY2lwZXNJdGVtID0gX2NyZWF0ZUl0ZW1GcmFtZSggdGhpcyApO1xuXG4gICAgICAgICAgICAgICAgY29sdW1uRnJhbWUuYXBwZW5kKCByZWNpcGVzSXRlbSApO1xuXG4gICAgICAgICAgICAgICAgaWYgKCBjdXJJdGVtID49IG51bWJlckluQ29sbCApe1xuICAgICAgICAgICAgICAgICAgICBfY2F0YWxvZ1dyYXAuYXBwZW5kKCBjb2x1bW5GcmFtZSApO1xuICAgICAgICAgICAgICAgICAgICBjb2x1bW5GcmFtZSA9ICQoICc8bGkvPicgKTtcbiAgICAgICAgICAgICAgICAgICAgY3VyQ29sdW1uICsrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICggaW5kZXggPT09IHJlY2lwZXNUb3RhbCAtIDEgKXtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIGV4dHJhTnVtYmVyID4gMCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9jYXRhbG9nV3JhcC5hcHBlbmQoIGNvbHVtbkZyYW1lICk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBfc2V0U3R5bGVzKCk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgaWYgKCB0b3RhbFBhZ2VzID4gMSAmJiBfaWZGaXJzdFBhZ2UgKXtcbiAgICAgICAgICAgICAgICBfc2V0UGFnaW5hdGlvbiggdG90YWxQYWdlcyApO1xuICAgICAgICAgICAgICAgIF9pZkZpcnN0UGFnZSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG4gICAgICAgIF9zY3JvbGxUb0FjdGl2ZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgdmFyIGFjdGl2ZUl0ZW0gPSBfY2F0ZWdvcmllc0ZyYW1lLmZpbmQoICcuaXMtYWN0aXZlJyApO1xuXG4gICAgICAgICAgICBpZiAoIGFjdGl2ZUl0ZW0ubGVuZ3RoID4gMCApe1xuXG4gICAgICAgICAgICAgICAgdmFyIHdpbmRvd1dpZHRoID0gX3dpbmRvdy5vdXRlcldpZHRoKCksXG4gICAgICAgICAgICAgICAgICAgIHdyYXBXaWR0aCA9IGFjdGl2ZUl0ZW0ub2Zmc2V0KCkubGVmdDtcblxuICAgICAgICAgICAgICAgIF9zY3JvbGxXcmFwLnNjcm9sbExlZnQgPSB3cmFwV2lkdGgvMiAtIHdpbmRvd1dpZHRoLzIgKyB3cmFwV2lkdGg7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuICAgICAgICBfc2V0U3R5bGVzID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2YXIgaW1hZ2UgPSBfY2F0YWxvZ1dyYXAuZmluZCggJ2ltZycgKSxcbiAgICAgICAgICAgICAgICB0b3RhbEltYWdlcyA9IGltYWdlLmxlbmd0aCxcbiAgICAgICAgICAgICAgICBjdXJJdGVtID0gMTtcblxuICAgICAgICAgICAgaW1hZ2Uub24gKCAnbG9hZCcsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIHZhciBjdXJQaWN0dXJlID0gJCggdGhpcyApLFxuICAgICAgICAgICAgICAgICAgICBjdXJQaWN0dXJlRnJhbWUgPSBjdXJQaWN0dXJlLnBhcmVudCggJy5mcmVlLXJlY2lwZXNfX3BpY3R1cmUnICksXG4gICAgICAgICAgICAgICAgICAgIGZyYW1lSGVpZ2h0ID0gY3VyUGljdHVyZS5vdXRlckhlaWdodCgpLFxuICAgICAgICAgICAgICAgICAgICBwaWN0dXJlSGVpZ2h0ID0gY3VyUGljdHVyZUZyYW1lLm91dGVySGVpZ2h0KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIHBpY3R1cmVIZWlnaHQgPiBmcmFtZUhlaWdodCApIHtcbiAgICAgICAgICAgICAgICAgICAgY3VyUGljdHVyZS5jc3MoIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICd3aWR0aCc6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdoZWlnaHQnOiAnMTAwJSdcbiAgICAgICAgICAgICAgICAgICAgfSApXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY3VyUGljdHVyZS5yZW1vdmVBdHRyKCAnc3R5bGUnICk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCBjdXJJdGVtID09PSB0b3RhbEltYWdlcyApIHtcbiAgICAgICAgICAgICAgICAgICAgX2NhdGFsb2dGcmFtZS5jc3MoICdoZWlnaHQnLCBfY2F0YWxvZ1dyYXAub3V0ZXJIZWlnaHQoKSApO1xuICAgICAgICAgICAgICAgICAgICBfY2F0YWxvZ0ZyYW1lLnJlbW92ZUNsYXNzKCAnbG9hZCBsb2FkLXBhZ2UnICk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY3VySXRlbSsrXG5cbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICB9LFxuICAgICAgICBfdXBkYXRlU3R5bGVzID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2YXIgaW1hZ2UgPSBfY2F0YWxvZ1dyYXAuZmluZCggJ2ltZycgKSxcbiAgICAgICAgICAgICAgICB0b3RhbEltYWdlcyA9IGltYWdlLmxlbmd0aDtcblxuICAgICAgICAgICAgaW1hZ2UuZWFjaCAoIGZ1bmN0aW9uICggaW5kZXggKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgY3VyUGljdHVyZSA9ICQoIHRoaXMgKTtcblxuICAgICAgICAgICAgICAgIGN1clBpY3R1cmUucmVtb3ZlQXR0ciggJ3N0eWxlJyApO1xuXG4gICAgICAgICAgICAgICAgdmFyIGN1clBpY3R1cmVGcmFtZSA9IGN1clBpY3R1cmUucGFyZW50KCAnLmZyZWUtcmVjaXBlc19fcGljdHVyZScgKSxcbiAgICAgICAgICAgICAgICAgICAgZnJhbWVIZWlnaHQgPSBjdXJQaWN0dXJlLm91dGVySGVpZ2h0KCksXG4gICAgICAgICAgICAgICAgICAgIHBpY3R1cmVIZWlnaHQgPSBjdXJQaWN0dXJlRnJhbWUub3V0ZXJIZWlnaHQoKTtcblxuICAgICAgICAgICAgICAgIGlmICggcGljdHVyZUhlaWdodCA+IGZyYW1lSGVpZ2h0ICkge1xuXG4gICAgICAgICAgICAgICAgICAgIGN1clBpY3R1cmUuY3NzKCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnd2lkdGgnOiAnYXV0bycsXG4gICAgICAgICAgICAgICAgICAgICAgICAnaGVpZ2h0JzogJzEwMCUnXG4gICAgICAgICAgICAgICAgICAgIH0gKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICggaW5kZXggKyAxID09PSB0b3RhbEltYWdlcyApIHtcbiAgICAgICAgICAgICAgICAgICAgX2NhdGFsb2dGcmFtZS5jc3MoICdoZWlnaHQnLCBfY2F0YWxvZ1dyYXAub3V0ZXJIZWlnaHQoKSApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9zZXRQYWdpbmF0aW9uID0gZnVuY3Rpb24gKCBwYWdlcyApIHtcblxuICAgICAgICAgICAgdmFyIHRvdGFsUGFnZXMgPSBwYWdlcztcblxuICAgICAgICAgICAgZm9yKCB2YXIgaSA9IDE7IGkgPD0gdG90YWxQYWdlczsgaSsrICl7XG4gICAgICAgICAgICAgICAgX3BhZ2luYXRpb24uYXBwZW5kKCAnPHNwYW4gZGF0YS1wYWdlPVwiJysgaSArJ1wiPjwvc3Bhbj4nIClcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHBhZ2VCdG4gPSBfcGFnaW5hdGlvbi5maW5kKCAnc3BhbicgKTtcblxuICAgICAgICAgICAgcGFnZUJ0bi5vbiggJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF9jaGFuZ2VQYWdlKCAkKCB0aGlzICkgKVxuICAgICAgICAgICAgfSApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgYWN0aXZlUGFnZSA9IF9yZWNpcGVzU3RvcmFnZVsgJ3BhZ2UnIF1cblxuICAgICAgICAgICAgaWYgKCFhY3RpdmVQYWdlKSB7XG4gICAgICAgICAgICAgICAgYWN0aXZlUGFnZSA9IDFcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcGFnZUJ0bi5maWx0ZXIoICdbZGF0YS1wYWdlPScrIGFjdGl2ZVBhZ2UgKyddJyApLmFkZENsYXNzKCAnaXMtYWN0aXZlJyApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9jb25zdHJ1Y3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIF9vbkV2ZW50KCk7XG4gICAgICAgICAgICBfaW5pdE1vYmlsZUNhdGFsb2dTY3JvbGwoKTtcbiAgICAgICAgICAgIF9hY3RpdmVBdEZpcnN0VGltZSgpO1xuICAgICAgICB9O1xuXG4gICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgX2NvbnN0cnVjdCgpO1xufTtcblxudmFyIE1vYmlsZU1lbnUgPSBmdW5jdGlvbiggb2JqICkge1xuXG4gICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgX21lbnVXcmFwID0gX29iai5maW5kKCAndWwnICksXG4gICAgICAgIF9tb2JpbGVCdG4gPSAkKCAnLmhhbWJ1cmdlcicgKSxcbiAgICAgICAgX2h0bWwgPSAkKCAnaHRtbCcgKSxcbiAgICAgICAgX2JvZHkgPSAkKCAnYm9keScgKSxcbiAgICAgICAgX3NpdGUgPSBfYm9keS5maW5kKCAnLnNpdGUnICksXG4gICAgICAgIF93aW5kb3cgPSAkKCB3aW5kb3cgKSxcbiAgICAgICAgX3Bvc2l0aW9uID0gMDtcblxuICAgIC8vcHJpdmF0ZSBtZXRob2RzXG4gICAgdmFyIF9vbkV2ZW50ID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIF9zaXRlLm9uKCAnY2xpY2snLCBmdW5jdGlvbiAoIGUgKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIF9vYmouaGFzQ2xhc3MoICdpcy1zaG93JyApICYmICQoIGUudGFyZ2V0ICkuY2xvc2VzdCggX21lbnVXcmFwICkubGVuZ3RoID09PSAwICl7XG4gICAgICAgICAgICAgICAgICAgIF9oaWRlTW9iaWxlTWVudSgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICBfbW9iaWxlQnRuLm9uKCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoICQoIHRoaXMgKS5oYXNDbGFzcyggJ2lzLWFjdGl2ZScgKSApe1xuICAgICAgICAgICAgICAgICAgICBfaGlkZU1vYmlsZU1lbnUoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBfc2hvd01vYmlsZU1lbnUoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2hpZGVNb2JpbGVNZW51ID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICBfbW9iaWxlQnRuLnJlbW92ZUNsYXNzKCAnaXMtYWN0aXZlJyApO1xuXG4gICAgICAgICAgICBfb2JqLnJlbW92ZUNsYXNzKCAnaXMtc2hvdycgKTtcblxuICAgICAgICAgICAgX2h0bWwucmVtb3ZlQXR0ciggJ3N0eWxlJyApO1xuICAgICAgICAgICAgX2JvZHkucmVtb3ZlQXR0ciggJ3N0eWxlJyApO1xuICAgICAgICAgICAgX3NpdGUucmVtb3ZlQXR0ciggJ3N0eWxlJyApO1xuXG4gICAgICAgICAgICBfd2luZG93LnNjcm9sbFRvcCggX3Bvc2l0aW9uICk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX3Nob3dNb2JpbGVNZW51ID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICBfbW9iaWxlQnRuLmFkZENsYXNzKCAnaXMtYWN0aXZlJyApO1xuXG4gICAgICAgICAgICBfb2JqLmFkZENsYXNzKCAnaXMtc2hvdycgKTtcblxuICAgICAgICAgICAgX3Bvc2l0aW9uID0gX3dpbmRvdy5zY3JvbGxUb3AoKTtcblxuICAgICAgICAgICAgX2h0bWwuY3NzKCAnb3ZlcmZsb3cteScsICdoaWRkZW4nICk7XG4gICAgICAgICAgICBfYm9keS5jc3MoICdvdmVyZmxvdy15JywgJ2hpZGRlbicgKTtcblxuICAgICAgICAgICAgX3NpdGUuY3NzKCB7XG4gICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ3JlbGF0aXZlJyxcbiAgICAgICAgICAgICAgICAndG9wJzogX3Bvc2l0aW9uICogLTFcbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICB9LFxuICAgICAgICBfY29uc3RydWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBfb25FdmVudCgpO1xuICAgICAgICB9O1xuXG4gICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgX2NvbnN0cnVjdCgpO1xufTtcblxudmFyIE9mZmVyVGltZXIgPSBmdW5jdGlvbiAoIG9iaiApIHtcblxuICAgIC8vcHJpdmF0ZSBwcm9wZXJ0aWVzXG4gICAgdmFyIF9vYmogPSBvYmosXG4gICAgICAgIF9taWxsaXNlY29uZHNJblNlY29uZCA9IDEwMDAsXG4gICAgICAgIF9taWxsaXNlY29uZHNJbk1pbnV0ZSA9IF9taWxsaXNlY29uZHNJblNlY29uZCAqIDYwLFxuICAgICAgICBfbWlsbGlzZWNvbmRzSW5Ib3VyID0gX21pbGxpc2Vjb25kc0luTWludXRlICogNjAsXG4gICAgICAgIF9taWxsaXNlY29uZHNJbkRheSA9IF9taWxsaXNlY29uZHNJbkhvdXIgKiAyNCxcbiAgICAgICAgX2RheXNGcmFtZSA9IF9vYmouZmluZCggJy5mbGFzaC1zYWxlc19fdGltZXItZGF5cycgKSxcbiAgICAgICAgX2hvdXJzRnJhbWUgPSBfb2JqLmZpbmQoICcuZmxhc2gtc2FsZXNfX3RpbWVyLWhvdXJzJyApLFxuICAgICAgICBfbWludXRlc0ZyYW1lID0gX29iai5maW5kKCAnLmZsYXNoLXNhbGVzX190aW1lci1taW51dGVzJyApLFxuICAgICAgICBfc2Vjb25kc0ZyYW1lID0gX29iai5maW5kKCAnLmZsYXNoLXNhbGVzX190aW1lci1zZWNvbmRzJyApLFxuICAgICAgICBfZGF5cyA9IDAsIF9ob3VycyA9IDAsIF9taW51dGVzID0gMCxcbiAgICAgICAgX3N0b3BwZWQgPSBmYWxzZSxcblxuICAgICAgICBfbGFzdE1vbWVudCA9IF9vYmouZGF0YSggJ3RpbWUtb3V0JyApO1xuXG4gICAgLy9wcml2YXRlIG1ldGhvZHNcbiAgICB2YXIgX29uRXZlbnQgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX3NldFRpbWVyID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2YXIgZGlmZmVyZW5jZSA9IG5ldyBEYXRlKCBfbGFzdE1vbWVudCApIC0gbmV3IERhdGUoKTtcblxuICAgICAgICAgICAgaWYoIGRpZmZlcmVuY2UgPiAwICl7XG5cbiAgICAgICAgICAgICAgICB2YXIgZGF5cywgaG91cnMsIG1pbnV0ZXMsIHNlY29uZHM7XG5cbiAgICAgICAgICAgICAgICBkYXlzID0gIE1hdGguZmxvb3IoIGRpZmZlcmVuY2UgLyBfbWlsbGlzZWNvbmRzSW5EYXkgKTtcbiAgICAgICAgICAgICAgICBob3VycyA9ICBNYXRoLmZsb29yKCAoIGRpZmZlcmVuY2UgLSAoIGRheXMgKiBfbWlsbGlzZWNvbmRzSW5EYXkgKSApIC8gX21pbGxpc2Vjb25kc0luSG91ciApO1xuICAgICAgICAgICAgICAgIG1pbnV0ZXMgPSBNYXRoLmZsb29yKCAoIGRpZmZlcmVuY2UgLSAoICggZGF5cyAqIF9taWxsaXNlY29uZHNJbkRheSApICsgKCBob3VycyAqIF9taWxsaXNlY29uZHNJbkhvdXIgKSApICkgLyBfbWlsbGlzZWNvbmRzSW5NaW51dGUgKTtcbiAgICAgICAgICAgICAgICBzZWNvbmRzID0gTWF0aC5mbG9vciggKCBkaWZmZXJlbmNlIC0gKCAoIGRheXMgKiBfbWlsbGlzZWNvbmRzSW5EYXkgKSArICggaG91cnMgKiBfbWlsbGlzZWNvbmRzSW5Ib3VyICkgKyAoIG1pbnV0ZXMgKiBfbWlsbGlzZWNvbmRzSW5NaW51dGUgKSApICkgLyBfbWlsbGlzZWNvbmRzSW5TZWNvbmQgKTtcblxuICAgICAgICAgICAgICAgIF9zZXRDbG9ja0ZhY2UoIHNlY29uZHMsIF9zZWNvbmRzRnJhbWUgKTtcblxuICAgICAgICAgICAgICAgIGlmICggX21pbnV0ZXMgIT09IG1pbnV0ZXMgKXtcbiAgICAgICAgICAgICAgICAgICAgX21pbnV0ZXMgPSBtaW51dGVzO1xuICAgICAgICAgICAgICAgICAgICBfc2V0Q2xvY2tGYWNlKCBtaW51dGVzLCBfbWludXRlc0ZyYW1lICk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBfaG91cnMgIT09IGhvdXJzICl7XG4gICAgICAgICAgICAgICAgICAgICAgICBfaG91cnMgPSBob3VycztcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zZXRDbG9ja0ZhY2UoIGhvdXJzLCBfaG91cnNGcmFtZSApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIF9kYXlzICE9PSBkYXlzICl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX2RheXMgPSBkYXlzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9zZXRDbG9ja0ZhY2UoIGRheXMsIF9kYXlzRnJhbWUgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIF9kYXlzID09IDAgKSB7XG4gICAgICAgICAgICAgICAgICAgIF9kYXlzRnJhbWUucGFyZW50cyggJy5mbGFzaC1zYWxlc19fY2xvY2stZmFjZScgKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiggZGlmZmVyZW5jZSA8PSAwICkge1xuICAgICAgICAgICAgICAgIF9zdG9wcGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBfb2JqLmFkZENsYXNzKCAnaXMtaGlkZScgKS5yZW1vdmUoKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG4gICAgICAgIF9sb29wID0gZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgX3NldFRpbWVyKCk7XG5cbiAgICAgICAgICAgIGlmKCAhX3N0b3BwZWQgKSB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCBfbG9vcCApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG4gICAgICAgIF9zZXRDbG9ja0ZhY2UgPSBmdW5jdGlvbiAoIHZhbCwgb2JqICkge1xuXG4gICAgICAgICAgICB2YXIgY3V0SW50VGltZSA9IHZhbCxcbiAgICAgICAgICAgICAgICBjdXRTdHJUaW1lID0gJycrIGN1dEludFRpbWUsXG4gICAgICAgICAgICAgICAgdGltZSA9IFtdO1xuXG4gICAgICAgICAgICBpZiAoIGN1dEludFRpbWUgPCAxMCApe1xuICAgICAgICAgICAgICAgIGN1dEludFRpbWUgPSAnMCcgKyB2YWw7XG4gICAgICAgICAgICAgICAgdGltZSA9IGN1dEludFRpbWUuc3BsaXQoJycpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aW1lID0gY3V0U3RyVGltZS5zcGxpdCgnJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG9iai5odG1sKCAnPHNwYW4+JysgdGltZVswXSArJzwvc3Bhbj48c3Bhbj4nKyB0aW1lWzFdICsnPC9zcGFuPicgKVxuXG4gICAgICAgIH0sXG4gICAgICAgIF9jb25zdHJ1Y3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIF9vbkV2ZW50KCk7XG4gICAgICAgICAgICBfbG9vcCgpO1xuICAgICAgICB9O1xuXG4gICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgX2NvbnN0cnVjdCgpO1xuXG59O1xuXG52YXIgT3Blbkl0ZW1zID0gZnVuY3Rpb24oIG9iaiApIHtcblxuICAgIC8vcHJpdmF0ZSBwcm9wZXJ0aWVzXG4gICAgdmFyIF9vYmogPSBvYmosXG4gICAgICAgIF9pdGVtID0gX29iai5maW5kKCAnLmZhcS13cmFwX19pdGVtJyApLFxuICAgICAgICBfdGFicyA9ICQoICcudGFicycgKSxcbiAgICAgICAgX3NpdGUgPSAkKCAnLnNpdGUnICk7XG5cbiAgICAvL3ByaXZhdGUgbWV0aG9kc1xuICAgIHZhciBfb25FdmVudCA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgX3NpdGUub24oICdjbGljaycsIGZ1bmN0aW9uICggZSApIHtcblxuICAgICAgICAgICAgICAgIGlmICggJCggZS50YXJnZXQgKS5jbG9zZXN0KCBfaXRlbSApLmxlbmd0aCA9PSAwICl7XG4gICAgICAgICAgICAgICAgICAgIF9pdGVtLnJlbW92ZUNsYXNzKCAnaXMtb3BlbicgKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgX2l0ZW0ub24oIHtcbiAgICAgICAgICAgICAgICAnY2xpY2snOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF9vcGVuSXRlbSggJCggdGhpcyApICk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAnd2Via2l0VHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCBvVHJhbnNpdGlvbkVuZCBtc1RyYW5zaXRpb25FbmQgdHJhbnNpdGlvbmVuZCc6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICggX3RhYnMubGVuZ3RoID4gMCApe1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RhYnNbMF0ub2JqLnNldEhlaWdodCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX29wZW5JdGVtID0gZnVuY3Rpb24gKCBvYmogKSB7XG5cbiAgICAgICAgICAgIHZhciBjdXJJdGVtID0gb2JqO1xuXG4gICAgICAgICAgICBpZiAoIGN1ckl0ZW0uaGFzQ2xhc3MoICdpcy1vcGVuJyApICl7XG4gICAgICAgICAgICAgICAgX2l0ZW0ucmVtb3ZlQ2xhc3MoICdpcy1vcGVuJyApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBfaXRlbS5yZW1vdmVDbGFzcyggJ2lzLW9wZW4nICk7XG4gICAgICAgICAgICAgICAgY3VySXRlbS5hZGRDbGFzcyggJ2lzLW9wZW4nICk7XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICB9LFxuICAgICAgICBfY29uc3RydWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBfb25FdmVudCgpO1xuICAgICAgICB9O1xuXG4gICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgX2NvbnN0cnVjdCgpO1xuXG59O1xuXG52YXIgUHJlbG9hZGVyID0gZnVuY3Rpb24gKG9iaikge1xuXG4gICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICB2YXIgX3ByZWxvYWRlciA9IG9iajtcblxuICAgIC8vcHJpdmF0ZSBtZXRob2RzXG4gICAgdmFyIF9zaG93U2l0ZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIF9wcmVsb2FkZXIuYWRkQ2xhc3MoICdwcmVsb2FkX2xvYWRlZCcgKTtcblxuICAgICAgICBfcHJlbG9hZGVyLm9uKCAnd2Via2l0VHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCBvVHJhbnNpdGlvbkVuZCBtc1RyYW5zaXRpb25FbmQgdHJhbnNpdGlvbmVuZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgX3ByZWxvYWRlci5yZW1vdmUoKTtcbiAgICAgICAgfSApO1xuXG4gICAgfTtcblxuICAgIC8vcHVibGljIHByb3BlcnRpZXNcblxuICAgIC8vcHVibGljIG1ldGhvZHNcblxuICAgIF9zaG93U2l0ZSgpO1xuXG59O1xuXG52YXIgUmV2aWV3c0l0ZW1zID0gZnVuY3Rpb24oIG9iaiApe1xuXG4gICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgX3N3aXBlclNsaXNlciA9IF9vYmouZmluZCggJy5zd2lwZXItY29udGFpbmVyJyApLFxuICAgICAgICBfaXRlbSA9IF9vYmouZmluZCggJ2xpJyApLFxuICAgICAgICBfc3dpcGVyUGFnaW5hdGlvbiA9ICQoICc8ZGl2IGNsYXNzPVwicmV2aWV3c19fc2xpZGVyLXBhZ2luYXRpb24gcGFnaW5hdGlvblwiPjwvZGl2PicgKSxcbiAgICAgICAgX2NvdW50ID0gNSxcbiAgICAgICAgX3N3aXBlcjtcblxuICAgIC8vcHJpdmF0ZSBtZXRob2RzXG4gICAgdmFyIF9vbkV2ZW50cyA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2NoZWNrUXVhbnRpdHkgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICBpZiggX2l0ZW0ubGVuZ3RoIDw9IF9jb3VudCApeyByZXR1cm4gZmFsc2UgfVxuXG4gICAgICAgICAgICB2YXIgbWF4Q291bnQgPSAwO1xuXG4gICAgICAgICAgICAkLmVhY2goIF9pdGVtLCBmdW5jdGlvbiggaW5kZXggKSB7XG5cbiAgICAgICAgICAgICAgICBtYXhDb3VudCA9IE1hdGguY2VpbCggKCBpbmRleCArIDEgKSAvIF9jb3VudCApO1xuXG4gICAgICAgICAgICAgICAgJCggdGhpcyApLmF0dHIoICdkYXRhLWNvdW50JywgbWF4Q291bnQgKTtcblxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICBmb3IoIHZhciBuID0gMDsgbiA8PSBtYXhDb3VudDsgbisrICl7XG4gICAgICAgICAgICAgICAgX2l0ZW0uZmlsdGVyKCAnW2RhdGEtY291bnQ9XCInKyBuICsnXCJdJyApLndyYXBBbGwoICc8dWwgY2xhc3M9XCJzd2lwZXItc2xpZGVcIj48L3VsPicgKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBfc3dpcGVyU2xpc2VyLmFwcGVuZCggX3N3aXBlclBhZ2luYXRpb24gKTtcbiAgICAgICAgICAgIF9zd2lwZXJQYWdpbmF0aW9uID0gX3N3aXBlclNsaXNlci5maW5kKCAnLnJldmlld3NfX3NsaWRlci1wYWdpbmF0aW9uJyApO1xuXG4gICAgICAgICAgICBfc3dpcGVyID0gbmV3IFN3aXBlciggX3N3aXBlclNsaXNlciwge1xuICAgICAgICAgICAgICAgIHNwZWVkOiAzMDAsXG4gICAgICAgICAgICAgICAgbG9vcDogZmFsc2UsXG4gICAgICAgICAgICAgICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICAgICAgICAgICAgICB0aHJlc2hvbGQ6IDEwLFxuICAgICAgICAgICAgICAgIHNwYWNlQmV0d2VlbjogODAsXG4gICAgICAgICAgICAgICAgYXV0b0hlaWdodDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIGVsOiBfc3dpcGVyUGFnaW5hdGlvbixcbiAgICAgICAgICAgICAgICAgICAgY2xpY2thYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9jb25zdHJ1Y3QgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgX29uRXZlbnRzKCk7XG4gICAgICAgICAgICBfY2hlY2tRdWFudGl0eSgpO1xuICAgICAgICB9O1xuXG4gICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgX2NvbnN0cnVjdCgpO1xuXG59O1xuXG52YXIgU2VhcmNoRm9ybSA9IGZ1bmN0aW9uKCBvYmogKSB7XG5cbiAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgIHZhciBfb2JqID0gb2JqLFxuICAgICAgICBfc2VhcmNoRm9ybSA9IF9vYmouZmluZCggJy5zZWFyY2hfX2Zvcm0nICksXG4gICAgICAgIF9zZWFyY2hIb29rID0gX3NlYXJjaEZvcm0uZGF0YSggJ2FjdGlvbicgKSxcbiAgICAgICAgX3NlYXJjaElucHV0ID0gX3NlYXJjaEZvcm0uZmluZCggJ2lucHV0JyApLFxuICAgICAgICBfc2VhcmNoUG9wdXAgPSBfb2JqLmZpbmQoICcuc2VhcmNoX19wb3B1cCcgKSxcbiAgICAgICAgX3NlYXJjaFBvcHVwU2Nyb2xsV3JhcCA9IF9zZWFyY2hQb3B1cC5maW5kKCAnLnNlYXJjaF9fcG9wdXAtc2Nyb2xsLXdyYXAnICksXG4gICAgICAgIF9yZXN1bHRXcmFwID0gX3NlYXJjaFBvcHVwLmZpbmQoICcuc2VhcmNoX19yZXN1bHQnICksXG4gICAgICAgIF91cmwgPSAkKCAnYm9keScgKS5kYXRhKCAnYWN0aW9uJyApLFxuICAgICAgICBfc2l0ZSA9ICQoICcuc2l0ZScgKSxcbiAgICAgICAgX3BzID0gbnVsbCxcbiAgICAgICAgX3RpbWVyID0gbnVsbCxcbiAgICAgICAgX3dpdGNoTGV0dGVyU3RhdCA9IDIsXG4gICAgICAgIF9yZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgICAvL3ByaXZhdGUgbWV0aG9kc1xuICAgIHZhciBfb25FdmVudCA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgX3NpdGUub24oICdjbGljaycsIGZ1bmN0aW9uICggZSApIHtcblxuICAgICAgICAgICAgICAgIGlmICggX3NlYXJjaFBvcHVwLmhhc0NsYXNzKCAnaXMtc2hvdycgKSAmJiAkKCBlLnRhcmdldCApLmNsb3Nlc3QoIF9vYmogKS5sZW5ndGggPT0gMCApe1xuICAgICAgICAgICAgICAgICAgICBfaGlkZVBvcHVwKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIF9zZWFyY2hJbnB1dC5vbiAoICdrZXl1cCcsIGZ1bmN0aW9uKCBlICkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHN5bWJvbE51bWJlciA9IF9zZWFyY2hJbnB1dC52YWwoKS5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICBzd2l0Y2ggKCBlLmtleUNvZGUgKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjc6XG4gICAgICAgICAgICAgICAgICAgICAgICBfaGlkZVBvcHVwKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMywgMjcsIDM3LCAzOCwgMzksIDQwOlxuICAgICAgICAgICAgICAgICAgICAgICAgKGUpLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCBzeW1ib2xOdW1iZXIgPiBfd2l0Y2hMZXR0ZXJTdGF0ICl7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcmVxdWVzdC5hYm9ydCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCggX3RpbWVyICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGltZXIgPSBzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9zZWFyY2hGb3JtLmhhc0NsYXNzKCAnaXMtc2hvdycgKSA/IF9hamF4UmVxdWVzdCgpIDogX3Nob3dQb3B1cCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDUwMCApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBzeW1ib2xOdW1iZXIgPD0gX3dpdGNoTGV0dGVyU3RhdCApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9yZXF1ZXN0LmFib3J0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KCBfdGltZXIgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfaGlkZVBvcHVwKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICB9LFxuICAgICAgICBfYWpheFJlcXVlc3QgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIF9zZWFyY2hQb3B1cC5hZGRDbGFzcyggJ2lzLWxvYWRpbmcnICk7XG5cbiAgICAgICAgICAgIF9yZXF1ZXN0LmFib3J0KCk7XG5cbiAgICAgICAgICAgIF9yZXF1ZXN0ID0gJC5hamF4KCB7XG4gICAgICAgICAgICAgICAgdXJsOiBfdXJsLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBfc2VhcmNoSG9vayxcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoX3ZhbHVlOiBfc2VhcmNoSW5wdXQudmFsKClcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgX2xvYWREYXRhKCBkYXRhICk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCBYTUxIdHRwUmVxdWVzdCApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBYTUxIdHRwUmVxdWVzdC5zdGF0dXNUZXh0ICE9IFwiYWJvcnRcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoICdlcnInICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2xvYWREYXRhID0gZnVuY3Rpb24gKCBkYXRhICkge1xuXG4gICAgICAgICAgICB2YXIgaW5mbztcblxuICAgICAgICAgICAgaWYgKCBfc2VhcmNoSG9vayA9PT0gJ2dldF9wb3N0c19hdXRvY29tcGxldGUnICl7XG4gICAgICAgICAgICAgICAgaW5mbyA9IGRhdGEuYmxvZztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIF9zZWFyY2hIb29rID09PSAnZ2V0X3JlY2lwZXNfYXV0b2NvbXBsZXRlJyApIHtcbiAgICAgICAgICAgICAgICBpbmZvID0gZGF0YS5yZWNpcGVzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBfcmVzdWx0V3JhcC5lbXB0eSgpO1xuXG4gICAgICAgICAgICBpZiAoICFpbmZvICl7XG4gICAgICAgICAgICAgICAgX3NlYXJjaFBvcHVwLmFkZENsYXNzKCAnaXMtZW1wdHknICk7XG4gICAgICAgICAgICAgICAgX3NlYXJjaFBvcHVwLnJlbW92ZUNsYXNzKCAnaXMtbG9hZGluZycgKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciByZWNpcGVzVG90YWwgPSBpbmZvLmxlbmd0aDtcblxuICAgICAgICAgICAgaWYgKCByZWNpcGVzVG90YWwgIT09IDAgKXtcblxuICAgICAgICAgICAgICAgIF9zZWFyY2hQb3B1cC5yZW1vdmVDbGFzcyggJ2lzLWVtcHR5JyApO1xuXG4gICAgICAgICAgICAgICAgJC5lYWNoKCBpbmZvLCBmdW5jdGlvbiggaW5kZXggKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlY2lwZXNJdGVtID0gX2NyZWF0ZUl0ZW1GcmFtZSggdGhpcyApO1xuXG4gICAgICAgICAgICAgICAgICAgIF9yZXN1bHRXcmFwLmFwcGVuZCggcmVjaXBlc0l0ZW0gKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIGluZGV4ID09PSByZWNpcGVzVG90YWwgLSAxICl7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9zZWFyY2hQb3B1cC5yZW1vdmVDbGFzcyggJ2lzLWxvYWRpbmcnICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbWFnZSA9IF9yZXN1bHRXcmFwLmZpbmQoICdpbWcnICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlLm9uKCAnbG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfc2V0V3JhcEhlaWdodCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBfc2VhcmNoUG9wdXAuYWRkQ2xhc3MoICdpcy1lbXB0eScgKTtcbiAgICAgICAgICAgICAgICBfc2VhcmNoUG9wdXAucmVtb3ZlQ2xhc3MoICdpcy1sb2FkaW5nJyApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG4gICAgICAgIF9jcmVhdGVJdGVtRnJhbWUgPSBmdW5jdGlvbiAoIGRhdGEgKSB7XG5cbiAgICAgICAgICAgIHZhciByZWNpcGVzSXRlbSA9IGRhdGEsXG4gICAgICAgICAgICAgICAgcmVjaXBlc0l0ZW1MaW5rID0gcmVjaXBlc0l0ZW0ubGluayxcbiAgICAgICAgICAgICAgICByZWNpcGVzSXRlbUltYWdlID0gcmVjaXBlc0l0ZW0uaW1hZ2UsXG4gICAgICAgICAgICAgICAgcmVjaXBlc0l0ZW1UaXRsZSA9IHJlY2lwZXNJdGVtLnRpdGxlLFxuICAgICAgICAgICAgICAgIHJlY2lwZXNJdGVtQ29va2luZ1RpbWUgPSByZWNpcGVzSXRlbS5jb29raW5nVGltZSxcbiAgICAgICAgICAgICAgICBmcmFtZUl0ZW0gPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAoIF9zZWFyY2hIb29rID09PSAnZ2V0X3Bvc3RzX2F1dG9jb21wbGV0ZScgKXtcblxuICAgICAgICAgICAgICAgIGZyYW1lSXRlbSA9ICc8YSBocmVmPVwiJysgcmVjaXBlc0l0ZW1MaW5rICsnXCIgY2xhc3M9XCJzZWFyY2hfX3Jlc3VsdC1pdGVtXCI+JyArXG4gICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwic2VhcmNoX19yZXN1bHQtcGljdHVyZVwiPicgK1xuICAgICAgICAgICAgICAgICAgICAnPGltZyBzcmM9XCInKyByZWNpcGVzSXRlbUltYWdlICsnXCIgYWx0PVwiJysgcmVjaXBlc0l0ZW1UaXRsZSArJ1wiIC8+JyArXG4gICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nICtcbiAgICAgICAgICAgICAgICAgICAgJyA8ZGl2IGNsYXNzPVwic2VhcmNoX19yZXN1bHQtdGV4dFwiPicgK1xuICAgICAgICAgICAgICAgICAgICAnPHA+JysgcmVjaXBlc0l0ZW1UaXRsZSArJzwvcD4nICtcbiAgICAgICAgICAgICAgICAgICAgJzwvZGl2PjwvYT4nO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKCBfc2VhcmNoSG9vayA9PT0gJ2dldF9yZWNpcGVzX2F1dG9jb21wbGV0ZScgKSB7XG5cbiAgICAgICAgICAgICAgICBmcmFtZUl0ZW0gPSAnPGEgaHJlZj1cIicrIHJlY2lwZXNJdGVtTGluayArJ1wiIGNsYXNzPVwic2VhcmNoX19yZXN1bHQtaXRlbVwiPicgK1xuICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cInNlYXJjaF9fcmVzdWx0LXBpY3R1cmVcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgJzxpbWcgc3JjPVwiJysgcmVjaXBlc0l0ZW1JbWFnZSArJ1wiIGFsdD1cIicrIHJlY2lwZXNJdGVtVGl0bGUgKydcIiAvPicgK1xuICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JyArXG4gICAgICAgICAgICAgICAgICAgICcgPGRpdiBjbGFzcz1cInNlYXJjaF9fcmVzdWx0LXRleHRcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgJzxwPicrIHJlY2lwZXNJdGVtVGl0bGUgKyc8L3A+JyArXG4gICAgICAgICAgICAgICAgICAgICc8cD4nKyByZWNpcGVzSXRlbUNvb2tpbmdUaW1lICsnPC9wPicgK1xuICAgICAgICAgICAgICAgICAgICAnPC9kaXY+PC9hPic7XG5cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJldHVybiBmcmFtZUl0ZW07XG5cbiAgICAgICAgfSxcbiAgICAgICAgX3Nob3dQb3B1cCA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgX3NlYXJjaFBvcHVwLmFkZENsYXNzKCAnaXMtc2hvdycgKTtcbiAgICAgICAgICAgIF9hamF4UmVxdWVzdCgpO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9zZXRXcmFwSGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICBfc2VhcmNoUG9wdXAuY3NzKCAnaGVpZ2h0JywgX3Jlc3VsdFdyYXAub3V0ZXJIZWlnaHQoKSArIDM3ICk7XG5cbiAgICAgICAgICAgIF9zZWFyY2hQb3B1cC5vbiggJ3dlYmtpdFRyYW5zaXRpb25FbmQgb3RyYW5zaXRpb25lbmQgb1RyYW5zaXRpb25FbmQgbXNUcmFuc2l0aW9uRW5kIHRyYW5zaXRpb25lbmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKCBfcHMgPT0gbnVsbCApe1xuICAgICAgICAgICAgICAgICAgICBfaW5pdFNjcm9sbCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIF9wcy51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgX3NlYXJjaFBvcHVwLm9mZiggJ3dlYmtpdFRyYW5zaXRpb25FbmQgb3RyYW5zaXRpb25lbmQgb1RyYW5zaXRpb25FbmQgbXNUcmFuc2l0aW9uRW5kIHRyYW5zaXRpb25lbmQnICk7XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2hpZGVQb3B1cCA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgaWYgKCAhX3NlYXJjaFBvcHVwLmhhc0NsYXNzKCAnaXMtc2hvdycgKSApe1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgX3NlYXJjaFBvcHVwLnJlbW92ZUNsYXNzKCAnaXMtc2hvdycgKTtcblxuICAgICAgICAgICAgX3NlYXJjaFBvcHVwLm9uKCAnd2Via2l0VHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCBvVHJhbnNpdGlvbkVuZCBtc1RyYW5zaXRpb25FbmQgdHJhbnNpdGlvbmVuZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIF9yZXN1bHRXcmFwLmVtcHR5KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIF9wcyAhPT0gbnVsbCApIHtcbiAgICAgICAgICAgICAgICAgICAgX3BzLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAgICAgX3BzID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBfc2VhcmNoUG9wdXAub2ZmKCAnd2Via2l0VHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCBvVHJhbnNpdGlvbkVuZCBtc1RyYW5zaXRpb25FbmQgdHJhbnNpdGlvbmVuZCcgKTtcblxuICAgICAgICAgICAgfSApO1xuXG5cbiAgICAgICAgfSxcbiAgICAgICAgX2luaXRTY3JvbGwgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIGlmICggX3NlYXJjaFBvcHVwU2Nyb2xsV3JhcC5vdXRlckhlaWdodCgpID4gX3NlYXJjaFBvcHVwLm91dGVySGVpZ2h0KCkgLSAzNyApe1xuXG4gICAgICAgICAgICAgICAgdmFyIHNlYXJjaFBvcHVwU2Nyb2xsV3JhcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoICcuc2VhcmNoX19wb3B1cC1zY3JvbGwtd3JhcCcgKTtcblxuICAgICAgICAgICAgICAgIF9wcyA9IG5ldyBQZXJmZWN0U2Nyb2xsYmFyKCBzZWFyY2hQb3B1cFNjcm9sbFdyYXAsIHtcbiAgICAgICAgICAgICAgICAgICAgc3VwcHJlc3NTY3JvbGxYOiB0cnVlXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2NvbnN0cnVjdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgX29uRXZlbnQoKTtcbiAgICAgICAgfTtcblxuICAgIC8vcHVibGljIHByb3BlcnRpZXNcblxuICAgIC8vcHVibGljIG1ldGhvZHNcblxuICAgIF9jb25zdHJ1Y3QoKTtcblxufTtcblxudmFyIFNldFNpemVJZnJhbWUgPSBmdW5jdGlvbiAob2JqKSB7XG5cbiAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgIHZhciBfb2JqID0gb2JqLFxuICAgICAgICBfd2luZG93ID0gJCggd2luZG93ICk7XG5cbiAgICAvL3ByaXZhdGUgbWV0aG9kc1xuICAgIHZhciBfb25FdmVudCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBfd2luZG93Lm9uKCAncmVzaXplJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF9zZXRTaXplKCk7XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX3NldFNpemUgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIF9vYmouY3NzKCAnaGVpZ2h0JywgX29iai5vdXRlcldpZHRoKCkgLyAxLjc4ICsgJ3B4JyApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9jb25zdHJ1Y3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIF9vbkV2ZW50KCk7XG4gICAgICAgICAgICBfc2V0U2l6ZSgpO1xuICAgICAgICB9O1xuXG4gICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgX2NvbnN0cnVjdCgpO1xuXG59O1xuXG52YXIgU2l0ZURlY28gPSBmdW5jdGlvbiAoIG9iaiApIHtcblxuICAgIHZhciBfb2JqID0gb2JqLFxuICAgICAgICBfb2JqUG9zaXRpb24gPSAkKCAnLicrIF9vYmouZGF0YSggJ3Bvc2l0aW9uJyApICkub2Zmc2V0KCkudG9wIC0gX29iai5vdXRlckhlaWdodCgpIC8gNCxcbiAgICAgICAgX3dpbmRvdyA9ICQoIHdpbmRvdyApO1xuXG4gICAgdmFyIF9vbkV2ZW50ID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICBfd2luZG93Lm9uKCAnc2Nyb2xsJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF9wYXJhbGF4KCk7XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX3BhcmFsYXggPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyIGN1clBvc2l0aW9uID0gX3dpbmRvdy5zY3JvbGxUb3AoKSArIF93aW5kb3cub3V0ZXJIZWlnaHQoKTtcblxuICAgICAgICAgICAgaWYgKCBjdXJQb3NpdGlvbiA+PSBfb2JqUG9zaXRpb24gKXtcbiAgICAgICAgICAgICAgICBfb2JqLmNzcyggJ3RyYW5zZm9ybScsICd0cmFuc2xhdGVZKCcrICggY3VyUG9zaXRpb24gLSBfb2JqUG9zaXRpb24gKSAqIC0uMyAgKydweCknICk7XG5cbiAgICAgICAgICAgICAgICB2YXIgb3BhY2l0eSA9IDEgLSAoICggX3dpbmRvdy5zY3JvbGxUb3AoKSAtIF9vYmoub2Zmc2V0KCkudG9wICkgLyAoIF9vYmoub3V0ZXJIZWlnaHQoKSAvIDEuMzMgKSApO1xuXG4gICAgICAgICAgICAgICAgaWYgKCAxID4gb3BhY2l0eSAmJiBvcGFjaXR5ID4gMCAgKSB7XG4gICAgICAgICAgICAgICAgICAgIF9vYmouY3NzKCAnb3BhY2l0eScsIG9wYWNpdHkgKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuICAgICAgICBfc2V0UG9zaXRpb24gPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgX29iai5jc3MoIHtcbiAgICAgICAgICAgICAgICAndG9wJzogX29ialBvc2l0aW9uXG4gICAgICAgICAgICB9LCA2MDApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9jb25zdHJ1Y3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIF9vbkV2ZW50KCk7XG4gICAgICAgICAgICBfc2V0UG9zaXRpb24oKTtcbiAgICAgICAgICAgIF9wYXJhbGF4KCk7XG4gICAgICAgIH07XG5cbiAgICBfY29uc3RydWN0KClcbn07XG5cbnZhciBTdGFycyA9IGZ1bmN0aW9uKCBvYmogKXtcblxuICAgIC8vcHJpdmF0ZSBwcm9wZXJ0aWVzXG4gICAgdmFyIF9vYmogPSBvYmosXG4gICAgICAgIF9pdGVtID0gX29iai5maW5kKCAnYScgKSxcbiAgICAgICAgX2FjdGl2ZSA9IG51bGw7XG5cbiAgICAvL3ByaXZhdGUgbWV0aG9kc1xuICAgIHZhciBfb25FdmVudHMgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICBfaXRlbS5vbigge1xuICAgICAgICAgICAgICAgICdtb3VzZW92ZXInOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgX2l0ZW0ucmVtb3ZlQ2xhc3MoICdhY3RpdmUgcHJldicgKTtcbiAgICAgICAgICAgICAgICAgICAgX2hvdmVyU3RhcnMoICQodGhpcykuaW5kZXgoKSwgJ2hvdmVyJyApO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgJ21vdXNlbGVhdmUnOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgX2l0ZW0ucmVtb3ZlQ2xhc3MoICdob3ZlcicgKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIF9hY3RpdmUgIT09IG51bGwgKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9ob3ZlclN0YXJzKCBfYWN0aXZlLCAncHJldicgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9pdGVtLmVxKCBfYWN0aXZlICkuYWRkQ2xhc3MoICdhY3RpdmUnICk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgJ2NsaWNrJzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBfaXRlbS5yZW1vdmVDbGFzcyggJ3ByZXYnICk7XG4gICAgICAgICAgICAgICAgICAgIF9hY3RpdmUgPSAkKHRoaXMpLmluZGV4KCk7XG4gICAgICAgICAgICAgICAgICAgIF9ob3ZlclN0YXJzKCAkKHRoaXMpLmluZGV4KCksICdwcmV2JyApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICB9LFxuICAgICAgICBfaG92ZXJTdGFycyA9IGZ1bmN0aW9uKCBpdGVtLCBuYW1lICl7XG5cbiAgICAgICAgICAgIGZvciggdmFyIG4gPSAwOyBuIDw9IGl0ZW07IG4rKyApe1xuICAgICAgICAgICAgICAgIF9pdGVtLmVxKCBuICkuYWRkQ2xhc3MoIG5hbWUgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuICAgICAgICBfY29uc3RydWN0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIF9vbkV2ZW50cygpO1xuICAgICAgICB9O1xuXG4gICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgX2NvbnN0cnVjdCgpO1xuXG59O1xuXG52YXIgU3dpcGVyUG9wdXAgPSBmdW5jdGlvbiAoIG9iaiwgaW5kZXggKSB7XG5cbiAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgX2h0bWwgPSAkKCAnaHRtbCcgKSxcbiAgICAgICAgX2JvZHkgPSAkKCAnYm9keScgKSxcbiAgICAgICAgX3NpdGUgPSAkKCAnLnNpdGUnICksXG4gICAgICAgIF9saW5rcyA9IF9vYmouZmluZCggJy5ib29rX19nYWxsZXJ5LWl0ZW0nICksXG4gICAgICAgIF93aW5kb3cgPSAkKCB3aW5kb3cgKSxcbiAgICAgICAgX3BvcHVwID0gbnVsbCxcbiAgICAgICAgX3BvcHVwSW5uZXIgPSBudWxsLFxuICAgICAgICBfcG9wdXBDbG9zZSA9IG51bGwsXG4gICAgICAgIF9zd2lwZXJXcmFwcGVyID0gbnVsbCxcbiAgICAgICAgX3N3aXBlckNvbnRhaW5lciA9IG51bGwsXG4gICAgICAgIF9zd2lwZXJCdG5OZXh0ID0gbnVsbCxcbiAgICAgICAgX3N3aXBlckJ0blByZXYgPSBudWxsLFxuICAgICAgICBfc3dpcGVyID0gbnVsbCxcbiAgICAgICAgX3Bvc2l0aW9uID0gMDtcblxuICAgIHZhciBfYWRkRXZlbnRzID0gZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgX3BvcHVwSW5uZXIucGFyZW50KCkub24oICdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIF9jbG9zZVBvcHVwKCk7XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIF9wb3B1cElubmVyLm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZXZlbnQgKSB7XG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIF9wb3B1cENsb3NlLm9uKCAnY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBfY2xvc2VQb3B1cCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICB9LFxuICAgICAgICBfYWRkaW5nVmFyaWFibGVzID0gZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgX3BvcHVwID0gJCggJzxkaXYgY2xhc3M9XCJzd2lwZXItcG9wdXBcIj5cXFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInN3aXBlci1jb250YWluZXJcIj5cXFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9XCIjXCIgY2xhc3M9XCJzd2lwZXItcG9wdXBfX2Nsb3NlXCI+PC9hPlxcXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInN3aXBlci13cmFwcGVyXCI+PC9kaXY+XFxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic3dpcGVyLWJ1dHRvbi1uZXh0XCI+PC9kaXY+XFxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic3dpcGVyLWJ1dHRvbi1wcmV2XCI+PC9kaXY+XFxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PicgKTtcbiAgICAgICAgICAgIF9zd2lwZXJXcmFwcGVyID0gX3BvcHVwLmZpbmQoICcuc3dpcGVyLXdyYXBwZXInICk7XG4gICAgICAgICAgICBfc3dpcGVyQ29udGFpbmVyID0gX3BvcHVwLmZpbmQoICcuc3dpcGVyLWNvbnRhaW5lcicgKTtcbiAgICAgICAgICAgIF9zd2lwZXJCdG5OZXh0ID0gX3BvcHVwLmZpbmQoICcuc3dpcGVyLWJ1dHRvbi1uZXh0JyApO1xuICAgICAgICAgICAgX3N3aXBlckJ0blByZXYgPSBfcG9wdXAuZmluZCggJy5zd2lwZXItYnV0dG9uLXByZXYnICk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2J1aWxkUG9wdXAgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICBfYWRkaW5nVmFyaWFibGVzKCk7XG4gICAgICAgICAgICBfY29udGVudEZpbGxpbmcoKTtcbiAgICAgICAgICAgIF9pbml0U3dpcGVyKCk7XG4gICAgICAgICAgICBfc3dpcGVyLnNsaWRlVG8oIGluZGV4LCAwICk7XG4gICAgICAgICAgICBfcG9wdXAuYWRkQ2xhc3MoICdhY3RpdmUnICk7XG4gICAgICAgICAgICBfc2V0U3R5bGVzKCk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2Nsb3NlUG9wdXAgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICBfcG9wdXAucmVtb3ZlQ2xhc3MoICdhY3RpdmUnICk7XG5cbiAgICAgICAgICAgIF9wb3B1cC5vbiggJ3dlYmtpdFRyYW5zaXRpb25FbmQgb3RyYW5zaXRpb25lbmQgb1RyYW5zaXRpb25FbmQgbXNUcmFuc2l0aW9uRW5kIHRyYW5zaXRpb25lbmQnLCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIF9odG1sLnJlbW92ZUF0dHIoICdzdHlsZScgKTtcbiAgICAgICAgICAgICAgICBfYm9keS5yZW1vdmVBdHRyKCAnc3R5bGUnICk7XG4gICAgICAgICAgICAgICAgX3NpdGUucmVtb3ZlQXR0ciggJ3N0eWxlJyApO1xuXG4gICAgICAgICAgICAgICAgX3dpbmRvdy5zY3JvbGxUb3AoIF9wb3NpdGlvbiApO1xuICAgICAgICAgICAgICAgIF9wb3NpdGlvbiA9IDA7XG5cbiAgICAgICAgICAgICAgICBfcG9wdXAucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICB9LFxuICAgICAgICBfY29udGVudEZpbGxpbmcgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAkLmVhY2goIF9saW5rcywgZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgICAgIHZhciBpbm5lckNvbnRlbnQgPSBudWxsLFxuICAgICAgICAgICAgICAgICAgICBpbm5lckltZyA9IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGFTUkMgPSBudWxsLFxuICAgICAgICAgICAgICAgICAgICBpbm5lclRpdGxlID0gbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgcHJlbG9hZGVyID0gbnVsbDtcblxuICAgICAgICAgICAgICAgIHByZWxvYWRlciA9ICcnO1xuICAgICAgICAgICAgICAgIGlubmVyQ29udGVudCA9ICQoIHRoaXMgKS5jaGlsZHJlbiggJ2ltZycgKTtcbiAgICAgICAgICAgICAgICBpbm5lckltZyA9ICc8aW1nIHNyYz1cIicgKyBpbm5lckNvbnRlbnQuYXR0ciggJ3NyYycgKSArICdcIj4nO1xuICAgICAgICAgICAgICAgIGRhdGFTUkMgPSAnJztcblxuICAgICAgICAgICAgICAgIHZhciBuZXdJdGVtID0gJCggJzxkaXYgY2xhc3M9XCJzd2lwZXItc2xpZGVcIj5cXFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzd2lwZXItcG9wdXBfX2lubmVyXCIgJyArIGRhdGFTUkMgKyAnPlxcXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgKyBwcmVsb2FkZXIgKyAnXFxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyArIGlubmVySW1nICsgJ1xcXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XFxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PicgKTtcblxuICAgICAgICAgICAgICAgIF9zd2lwZXJXcmFwcGVyLmFwcGVuZCggbmV3SXRlbSApO1xuXG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIF9ib2R5LmFwcGVuZCggX3BvcHVwICk7XG5cbiAgICAgICAgICAgIF9wb3B1cElubmVyID0gX3BvcHVwLmZpbmQoICcuc3dpcGVyLXBvcHVwX19pbm5lcicgKTtcbiAgICAgICAgICAgIF9wb3B1cENsb3NlID0gX3BvcHVwLmZpbmQoICcuc3dpcGVyLXBvcHVwX19jbG9zZScgKTtcblxuICAgICAgICB9LFxuICAgICAgICBfZ2V0U2Nyb2xsV2lkdGggPSBmdW5jdGlvbiAoKXtcblxuICAgICAgICAgICAgdmFyIHNjcm9sbERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnKSxcbiAgICAgICAgICAgICAgICBzY3JvbGxCYXJXaWR0aDtcblxuICAgICAgICAgICAgc2Nyb2xsRGl2LmNsYXNzTmFtZSA9ICdwb3B1cF9fc2Nyb2xsYmFyLW1lYXN1cmUnO1xuXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKCBzY3JvbGxEaXYgKTtcblxuICAgICAgICAgICAgc2Nyb2xsQmFyV2lkdGggPSBzY3JvbGxEaXYub2Zmc2V0V2lkdGggLSBzY3JvbGxEaXYuY2xpZW50V2lkdGg7XG5cbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoc2Nyb2xsRGl2KTtcblxuICAgICAgICAgICAgcmV0dXJuIHNjcm9sbEJhcldpZHRoO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9pbml0U3dpcGVyID0gZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgX3N3aXBlciA9IG5ldyBTd2lwZXIoIF9zd2lwZXJDb250YWluZXIsIHtcbiAgICAgICAgICAgICAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgICAgICAgICAgICAgIHRocmVzaG9sZDogMTAsXG4gICAgICAgICAgICAgICAgbmF2aWdhdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICBuZXh0RWw6IF9zd2lwZXJCdG5OZXh0LFxuICAgICAgICAgICAgICAgICAgICBwcmV2RWw6IF9zd2lwZXJCdG5QcmV2XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2NvbnN0cnVjdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF9idWlsZFBvcHVwKCk7XG4gICAgICAgICAgICBfYWRkRXZlbnRzKCk7XG4gICAgICAgIH0sXG4gICAgICAgIF9zZXRTdHlsZXMgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICBpZiAoIF93aW5kb3cuc2Nyb2xsVG9wKCkgIT09IDAgKXtcbiAgICAgICAgICAgICAgICBfcG9zaXRpb24gPSBfd2luZG93LnNjcm9sbFRvcCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBfaHRtbC5jc3MoIHtcbiAgICAgICAgICAgICAgICBvdmVyZmxvd1k6ICdoaWRkZW4nLFxuICAgICAgICAgICAgICAgIHBhZGRpbmdSaWdodDogX2dldFNjcm9sbFdpZHRoKClcbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgX2JvZHkuY3NzKCAnb3ZlcmZsb3cteScsICdoaWRkZW4nICk7XG5cbiAgICAgICAgICAgIF9zaXRlLmNzcygge1xuICAgICAgICAgICAgICAgICdwb3NpdGlvbic6ICdyZWxhdGl2ZScsXG4gICAgICAgICAgICAgICAgJ3RvcCc6IF9wb3NpdGlvbiAqIC0xXG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgfTtcblxuICAgIF9jb25zdHJ1Y3QoKTtcblxufTtcblxudmFyIFRhYnMgPSBmdW5jdGlvbiggb2JqICkge1xuXG4gICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgX3NlbGYgPSB0aGlzLFxuICAgICAgICBfdGFiQnRuV3JhcCA9IF9vYmouZmluZCggJy50YWJzX19pdGVtcy13cmFwJyApLFxuICAgICAgICBfdGFiU2Nyb2xsQ29udGVudCA9IF90YWJCdG5XcmFwLmZpbmQoICcudGFic19faXRlbXMtc2Nyb2xsJyApLFxuICAgICAgICBfdGFiQnRuID0gX3RhYkJ0bldyYXAuZmluZCggJy50YWJzX19pdGVtJyApLFxuICAgICAgICBfdGFiV3JhcCA9IF9vYmouZmluZCggJy50YWJzX193cmFwJyApLFxuICAgICAgICBfdGFiQ29udGVudCA9IF90YWJXcmFwLmZpbmQoICcudGFic19fY29udGVudCcgKSxcbiAgICAgICAgX3Njcm9sbFdyYXAsXG4gICAgICAgIF9wcyA9IG51bGwsXG4gICAgICAgIF9zd2lwZXIgPSBudWxsLFxuICAgICAgICBfd2luZG93ID0gJCggd2luZG93ICk7XG5cbiAgICAvL3ByaXZhdGUgbWV0aG9kc1xuICAgIHZhciBfb25FdmVudCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBfdGFiQnRuLm9uKCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGN1ckJ0biA9ICQoIHRoaXMgKSxcbiAgICAgICAgICAgICAgICAgICAgY3VyQnRuSW5kZXggPSBjdXJCdG4uaW5kZXgoKTtcblxuICAgICAgICAgICAgICAgIF9zaG93VGFiV3JhcCggY3VyQnRuSW5kZXggKTtcblxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICBfd2luZG93Lm9uKCAncmVzaXplJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF9zZXRDb250ZW50SGVpZ2h0KCk7XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX3Nob3dUYWJXcmFwID0gZnVuY3Rpb24gKCBudW0gKSB7XG5cbiAgICAgICAgICAgIHZhciBjdXJUYWJJbmRleCA9IG51bSxcbiAgICAgICAgICAgICAgICBjdXJUYWJCdG4gPSBfdGFiQnRuLmVxKCBjdXJUYWJJbmRleCApLFxuICAgICAgICAgICAgICAgIGFjdGl2ZUNvbnRlbnQgPSBfdGFiQ29udGVudC5lcSggY3VyVGFiSW5kZXggKTtcblxuICAgICAgICAgICAgX3RhYkJ0bi5yZW1vdmVDbGFzcyggJ2lzLWFjdGl2ZScgKTtcbiAgICAgICAgICAgIGN1clRhYkJ0bi5hZGRDbGFzcyggJ2lzLWFjdGl2ZScgKTtcblxuICAgICAgICAgICAgX3RhYkNvbnRlbnQucmVtb3ZlQ2xhc3MoICdpcy1zaG93JyApO1xuICAgICAgICAgICAgYWN0aXZlQ29udGVudC5hZGRDbGFzcyggJ2lzLXNob3cnICk7XG5cbiAgICAgICAgICAgIF9zZXRDb250ZW50SGVpZ2h0KCk7XG4gICAgICAgICAgICBfaW5pdFNsaWRlcigpO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9pbml0U2xpZGVyID0gZnVuY3Rpb24gKCAgKSB7XG5cbiAgICAgICAgICAgIHZhciBhY3RpdmVDb250ZW50ID0gX3RhYkNvbnRlbnQuZmlsdGVyKCAnLmlzLXNob3cnICksXG4gICAgICAgICAgICAgICAgc3dpcGVyU2xpZGVyID0gYWN0aXZlQ29udGVudC5maW5kKCAnLnN3aXBlci1jb250YWluZXInICksXG4gICAgICAgICAgICAgICAgc3dpcGVyU2xpZGUgPSBhY3RpdmVDb250ZW50LmZpbmQoICcuc3dpcGVyLXNsaWRlJyApO1xuXG4gICAgICAgICAgICBpZiAoIHN3aXBlclNsaWRlciA9PT0gdW5kZWZpbmVkIHx8IHN3aXBlclNsaWRlci5sZW5ndGggPT09IDAgKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIF9zd2lwZXIgIT09IG51bGwgKXtcbiAgICAgICAgICAgICAgICAgICAgX3N3aXBlci5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgICAgIF9zd2lwZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIF9zd2lwZXIgPT0gbnVsbCAmJiBzd2lwZXJTbGlkZS5sZW5ndGggPiAxICkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHN3aXBlclBhZ2luYXRpb24gPSBfb2JqLmZpbmQoICcucGFnaW5hdGlvbicgKTtcblxuICAgICAgICAgICAgICAgIF9zd2lwZXIgPSBuZXcgU3dpcGVyKCBzd2lwZXJTbGlkZXIsIHtcbiAgICAgICAgICAgICAgICAgICAgZWZmZWN0OiAnc2xpZGVyJyxcbiAgICAgICAgICAgICAgICAgICAgc3BlZWQ6IDUwMCxcbiAgICAgICAgICAgICAgICAgICAgc3BhY2VCZXR3ZWVuOiAzMCxcbiAgICAgICAgICAgICAgICAgICAgbG9vcDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICAgICAgICAgICAgICAgICAgdGhyZXNob2xkOiAxMCxcbiAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWw6IHN3aXBlclBhZ2luYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGlja2FibGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9zZXRDb250ZW50SGVpZ2h0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW1hZ2UgPSBzd2lwZXJTbGlkZS5lcSgwKS5maW5kKCAnaW1nJyApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2Uub24gKCAnbG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3NldENvbnRlbnRIZWlnaHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmICggc3dpcGVyU2xpZGUubGVuZ3RoID09IDEgKXtcblxuICAgICAgICAgICAgICAgIHZhciBpbWFnZSA9IHN3aXBlclNsaWRlLmZpbmQoICdpbWcnICk7XG5cbiAgICAgICAgICAgICAgICBpbWFnZS5vbiAoICdsb2FkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBfc2V0Q29udGVudEhlaWdodCgpO1xuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG4gICAgICAgIF9zZXRDb250ZW50SGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2YXIgYWN0aXZlQ29udGVudCA9IF90YWJDb250ZW50LmZpbHRlciggJy5pcy1zaG93JyApO1xuXG4gICAgICAgICAgICBfdGFiV3JhcC5jc3MoICdoZWlnaHQnLCBhY3RpdmVDb250ZW50Lm91dGVySGVpZ2h0KCkgKTtcblxuICAgICAgICB9LFxuICAgICAgICBfaW5pdFNjcm9sbCA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgaWYgKCBfcHMgIT09IG51bGwgKSB7XG4gICAgICAgICAgICAgICAgX3BzLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICBfcHMgPSBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBfc2Nyb2xsV3JhcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoICcudGFic19faXRlbXMtc2Nyb2xsJyApO1xuXG4gICAgICAgICAgICBpZiAoIF90YWJTY3JvbGxDb250ZW50Lm91dGVyV2lkdGgoKSA+IF93aW5kb3cub3V0ZXJXaWR0aCgpICkge1xuXG4gICAgICAgICAgICAgICAgX3BzID0gbmV3IFBlcmZlY3RTY3JvbGxiYXIoIF9zY3JvbGxXcmFwLCB7XG4gICAgICAgICAgICAgICAgICAgIHN1cHByZXNzU2Nyb2xsWTogdHJ1ZVxuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgICAgIF9zY3JvbGxUb0FjdGl2ZSgpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcbiAgICAgICAgX3Njcm9sbFRvQWN0aXZlID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2YXIgYWN0aXZlSXRlbSA9IF90YWJCdG5XcmFwLmZpbmQoICcuaXMtYWN0aXZlJyApO1xuXG4gICAgICAgICAgICBpZiAoIGFjdGl2ZUl0ZW0ubGVuZ3RoID4gMCApe1xuXG4gICAgICAgICAgICAgICAgdmFyIHdpbmRvd1dpZHRoID0gX3dpbmRvdy5vdXRlcldpZHRoKCksXG4gICAgICAgICAgICAgICAgICAgIHdyYXBXaWR0aCA9IGFjdGl2ZUl0ZW0ub2Zmc2V0KCkubGVmdDtcblxuICAgICAgICAgICAgICAgIF9zY3JvbGxXcmFwLnNjcm9sbExlZnQgPSB3cmFwV2lkdGgvMiAtIHdpbmRvd1dpZHRoLzIgKyB3cmFwV2lkdGg7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuICAgICAgICBfY2hlY2tBY3RpdmUgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIHZhciBhY3RpdmVUYWJCdG4gPSBfdGFiQnRuLmZpbHRlciggJy5pcy1hY3RpdmUnICk7XG5cbiAgICAgICAgICAgIGlmICggYWN0aXZlVGFiQnRuLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICAgICAgYWN0aXZlVGFiQnRuLnRyaWdnZXIoICdjbGljaycgKVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBfdGFiQnRuLmVxKCAwICkudHJpZ2dlciggJ2NsaWNrJyApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG4gICAgICAgIF9jb25zdHJ1Y3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIF9vbkV2ZW50KCk7XG4gICAgICAgICAgICBfaW5pdFNjcm9sbCgpO1xuICAgICAgICAgICAgX2NoZWNrQWN0aXZlKCk7XG5cbiAgICAgICAgICAgIF9vYmpbMF0ub2JqID0gX3NlbGZcblxuICAgICAgICB9O1xuXG4gICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgLy9wdWJsaWMgbWV0aG9kc1xuICAgIF9zZWxmLnNldEhlaWdodCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3NldENvbnRlbnRIZWlnaHQoKTtcbiAgICB9O1xuXG4gICAgX2NvbnN0cnVjdCgpO1xufTtcblxudmFyIFRydWVVc2VyID0gZnVuY3Rpb24oIG9iaiApe1xuXG4gICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICB2YXIgX29iaiA9IG9iajtcblxuICAgIC8vcHJpdmF0ZSBtZXRob2RzXG4gICAgdmFyIF9jb25zdHJ1Y3QgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oICd0cnVlVXNlcicsIHRydWUgKVxuICAgICAgICB9O1xuXG4gICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgX2NvbnN0cnVjdCgpO1xuXG59OyIsIiQoIGZ1bmN0aW9uICgpIHtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgJC5lYWNoKCAkKCAnLmNvbnRhY3QtdXNfX2Zvcm0nICksIGZ1bmN0aW9uKCkge1xuICAgICAgICBuZXcgQ29udGFjdEZvcm0gKCAkKCB0aGlzICkgKTtcbiAgICB9ICk7XG5cbiAgICAkLmVhY2goICQoICcuY29udGFjdC11c19fZmlsZS1maWVsZCcgKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgIG5ldyBMYWJlbEZpbGVJdGVtICggJCggdGhpcyApICk7XG4gICAgfSApO1xuXG59ICk7XG5cbnZhciBDb250YWN0Rm9ybSA9IGZ1bmN0aW9uKCBvYmogKXtcblxuICAgIC8vcHJpdmF0ZSBwcm9wZXJ0aWVzXG4gICAgdmFyIF9vYmogPSBvYmosXG4gICAgICAgIF9idG4gPSBfb2JqLmZpbmQoICdidXR0b24nICksXG4gICAgICAgIF91cmwgPSAkKCAnYm9keScgKS5kYXRhKCAnYWN0aW9uJyApLFxuICAgICAgICBfcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpLFxuICAgICAgICBfdmFsaWRhdGlvbiA9IG5ldyBGb3JtVmFsaWRhdG9yKCBfb2JqICksXG4gICAgICAgIF9wb3B1cCA9ICQoICcucG9wdXAnICksXG4gICAgICAgIF90aW1lcjtcblxuICAgIC8vcHJpdmF0ZSBtZXRob2RzXG4gICAgdmFyIF9jb25zdHJ1Y3QgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgX29uRXZlbnQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgX29uRXZlbnQgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICBfb2JqLm9uKCAnc3VibWl0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBfb2JqLmFkZENsYXNzKCAnaXMtbG9hZGluZycgKTtcblxuICAgICAgICAgICAgICAgIGlmICggX3ZhbGlkYXRpb24udmFsaWQgPT09IHRydWUgKSB7XG4gICAgICAgICAgICAgICAgICAgIF9hamF4U2VuZCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIF9vYmoucmVtb3ZlQ2xhc3MoICdpcy1sb2FkaW5nJyApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9hamF4U2VuZCA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSggX29ialswXSApO1xuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCAnYWN0aW9uJywgJ3NlbmRfY29udGFjdF9mb3JtJyApO1xuXG4gICAgICAgICAgICBfcmVxdWVzdCA9ICQuYWpheCgge1xuICAgICAgICAgICAgICAgIHVybDogX3VybCxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2h0bWwnLFxuICAgICAgICAgICAgICAgIHRpbWVvdXQ6IDIwMDAwLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgIGRhdGE6IGZvcm1EYXRhLFxuICAgICAgICAgICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIF9zaG93U3VjY2Vzc01lc3NhZ2UoKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoWE1MSHR0cFJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFhNTEh0dHBSZXF1ZXN0LnN0YXR1c1RleHQgIT0gJ2Fib3J0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoWE1MSHR0cFJlcXVlc3Quc3RhdHVzVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ICk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX3Nob3dTdWNjZXNzTWVzc2FnZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgX29iai5yZW1vdmVDbGFzcyggJ2lzLWxvYWRpbmcnICk7XG5cbiAgICAgICAgICAgIF9vYmpbMF0ucmVzZXQoKTtcbiAgICAgICAgICAgICQoICcuY29udGFjdC11c19fZmlsZS1maWVsZCcgKVswXS5vYmouZW1wdHlGaWVsZCgpO1xuXG4gICAgICAgICAgICBfcG9wdXBbMF0ub2JqLm9wZW5Qb3B1cCggX2J0biApO1xuXG4gICAgICAgICAgICBfdGltZXIgPSBzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3BvcHVwWzBdLm9iai5jbG9zZVBvcHVwKCk7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KCBfdGltZXIgKTtcbiAgICAgICAgICAgICAgICBfdGltZXIgPSBudWxsO1xuICAgICAgICAgICAgfSwgNTAwMCApO1xuXG4gICAgICAgIH07XG5cbiAgICAvL3B1YmxpYyBwcm9wZXJ0aWVzXG5cbiAgICAvL3B1YmxpYyBtZXRob2RzXG5cbiAgICBfY29uc3RydWN0KCk7XG5cbn07XG5cbnZhciBMYWJlbEZpbGVJdGVtID0gZnVuY3Rpb24oIG9iaiApIHtcblxuICAgIC8vcHJpdmF0ZSBwcm9wZXJ0aWVzXG4gICAgdmFyIF9vYmogPSBvYmosXG4gICAgICAgIF9zZWxmID0gdGhpcyxcbiAgICAgICAgX2xhYmVsVGV4dCA9IF9vYmouZmluZCggJ3NwYW4nICksXG4gICAgICAgIF9wbGFjZWhvbGRlciA9IF9sYWJlbFRleHQudGV4dCgpLFxuICAgICAgICBfaW5wdXQgPSBfb2JqLmZpbmQoICdpbnB1dFt0eXBlPWZpbGVdJyApO1xuXG4gICAgLy9wcml2YXRlIG1ldGhvZHNcbiAgICB2YXIgX29uRXZlbnQgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgX2lucHV0Lm9uKCAnY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIG5hbWUgPSBfaW5wdXQudmFsKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIG5hbWUgIT09ICcnICkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBmb3JtYXQgPSBuYW1lLnNwbGl0KCcuJykucG9wKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBmb3JtYXQgPT0gJ2pwZycgfHwgZm9ybWF0ID09ICdwbmcnIHx8IGZvcm1hdCA9PSAncGRmJyApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgX2xhYmVsVGV4dC50ZXh0KCBuYW1lLnNwbGl0KCdcXFxcJykucG9wKCkgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9vYmouYWRkQ2xhc3MoICdpcy1mdWxsJyApO1xuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfZW1wdHlGaWVsZCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBfZW1wdHlGaWVsZCgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9lbXB0eUZpZWxkID0gZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgX2xhYmVsVGV4dC50ZXh0KCBfcGxhY2Vob2xkZXIgKTtcbiAgICAgICAgICAgIF9vYmoucmVtb3ZlQ2xhc3MoICdpcy1mdWxsJyApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBfb25FdmVudCgpO1xuICAgICAgICAgICAgX29ialsgMCBdLm9iaiA9IF9zZWxmO1xuICAgICAgICB9O1xuXG4gICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgLy9wdWJsaWMgbWV0aG9kc1xuICAgIF9zZWxmLmVtcHR5RmllbGQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF9lbXB0eUZpZWxkKCk7XG4gICAgfTtcblxuICAgIF9pbml0KCk7XG59O1xuXG52YXIgWmVuZGVza0NyZWF0ZVRpY2tldEZvcm0gPSBmdW5jdGlvbiggb2JqICl7XG5cbiAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgIHZhciBfb2JqID0gb2JqLFxuICAgICAgICBfbmFtZUZpZWxkZXIgPSBfb2JqLmZpbmQoICdpbnB1dFtuYW1lPXN1YnNjcmliZS1uYW1lXScgKSxcbiAgICAgICAgX2VtYWlsRmllbGRlciA9IF9vYmouZmluZCggJ2lucHV0W25hbWU9c3Vic2NyaWJlLWVtYWlsXScgKSxcbiAgICAgICAgX3N1YmplY3RGaWVsZGVyID0gX29iai5maW5kKCAnaW5wdXRbbmFtZT1zdWJzY3JpYmUtc3ViamVjdF0nICksXG4gICAgICAgIF9tZXNzYWdlRmllbGRlciA9IF9vYmouZmluZCggJ3RleHRhcmVhW25hbWU9c3Vic2NyaWJlLW1lc3NhZ2VdJyApLFxuICAgICAgICBfZmlsZUZpZWxkZXIgPSBfb2JqLmZpbmQoICdpbnB1dFt0eXBlPWZpbGVdJyApLFxuICAgICAgICBfdXJsID0gJCggJ2JvZHknICkuZGF0YSggJ2FjdGlvbicgKSxcbiAgICAgICAgX2J0biA9IF9vYmouZmluZCggJ2J1dHRvbicgKSxcbiAgICAgICAgX3ZhbGlkYXRpb24gPSBuZXcgRm9ybVZhbGlkYXRvciggX29iaiApLFxuICAgICAgICBfcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpLFxuICAgICAgICBfcG9wdXAgPSAkKCAnLnBvcHVwJyApLFxuICAgICAgICBfdXBsb2FkRmlsZXMgPSBudWxsLFxuICAgICAgICBfZmlsZVRva2VuID0gbnVsbCxcbiAgICAgICAgX3RpbWVyID0gbnVsbDtcblxuICAgIC8vcHJpdmF0ZSBtZXRob2RzXG4gICAgdmFyIF9jb25zdHJ1Y3QgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgX29uRXZlbnQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgX29uRXZlbnQgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICBfZmlsZUZpZWxkZXIub24oICdjaGFuZ2UnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIF91cGxvYWRGaWxlcyA9IGUudGFyZ2V0LmZpbGVzO1xuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICBfb2JqLm9uKCAnc3VibWl0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBfb2JqLmFkZENsYXNzKCAnaXMtbG9hZGluZycgKTtcblxuICAgICAgICAgICAgICAgIGlmICggX3ZhbGlkYXRpb24udmFsaWQgPT09IHRydWUgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBfdXBsb2FkRmlsZXMgIT09IG51bGwgJiYgX3VwbG9hZEZpbGVzLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfYWpheFNlbmRGaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfYWpheENyZWF0ZVRpY2tldCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBfb2JqLnJlbW92ZUNsYXNzKCAnaXMtbG9hZGluZycgKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICB9LFxuICAgICAgICBfYWpheFNlbmRGaWxlID0gZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG5cbiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCggJ2FjdGlvbicsICdzZW5kX2ZpbGUnICk7XG5cbiAgICAgICAgICAgICQuZWFjaCggX3VwbG9hZEZpbGVzLCBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHtcbiAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoIGtleSwgdmFsdWUgKTtcbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgX29iai5hZGRDbGFzcyggJ2lzLWxvYWRpbmcnICk7XG5cbiAgICAgICAgICAgIF9yZXF1ZXN0LmFib3J0KCk7XG4gICAgICAgICAgICBfcmVxdWVzdCA9ICQuYWpheCgge1xuICAgICAgICAgICAgICAgIHVybDogX3VybCxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIHRpbWVvdXQ6IDIwMDAwLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgIGRhdGE6IGZvcm1EYXRhLFxuICAgICAgICAgICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgX2ZpbGVUb2tlbiA9IGRhdGFbJ3VwbG9hZCddWyd0b2tlbiddO1xuICAgICAgICAgICAgICAgICAgICBfYWpheENyZWF0ZVRpY2tldCgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChYTUxIdHRwUmVxdWVzdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoWE1MSHR0cFJlcXVlc3Quc3RhdHVzVGV4dCAhPSAnYWJvcnQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhbGVydChYTUxIdHRwUmVxdWVzdC5zdGF0dXNUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICB9LFxuICAgICAgICBfYWpheENyZWF0ZVRpY2tldCA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgIF9yZXF1ZXN0LmFib3J0KCk7XG4gICAgICAgICAgICBfb2JqLmFkZENsYXNzKCAnaXMtbG9hZGluZycgKTtcblxuICAgICAgICAgICAgX3JlcXVlc3QgPSAkLmFqYXgoIHtcbiAgICAgICAgICAgICAgICB1cmw6IF91cmwsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICB0aW1lb3V0OiAyMDAwMCxcbiAgICAgICAgICAgICAgICB0eXBlOiBcIlBPU1RcIixcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3N1YnNjcmliZV9mb3JtJyxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogX25hbWVGaWVsZGVyLnZhbCgpLFxuICAgICAgICAgICAgICAgICAgICBlbWFpbDogX2VtYWlsRmllbGRlci52YWwoKSxcbiAgICAgICAgICAgICAgICAgICAgc3ViamVjdDogX3N1YmplY3RGaWVsZGVyLnZhbCgpLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBfbWVzc2FnZUZpZWxkZXIudmFsKCksXG4gICAgICAgICAgICAgICAgICAgIGZpbGU6IF9maWxlVG9rZW5cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgX3Nob3dTdWNjZXNzTWVzc2FnZSgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChYTUxIdHRwUmVxdWVzdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoWE1MSHR0cFJlcXVlc3Quc3RhdHVzVGV4dCAhPSAnYWJvcnQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhbGVydChYTUxIdHRwUmVxdWVzdC5zdGF0dXNUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICB9LFxuICAgICAgICBfc2hvd1N1Y2Nlc3NNZXNzYWdlID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICBfb2JqLnJlbW92ZUNsYXNzKCAnaXMtbG9hZGluZycgKTtcbiAgICAgICAgICAgIF9vYmpbMF0ucmVzZXQoKTtcblxuICAgICAgICAgICAgX3BvcHVwWzBdLm9iai5vcGVuUG9wdXAoIF9idG4gKTtcblxuICAgICAgICAgICAgX3RpbWVyID0gc2V0VGltZW91dCggZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF9wb3B1cFswXS5vYmouY2xvc2VQb3B1cCgpO1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCggX3RpbWVyICk7XG4gICAgICAgICAgICAgICAgX3RpbWVyID0gbnVsbDtcbiAgICAgICAgICAgIH0sIDUwMDAgKTtcblxuICAgICAgICB9O1xuXG4gICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgX2NvbnN0cnVjdCgpO1xuXG59O1xuIiwidmFyIEZvcm1WYWxpZGF0b3IgPSBmdW5jdGlvbiAob2JqKSB7XG5cbiAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgIHZhciBfb2JqID0gb2JqLFxuICAgICAgICBfc2VsZiA9IHRoaXMsXG4gICAgICAgIF9maWVsZHMgPSBfb2JqLmZpbmQoICdbcmVxdWlyZWRdOm5vdChzZWxlY3QpJyApLFxuICAgICAgICBfdGV4dElucHV0cyA9IF9vYmouZmluZCggJ2lucHV0W3R5cGUhPWNoZWNrYm94XSwgdGV4dGFyZWEnICksXG4gICAgICAgIF9jaGVja2JveElucHV0cyA9IF9vYmouZmluZCggJ2lucHV0W3R5cGU9Y2hlY2tib3hdW3JlcXVpcmVkXScgKSxcbiAgICAgICAgX2NpdHlTZWxlY3QgPSBfb2JqLmZpbmQoICcuY2l0eS1zZWxlY3RvcltkYXRhLXJlcXVpcmVkXScgKSxcbiAgICAgICAgX3NlbGVjdCA9IF9vYmouZmluZCggJ3NlbGVjdFtyZXF1aXJlZF0nICksXG4gICAgICAgIF9tdWx0aXBsZVNlbGVjdCA9IF9vYmouZmluZCggJy5jdXN0b20tbXVsdGlwbGUtc2VsZWN0W2RhdGEtcmVxdWlyZWRdJyApLFxuICAgICAgICBfbXVsdGlwbGVTZWxlY3RPcHRpb25zID0gX211bHRpcGxlU2VsZWN0LmZpbmQoICdpbnB1dFt0eXBlPWNoZWNrYm94XScgKSxcbiAgICAgICAgX3NpdGUgPSAkKCAnI3NpdGUnICk7XG5cbiAgICAvL3ByaXZhdGUgbWV0aG9kc1xuICAgIHZhciBfY29uc3RydWN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX29uRXZlbnRzKCk7XG4gICAgICAgICAgICBfb2JqWyAwIF0ub2JqID0gX3NlbGY7XG4gICAgICAgIH0sXG4gICAgICAgIF9hZGROb3RUb3VjaGVkQ2xhc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfZmllbGRzLmVhY2goIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGN1ckl0ZW0gPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgaWYoIGN1ckl0ZW0udmFsKCkgPT09ICcnICl7XG4gICAgICAgICAgICAgICAgICAgIGN1ckl0ZW0uYWRkQ2xhc3MoICdpcy1ub3QtdG91Y2hlZCcgKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIGN1ckl0ZW0uaGFzQ2xhc3MoICdpcy12YWxpZCcgKSApe1xuICAgICAgICAgICAgICAgICAgICBjdXJJdGVtLnJlbW92ZUNsYXNzKCAnaXMtbm90LXRvdWNoZWQnICk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9ICk7XG4gICAgICAgICAgICBfY2hlY2tib3hJbnB1dHMuZWFjaCggZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgY3VySXRlbSA9ICQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoICFjdXJJdGVtLmlzKCAnOmNoZWNrZWQnICkgKXtcbiAgICAgICAgICAgICAgICAgICAgY3VySXRlbS5hZGRDbGFzcyggJ2lzLW5vdC10b3VjaGVkJyApXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9ICk7XG4gICAgICAgICAgICBfY2l0eVNlbGVjdC5lYWNoKCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIHZhciBjdXJJdGVtID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgY2l0eVNlbGVjdE9wdGlvbnMgPSBjdXJJdGVtLmZpbmQoICdvcHRpb24nICk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIGNpdHlTZWxlY3RPcHRpb25zLmZpbHRlciggJzpzZWxlY3RlZCcgKS52YWwoKSA9PSAwICl7XG4gICAgICAgICAgICAgICAgICAgICQoIHRoaXMgKS5hZGRDbGFzcyggJ2lzLW5vdC10b3VjaGVkJyApXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9ICk7XG4gICAgICAgICAgICBfc2VsZWN0LmVhY2goIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGN1ckl0ZW0gPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RPcHRpb25zID0gY3VySXRlbS5maW5kKCAnb3B0aW9uJyApO1xuXG4gICAgICAgICAgICAgICAgaWYgKCBzZWxlY3RPcHRpb25zLmZpbHRlciggJzpzZWxlY3RlZCcgKS52YWwoKSA9PSAwICl7XG4gICAgICAgICAgICAgICAgICAgIGN1ckl0ZW0ucGFyZW50cyggJy5zZWxlY3QnICkuYWRkQ2xhc3MoICdpcy1ub3QtdG91Y2hlZCcgKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSApO1xuICAgICAgICAgICAgX211bHRpcGxlU2VsZWN0LmVhY2goIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGN1ckl0ZW0gPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICBtdWx0aXBsZVNlbGVjdE9wdGlvbnMgPSBjdXJJdGVtLmZpbmQoICdpbnB1dFt0eXBlPWNoZWNrYm94XScgKTtcblxuICAgICAgICAgICAgICAgIGlmICggbXVsdGlwbGVTZWxlY3RPcHRpb25zLmZpbHRlciggJzpjaGVja2VkJyApLmxlbmd0aCA8PSAwICl7XG4gICAgICAgICAgICAgICAgICAgIGN1ckl0ZW0ucGFyZW50cyggJy5tdWx0aXBsZS1zZWxlY3QnICkuYWRkQ2xhc3MoICdpcy1ub3QtdG91Y2hlZCcgKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSApO1xuICAgICAgICB9LFxuICAgICAgICBfb25FdmVudHMgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIF9zaXRlLm9uKCAnY2xpY2snLCBmdW5jdGlvbiAoIGUgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCAkKCBlLnRhcmdldCApLmNsb3Nlc3QoIF9vYmogKS5sZW5ndGggPT09IDAgKXtcbiAgICAgICAgICAgICAgICAgICAgX2NoZWNrRmlsbGluZ0Zvcm0oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIF9maWVsZHMub24oIHtcbiAgICAgICAgICAgICAgICAnZm9jdXMnOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJCggdGhpcyApLnJlbW92ZUNsYXNzKCAnaXMtbm90LXRvdWNoZWQnICk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAnZm9jdXNvdXQnOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgX3ZhbGlkYXRlRmllbGQoICQoIHRoaXMgKSApO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgJ2tleXVwJzogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXJJdGVtID0gJCh0aGlzKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIGN1ckl0ZW0uaGFzQ2xhc3MoICdpcy1ub3QtdmFsaWQnICkgKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIF92YWxpZGF0ZUZpZWxkKCBjdXJJdGVtICk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgX3RleHRJbnB1dHMub24oICdmb2N1c291dCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIF9jaGVja0ZpbGxpbmdGb3JtKCk7XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIF9tdWx0aXBsZVNlbGVjdC5wYXJlbnRzKCAnLm11bHRpcGxlLXNlbGVjdCcgKS5vbigge1xuICAgICAgICAgICAgICAgICdjbGljayc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAkKCB0aGlzICkucGFyZW50cyggJy5tdWx0aXBsZS1zZWxlY3QnICkucmVtb3ZlQ2xhc3MoICdpcy1ub3QtdG91Y2hlZCcgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIF9tdWx0aXBsZVNlbGVjdE9wdGlvbnMub24oICdjaGFuZ2UnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoIF9tdWx0aXBsZVNlbGVjdE9wdGlvbnMuZmlsdGVyKCAnOmNoZWNrZWQnICkubGVuZ3RoID4gMCApe1xuICAgICAgICAgICAgICAgICAgICBfbXVsdGlwbGVTZWxlY3QucGFyZW50cyggJy5tdWx0aXBsZS1zZWxlY3QnICkucmVtb3ZlQ2xhc3MoICdpcy1ub3QtdG91Y2hlZCcgKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgX2NpdHlTZWxlY3Qub24oICdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICQoIHRoaXMgKS5yZW1vdmVDbGFzcyggJ2lzLW5vdC10b3VjaGVkJyApO1xuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICBfY2l0eVNlbGVjdC5maW5kKCAnc2VsZWN0JyApLm9uKCAnY2hhbmdlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCAkKCB0aGlzICkuZmluZCggJ29wdGlvbicgKS5maWx0ZXIoICc6c2VsZWN0ZWQnICkudmFsKCkgPT0gMCApe1xuICAgICAgICAgICAgICAgICAgICAkKCB0aGlzICkucGFyZW50cyggJy5jaXR5LXNlbGVjdG9yJyApLnJlbW92ZUNsYXNzKCAnaXMtbm90LXRvdWNoZWQnIClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIF9zZWxlY3QucGFyZW50cyggJy5zZWxlY3QnICkub24oIHtcbiAgICAgICAgICAgICAgICAnY2xpY2snOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJCggdGhpcyApLnJlbW92ZUNsYXNzKCAnaXMtbm90LXRvdWNoZWQnICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICBfc2VsZWN0Lm9uKCAnY2hhbmdlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCAkKCB0aGlzICkuZmluZCggJ29wdGlvbicgKS5maWx0ZXIoICc6c2VsZWN0ZWQnICkudmFsKCkgPT0gMCApe1xuICAgICAgICAgICAgICAgICAgICBfc2VsZWN0LnBhcmVudHMoICcuc2VsZWN0JyApLnJlbW92ZUNsYXNzKCAnaXMtbm90LXRvdWNoZWQnIClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIF9vYmoub24oICdzdWJtaXQnLCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIF9hZGROb3RUb3VjaGVkQ2xhc3MoKTtcblxuICAgICAgICAgICAgICAgIGlmKCBfZmllbGRzLmhhc0NsYXNzKCAnaXMtbm90LXRvdWNoZWQnICkgfHxcbiAgICAgICAgICAgICAgICAgICAgX2ZpZWxkcy5oYXNDbGFzcyggJ2lzLW5vdC12YWxpZCcgKSB8fFxuICAgICAgICAgICAgICAgICAgICBfY2l0eVNlbGVjdC5oYXNDbGFzcyggJ2lzLW5vdC12YWxpZCcgKSB8fFxuICAgICAgICAgICAgICAgICAgICBfc2VsZWN0LnBhcmVudHMoICcuc2VsZWN0JyApLmhhc0NsYXNzKCAnaXMtbm90LXZhbGlkJyApIHx8XG4gICAgICAgICAgICAgICAgICAgIF9tdWx0aXBsZVNlbGVjdC5wYXJlbnRzKCAnLm11bHRpcGxlLXNlbGVjdCcgKS5oYXNDbGFzcyggJ2lzLW5vdC10b3VjaGVkJyApICkge1xuXG4gICAgICAgICAgICAgICAgICAgIF9zZWxmLnZhbGlkID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIF9jb250cm9sQ2hlY2soKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICBfY2hlY2tib3hJbnB1dHMub24oICdjbGljaycsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGN1ckl0ZW0gPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCBjdXJJdGVtLmlzKCAnOmNoZWNrZWQnICkgKXtcbiAgICAgICAgICAgICAgICAgICAgY3VySXRlbS5hZGRDbGFzcyggJ2lzLXZhbGlkJyApLnJlbW92ZUNsYXNzKCAnaXMtbm90LXRvdWNoZWQnICk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY3VySXRlbS5yZW1vdmVDbGFzcyggJ2lzLXZhbGlkJyApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9jaGVja0ZpbGxpbmdGb3JtID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2YXIgbGV0dGVyQ291bnRlciA9IDA7XG5cbiAgICAgICAgICAgIF90ZXh0SW5wdXRzLmVhY2goIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIHZhciBjdXJJdGVtID0gJCh0aGlzKTtcblxuICAgICAgICAgICAgICAgIGlmICggY3VySXRlbS52YWwoKS5sZW5ndGggPiAwICl7XG4gICAgICAgICAgICAgICAgICAgIGxldHRlckNvdW50ZXIgPSBsZXR0ZXJDb3VudGVyICsgMVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICBpZiAoIGxldHRlckNvdW50ZXIgPT09IDAgKSB7XG4gICAgICAgICAgICAgICAgX3RleHRJbnB1dHMucmVtb3ZlQ2xhc3MoICdpcy1ub3QtdG91Y2hlZCcgKTtcbiAgICAgICAgICAgICAgICBfdGV4dElucHV0cy5yZW1vdmVDbGFzcyggJ2lzLW5vdC12YWxpZCcgKTtcbiAgICAgICAgICAgICAgICBfY2l0eVNlbGVjdC5yZW1vdmVDbGFzcyggJ2lzLW5vdC10b3VjaGVkJyApO1xuICAgICAgICAgICAgICAgIF9zZWxlY3QucGFyZW50cyggJy5zZWxlY3QnICkucmVtb3ZlQ2xhc3MoICdpcy1ub3QtdG91Y2hlZCcgKTtcbiAgICAgICAgICAgICAgICBfbXVsdGlwbGVTZWxlY3QucGFyZW50cyggJy5tdWx0aXBsZS1zZWxlY3QnICkucmVtb3ZlQ2xhc3MoICdpcy1ub3QtdG91Y2hlZCcgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuICAgICAgICBfbWFrZU5vdFZhbGlkID0gZnVuY3Rpb24gKCBmaWVsZCApIHtcbiAgICAgICAgICAgIGZpZWxkLmFkZENsYXNzKCAnaXMtbm90LXZhbGlkJyApO1xuICAgICAgICAgICAgZmllbGQucmVtb3ZlQ2xhc3MoICdpcy12YWxpZCcgKTtcbiAgICAgICAgICAgIF9zZWxmLnZhbGlkID0gZmFsc2U7XG4gICAgICAgIH0sXG4gICAgICAgIF9tYWtlVmFsaWQgPSBmdW5jdGlvbiAoIGZpZWxkICkge1xuICAgICAgICAgICAgZmllbGQucmVtb3ZlQ2xhc3MoICdpcy1ub3QtdmFsaWQnICk7XG4gICAgICAgICAgICBmaWVsZC5hZGRDbGFzcyggJ2lzLXZhbGlkJyApO1xuICAgICAgICAgICAgX2NvbnRyb2xDaGVjaygpO1xuICAgICAgICB9LFxuICAgICAgICBfdmFsaWRhdGVFbWFpbCA9IGZ1bmN0aW9uICggZW1haWwgKSB7XG4gICAgICAgICAgICB2YXIgcmUgPSAvXigoW148PigpXFxbXFxdXFxcXC4sOzpcXHNAXCJdKyhcXC5bXjw+KClcXFtcXF1cXFxcLiw7Olxcc0BcIl0rKSopfChcIi4rXCIpKUAoKFxcW1swLTldezEsM31cXC5bMC05XXsxLDN9XFwuWzAtOV17MSwzfVxcLlswLTldezEsM31dKXwoKFthLXpBLVpcXC0wLTldK1xcLikrW2EtekEtWl17Mix9KSkkLztcbiAgICAgICAgICAgIHJldHVybiByZS50ZXN0KGVtYWlsKTtcbiAgICAgICAgfSxcbiAgICAgICAgX3ZhbGlkYXRlRmllbGQgPSBmdW5jdGlvbiAoIGZpZWxkICkge1xuXG4gICAgICAgICAgICB2YXIgdHlwZSA9IGZpZWxkLmF0dHIoICd0eXBlJyApLFxuICAgICAgICAgICAgICAgIHRhZ05hbWUgPSBmaWVsZFswXS50YWdOYW1lO1xuXG4gICAgICAgICAgICBpZiggdHlwZSA9PT0gJ2VtYWlsJyB8fCB0eXBlID09PSAndGV4dCcgKXtcbiAgICAgICAgICAgICAgICBpZiggZmllbGQudmFsKCkgPT09ICcnICl7XG4gICAgICAgICAgICAgICAgICAgIF9tYWtlTm90VmFsaWQoIGZpZWxkICk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKCB0eXBlID09PSAnZW1haWwnICl7XG4gICAgICAgICAgICAgICAgaWYoICFfdmFsaWRhdGVFbWFpbCggZmllbGQudmFsKCkgKSApe1xuICAgICAgICAgICAgICAgICAgICBfbWFrZU5vdFZhbGlkKCBmaWVsZCApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiggdGFnTmFtZS50b0xvY2FsZUxvd2VyQ2FzZSgpID09PSAndGV4dGFyZWEnICl7XG4gICAgICAgICAgICAgICAgaWYoIGZpZWxkLnZhbCgpID09PSAnJyApe1xuICAgICAgICAgICAgICAgICAgICBfbWFrZU5vdFZhbGlkKCBmaWVsZCApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBfbWFrZVZhbGlkKCBmaWVsZCApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9jb250cm9sQ2hlY2sgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIGlmKCBfZmllbGRzLmZpbHRlciggJy5pcy12YWxpZCcgKS5sZW5ndGggPT09IF9maWVsZHMubGVuZ3RoICYmXG4gICAgICAgICAgICAgICAgIV9tdWx0aXBsZVNlbGVjdC5wYXJlbnRzKCAnLm11bHRpcGxlLXNlbGVjdCcgKS5oYXNDbGFzcyggJ2lzLW5vdC10b3VjaGVkJyApICYmXG4gICAgICAgICAgICAgICAgIV9zZWxlY3QucGFyZW50cyggJy5zZWxlY3QnICkuaGFzQ2xhc3MoICdpcy1ub3QtdG91Y2hlZCcgKSAmJlxuICAgICAgICAgICAgICAgICFfY2l0eVNlbGVjdC5oYXNDbGFzcyggJ2lzLW5vdC10b3VjaGVkJyApICkge1xuICAgICAgICAgICAgICAgIF9maWVsZHMucmVtb3ZlQ2xhc3MoICdpcy12YWxpZCcgKTtcbiAgICAgICAgICAgICAgICBfc2VsZi52YWxpZCA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgIC8vcHVibGljIHByb3BlcnRpZXNcbiAgICBfc2VsZi52YWxpZCA9IGZhbHNlO1xuXG4gICAgX2NvbnN0cnVjdCgpO1xufTsiLCIkKCBmdW5jdGlvbigpIHtcblxuICAgICQoICcucG9wdXAnICkuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICBuZXcgUG9wdXAoJCh0aGlzKSk7XG4gICAgfSApO1xuXG59ICk7XG5cbnZhciBQb3B1cCA9IGZ1bmN0aW9uKCBvYmogKXtcbiAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgIHZhciBfc2VsZiA9IHRoaXMsXG4gICAgICAgIF9idG5TaG93ID0gICQoICcucG9wdXBfX29wZW4nICksXG4gICAgICAgIF9vYmogPSBvYmosXG4gICAgICAgIF9wb3B1cFdyYXAgPSBfb2JqLmZpbmQoICcucG9wdXBfX3dyYXAnICksXG4gICAgICAgIF9wb3B1cENvbnRlbnRzID0gX29iai5maW5kKCAnLnBvcHVwX19jb250ZW50JyApLFxuICAgICAgICBfYnRuQ2xvc2UgPSBfb2JqLmZpbmQoICcucG9wdXBfX2Nsb3NlLCAucG9wdXBfX2NhbmNlbCcgKSxcbiAgICAgICAgX3NpdGVIZWFkZXIgPSAkKCAnLnNpdGVfX2hlYWRlci1sYXlvdXQnICksXG4gICAgICAgIF92aWRlb0ZpbGUsIF9wcm9kdWN0Q29udGVudCxcbiAgICAgICAgX3Njcm9sbENvbnRlaW5lciA9ICQoICdodG1sJyApLFxuICAgICAgICBfYm9keSA9ICQoICdib2R5JyApLFxuICAgICAgICBfc2l0ZSA9IF9ib2R5LmZpbmQoICcuc2l0ZScgKSxcbiAgICAgICAgX3VybCA9IF9ib2R5LmRhdGEoICdhY3Rpb24nICksXG4gICAgICAgIF9wb3NpdGlvbiA9IDAsIF9pc09wZW4gPSBmYWxzZSxcbiAgICAgICAgX3dpbmRvdyA9ICQoIHdpbmRvdyApLFxuICAgICAgICBfcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG4gICAgLy9wcml2YXRlIG1ldGhvZHNcbiAgICB2YXIgX2dldFNjcm9sbFdpZHRoID0gZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICB2YXIgc2Nyb2xsRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicpLFxuICAgICAgICAgICAgICAgIHNjcm9sbEJhcldpZHRoO1xuXG4gICAgICAgICAgICBzY3JvbGxEaXYuY2xhc3NOYW1lID0gJ3BvcHVwX19zY3JvbGxiYXItbWVhc3VyZSc7XG5cbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoIHNjcm9sbERpdiApO1xuXG4gICAgICAgICAgICBzY3JvbGxCYXJXaWR0aCA9IHNjcm9sbERpdi5vZmZzZXRXaWR0aCAtIHNjcm9sbERpdi5jbGllbnRXaWR0aDtcblxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChzY3JvbGxEaXYpO1xuXG4gICAgICAgICAgICByZXR1cm4gc2Nyb2xsQmFyV2lkdGg7XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2hpZGVQb3B1cCA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgIF9pc09wZW4gPSBmYWxzZTtcblxuICAgICAgICAgICAgX29iai5hZGRDbGFzcyggJ2lzLWhpZGUnICkucmVtb3ZlQ2xhc3MoICdpcy1vcGVuZWQnICk7XG5cbiAgICAgICAgICAgIF9vYmoub24oICd3ZWJraXRUcmFuc2l0aW9uRW5kIG90cmFuc2l0aW9uZW5kIG9UcmFuc2l0aW9uRW5kIG1zVHJhbnNpdGlvbkVuZCB0cmFuc2l0aW9uZW5kJywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBfc2Nyb2xsQ29udGVpbmVyLnJlbW92ZUF0dHIoICdzdHlsZScgKTtcbiAgICAgICAgICAgICAgICBfYm9keS5yZW1vdmVBdHRyKCAnc3R5bGUnICk7XG4gICAgICAgICAgICAgICAgX3NpdGUucmVtb3ZlQXR0ciggJ3N0eWxlJyApO1xuICAgICAgICAgICAgICAgIF9zaXRlSGVhZGVyLnJlbW92ZUF0dHIoICdzdHlsZScgKTtcbiAgICAgICAgICAgICAgICBfb2JqLnJlbW92ZUF0dHIoICdzdHlsZScgKTtcblxuICAgICAgICAgICAgICAgIF93aW5kb3cuc2Nyb2xsVG9wKCBfcG9zaXRpb24gKTtcbiAgICAgICAgICAgICAgICBfcG9zaXRpb24gPSAwO1xuXG4gICAgICAgICAgICAgICAgX29iai5yZW1vdmVDbGFzcyggJ2lzLWhpZGUnICk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIF92aWRlb0ZpbGUgIT0gbnVsbCApIHtcbiAgICAgICAgICAgICAgICAgICAgX3ZpZGVvRmlsZS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgX3ZpZGVvRmlsZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCBfcHJvZHVjdENvbnRlbnQgIT0gbnVsbCApIHtcbiAgICAgICAgICAgICAgICAgICAgX3Byb2R1Y3RDb250ZW50LmVtcHR5KCk7XG4gICAgICAgICAgICAgICAgICAgIF9wcm9kdWN0Q29udGVudCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgX29iai5hZGRDbGFzcyggJ2lzLWxvYWRpbmcnICk7XG5cbiAgICAgICAgICAgICAgICBfb2JqLm9mZiggJ3dlYmtpdFRyYW5zaXRpb25FbmQgb3RyYW5zaXRpb25lbmQgb1RyYW5zaXRpb25FbmQgbXNUcmFuc2l0aW9uRW5kIHRyYW5zaXRpb25lbmQnICk7XG5cbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICB9LFxuICAgICAgICBfb25FdmVudHMgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICBfb2JqLm9uKCAnY2xpY2snLCBmdW5jdGlvbiAoIGUgKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoICQoIGUudGFyZ2V0ICkuY2xvc2VzdCggX3BvcHVwQ29udGVudHMgKS5sZW5ndGggPT09IDAgKXtcbiAgICAgICAgICAgICAgICAgICAgX2hpZGVQb3B1cCgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICBfYnRuU2hvdy5vbiggJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgY3VyQnRuID0gJCggdGhpcyApO1xuXG4gICAgICAgICAgICAgICAgX3Nob3dQb3B1cCggY3VyQnRuICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICBfYnRuQ2xvc2Uub24oICdjbGljaycsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgX2hpZGVQb3B1cCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICB9LFxuICAgICAgICBfc2hvd1BvcHVwID0gZnVuY3Rpb24oIGJ0biApe1xuXG4gICAgICAgICAgICBfaXNPcGVuID0gdHJ1ZTtcblxuICAgICAgICAgICAgX3NldFBvcHVwQ29udGVudCggYnRuICk7XG5cbiAgICAgICAgICAgIGlmICggX3dpbmRvdy5zY3JvbGxUb3AoKSAhPT0gMCApe1xuICAgICAgICAgICAgICAgIF9wb3NpdGlvbiA9IF93aW5kb3cuc2Nyb2xsVG9wKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIF9zY3JvbGxDb250ZWluZXIuY3NzKCB7XG4gICAgICAgICAgICAgICAgb3ZlcmZsb3dZOiAnaGlkZGVuJyxcbiAgICAgICAgICAgICAgICBwYWRkaW5nUmlnaHQ6IF9nZXRTY3JvbGxXaWR0aCgpXG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIF9ib2R5LmNzcyggJ292ZXJmbG93LXknLCAnaGlkZGVuJyApO1xuXG4gICAgICAgICAgICBfc2l0ZS5jc3MoIHtcbiAgICAgICAgICAgICAgICAncG9zaXRpb24nOiAncmVsYXRpdmUnLFxuICAgICAgICAgICAgICAgICd0b3AnOiBfcG9zaXRpb24gKiAtMVxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICBpZiAoIF9wb3B1cFdyYXAub3V0ZXJIZWlnaHQoKSA8PSBfd2luZG93Lm91dGVySGVpZ2h0KCkgKSB7XG4gICAgICAgICAgICAgICAgX29iai5jc3MoIHtcbiAgICAgICAgICAgICAgICAgICAgcGFkZGluZ1JpZ2h0OiBfZ2V0U2Nyb2xsV2lkdGgoKVxuICAgICAgICAgICAgICAgIH0gKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgX29iai5hZGRDbGFzcyggJ2lzLW9wZW5lZCcgKTtcblxuICAgICAgICB9LFxuICAgICAgICBfc2V0UG9wdXBDb250ZW50ID0gZnVuY3Rpb24oIGJ0biApe1xuXG4gICAgICAgICAgICB2YXIgY3VyQnRuID0gYnRuLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZSA9IGN1ckJ0bi5kYXRhKCAncG9wdXAnICksXG4gICAgICAgICAgICAgICAgY3VyQ29udGVudCA9IF9wb3B1cENvbnRlbnRzLmZpbHRlciggJy5wb3B1cF8nICsgY2xhc3NOYW1lICk7XG5cbiAgICAgICAgICAgIF9wb3B1cENvbnRlbnRzLmNzcyggeyBkaXNwbGF5OiAnbm9uZScgfSApO1xuICAgICAgICAgICAgY3VyQ29udGVudC5jc3MoIHsgZGlzcGxheTogJ2Jsb2NrJyB9ICk7XG5cbiAgICAgICAgICAgIGlmICggY2xhc3NOYW1lID09PSAnam9pbi11cy12aWRlbycgKSB7IF9zZXRWaWRlb0ZpbGUoIGN1ckJ0bi5kYXRhKCAndmlkZW8nICksIGN1ckNvbnRlbnQgKSB9XG4gICAgICAgICAgICBpZiAoIGNsYXNzTmFtZSA9PT0gJ3Byb2R1Y3QnICkgeyBfc2V0QUpBWFJlcXVlc3QoIGN1ckJ0bi5kYXRhKCAnaWQnICksIGN1ckNvbnRlbnQgKSB9XG4gICAgICAgICAgICBpZiAoIGNsYXNzTmFtZSA9PT0gJ2RlbGV0ZS1hY2NvdW50JyApIHsgX29uRXZlbnREZWxldGVBY2NvdW50KCBjdXJCdG4uZGF0YSggJ2lkJyApLCBjdXJDb250ZW50ICkgfVxuXG4gICAgICAgIH0sXG4gICAgICAgIF9zZXRWaWRlb0ZpbGUgPSBmdW5jdGlvbiAoIGlkLCBvYmogKSB7XG5cbiAgICAgICAgICAgIHZhciBjdXJDb250ZW50ID0gb2JqO1xuXG4gICAgICAgICAgICBjdXJDb250ZW50LmFwcGVuZCggJzxpZnJhbWUgc3JjPVwiaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvJysgaWQgKyc/cmVsPTAmYW1wO3Nob3dpbmZvPTAmYW1wO2F1dG9wbGF5PTFcIiBmcmFtZWJvcmRlcj1cIjBcIiBhbGxvdz1cImF1dG9wbGF5OyBlbmNyeXB0ZWQtbWVkaWFcIiBhbGxvd2Z1bGxzY3JlZW4+PC9pZnJhbWU+JyApO1xuXG4gICAgICAgICAgICBfdmlkZW9GaWxlID0gY3VyQ29udGVudC5maW5kKCAnaWZyYW1lJyApO1xuXG4gICAgICAgICAgICBfdmlkZW9GaWxlLm9uKCAnbG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfc2V0VmlkZW9TaXplKCk7XG4gICAgICAgICAgICAgICAgX29iai5yZW1vdmVDbGFzcyggJ2lzLWxvYWRpbmcnICk7XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIF93aW5kb3cub24oICdyZXNpemUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3NldFZpZGVvU2l6ZSgpO1xuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9zZXRWaWRlb1NpemUgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIHZhciB2aWRlb1dpZHRoID0gX3ZpZGVvRmlsZS5vdXRlcldpZHRoKCk7XG5cbiAgICAgICAgICAgIF92aWRlb0ZpbGUuY3NzKCAnaGVpZ2h0JywgdmlkZW9XaWR0aCAvIDEuNzc3NyArICdweCcgKTtcblxuICAgICAgICB9LFxuICAgICAgICBfc2V0QUpBWFJlcXVlc3QgPSBmdW5jdGlvbiAoIGlkLCBvYmogKSB7XG5cbiAgICAgICAgICAgIF9yZXF1ZXN0ID0gJC5hamF4KCB7XG4gICAgICAgICAgICAgICAgdXJsOiBfdXJsLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnZ2V0X3ZhcmlhYmxlX3Byb2R1Y3RfZm9yX2FkZGluZ190b19jYXJ0JyxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ0pTT04nLFxuICAgICAgICAgICAgICAgIHRpbWVvdXQ6IDIwMDAwLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgIF9zZXRQcm9kdWN0UG9wdXAoIGRhdGEsIG9iaiApO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICggWE1MSHR0cFJlcXVlc3QgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggWE1MSHR0cFJlcXVlc3Quc3RhdHVzVGV4dCAhPSBcImFib3J0XCIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCAnZXJyJyApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgIH0sXG4gICAgICAgIF9vbkV2ZW50RGVsZXRlQWNjb3VudCA9IGZ1bmN0aW9uICggaWQsIG9iaiApIHtcblxuICAgICAgICAgICAgdmFyIGN1clBvcHVwID0gb2JqLFxuICAgICAgICAgICAgICAgIGJ0bkRlbGV0ZUFjY291bnQgPSBjdXJQb3B1cC5maW5kKCAnLmJ0bi1kZWxldGUnICk7XG5cbiAgICAgICAgICAgIGJ0bkRlbGV0ZUFjY291bnQub24oICdjbGljaycsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIGN1clBvcHVwLmFkZENsYXNzKCAnaXMtbG9hZGluZycgKTtcblxuICAgICAgICAgICAgICAgIF9yZXF1ZXN0ID0gJC5hamF4KCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogX3VybCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnZGVsZXRlX215X2FjY291bnQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9pZDogYnRuRGVsZXRlQWNjb3VudC5hdHRyKCAnZGF0YS1pZCcgKVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ0pTT04nLFxuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0OiAyMDAwMCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoIGRhdGEgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZGF0YS5zdGF0dXMgPT0gJ3N1Y2Nlc3MnICl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlcGxhY2UoJy8nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyUG9wdXAucmVtb3ZlQ2xhc3MoICdpcy1sb2FkaW5nJyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1clBvcHVwLmZpbmQoICcucG9wdXBfX2RlbGV0ZS10ZXh0JyApLmh0bWwoICc8cD5Tb3JyeTwvcD48cD5Zb3UgY2FuXFwndCBkZWxldGUgeW91ciBhY2NvdW50LiBXcml0ZSB0byB5b3VyIGFkbWluaXN0cmF0b3IuPC9wPicgKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoIFhNTEh0dHBSZXF1ZXN0ICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBYTUxIdHRwUmVxdWVzdC5zdGF0dXNUZXh0ICE9IFwiYWJvcnRcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCAnZXJyJyApXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIH0gKVxuXG4gICAgICAgIH0sXG4gICAgICAgIF9zZXRQcm9kdWN0UG9wdXAgPSBmdW5jdGlvbiAoIGRhdGEsIG9iaiApIHtcblxuICAgICAgICAgICAgX3Byb2R1Y3RDb250ZW50ID0gb2JqLmZpbmQoICcucG9wdXBfX3Byb2R1Y3Qtd3JhcCcgKTtcblxuICAgICAgICAgICAgdmFyIHBvcHVwRGF0YSA9IGRhdGEsXG4gICAgICAgICAgICAgICAgcG9wdXBQcmljZSA9ICQoIHBvcHVwRGF0YS5wcmljZSApLnRleHQoKSxcbiAgICAgICAgICAgICAgICBwb3B1cE9wdGlvbiA9IHBvcHVwRGF0YS52YXJpYXRpb25zLFxuICAgICAgICAgICAgICAgIHBvcHVwT3B0aW9uVG90YWwgPSBwb3B1cE9wdGlvbi5sZW5ndGgsXG4gICAgICAgICAgICAgICAgcG9wdXBDb250ZW50ID0gJCggJzxkaXYgY2xhc3M9XCJib29rXCI+JyArXG4gICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJib29rX19waWN0dXJlIGpzLWJhY2stcGljdHVyZVwiPjwvZGl2PicgK1xuICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiYm9va19faW5mbyBhcnRpY2xlXCI+JyArIHBvcHVwRGF0YS50ZXh0ICtcbiAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImJvb2tfX2xhbmd1YWdlXCI+PC9kaXY+JyArXG4gICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJib29rX19mb290ZXJcIj4nICtcbiAgICAgICAgICAgICAgICAnPGEgaHJlZj1cIiNcIiBjbGFzcz1cImJ0biBidG5fY29sb3ItMiBidG5fdHlwZS1zYWxlIGFqYXgtYWRkLXRvLWNhcnQgY2xvc2UtcG9wdXBcIiBkYXRhLWlkPVwiJysgcG9wdXBPcHRpb25bMF0uaWQgKydcIj48c3Bhbj5BZGQgdG8gQ2FydCAtIDxzdHJvbmc+JysgcG9wdXBQcmljZSArJzwvc3Ryb25nPjwvc3Bhbj48L2E+JyArXG4gICAgICAgICAgICAgICAgJzwvZGl2PjwvZGl2PjwvZGl2PicgKTtcblxuICAgICAgICAgICAgX3Byb2R1Y3RDb250ZW50Lmh0bWwoIHBvcHVwQ29udGVudCApO1xuXG4gICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPD0gcG9wdXBPcHRpb25Ub3RhbCAtIDE7IGkrKyApe1xuXG4gICAgICAgICAgICAgICAgX3Byb2R1Y3RDb250ZW50LmZpbmQoICcuYm9va19fcGljdHVyZScgKS5hcHBlbmQoICc8aW1nIHNyYz1cIicrIHBvcHVwT3B0aW9uW2ldLmltYWdlICsnXCIgYWx0PVwiJysgcG9wdXBPcHRpb25baV0udGl0bGUgKydcIiBkYXRhLWlkPVwiJysgcG9wdXBPcHRpb25baV0uaWQgKydcIj4nIClcbiAgICAgICAgICAgICAgICBfcHJvZHVjdENvbnRlbnQuZmluZCggJy5ib29rX19sYW5ndWFnZScgKS5hcHBlbmQoICc8bGFiZWw+PGlucHV0IHR5cGU9XCJyYWRpb1wiIHZhbHVlPVwiJysgcG9wdXBPcHRpb25baV0uaWQgKydcIiBuYW1lPVwibGFuZ3VhZ2VcIj48c3Bhbj4nKyBwb3B1cE9wdGlvbltpXS50aXRsZSArJzwvc3Bhbj48L2xhYmVsPicgKVxuXG4gICAgICAgICAgICAgICAgaWYgKCBpICsgMSA9PSBwb3B1cE9wdGlvblRvdGFsICkge1xuXG4gICAgICAgICAgICAgICAgICAgIG5ldyBBZGRUb0NhcnQgKCBfcHJvZHVjdENvbnRlbnQuZmluZCggJy5hamF4LWFkZC10by1jYXJ0JyApICk7XG4gICAgICAgICAgICAgICAgICAgIG5ldyBCYWNrUGljdHVyZUZ1bGxTaXplICggX3Byb2R1Y3RDb250ZW50LmZpbmQoICcuanMtYmFjay1waWN0dXJlJyApICk7XG4gICAgICAgICAgICAgICAgICAgIG5ldyBDaGFuZ2VCb29rTGFuZ3VhZ2UgKCBwb3B1cENvbnRlbnQgKTtcblxuICAgICAgICAgICAgICAgICAgICBfb2JqLnJlbW92ZUNsYXNzKCAnaXMtbG9hZGluZycgKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG4gICAgICAgIF9jb25zdHJ1Y3QgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICBfb25FdmVudHMoKTtcbiAgICAgICAgICAgIF9vYmpbIDAgXS5vYmogPSBfc2VsZjtcblxuICAgICAgICB9O1xuXG4gICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgLy9wdWJsaWMgbWV0aG9kc1xuICAgIF9zZWxmLm9wZW5Qb3B1cCA9IGZ1bmN0aW9uICggb2JqICkge1xuXG4gICAgICAgIHZhciBjdXJCdG4gPSBvYmo7XG5cbiAgICAgICAgX3Nob3dQb3B1cCggY3VyQnRuICk7XG5cbiAgICB9O1xuICAgIF9zZWxmLmNsb3NlUG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICggX2lzT3BlbiApe1xuICAgICAgICAgICAgX2hpZGVQb3B1cCgpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIF9jb25zdHJ1Y3QoKTtcblxufTsiXX0=
